"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2552],{72552:(e,s,a)=>{a.d(s,{A:()=>P});var t=a(95155),l=a(85263),n=a(20393),r=a(42837),i=a(39210),o=a(30489),c=a(96961),d=a(95517),h=a(8179),u=a(31556),x=a(95171),m=a(64628),g=a(12115),p=a(34844),A=a(76867),j=a(73289),y=a(38983),S=a(27309),_=a(29057),f=a(13121),w=a(62591),v=a(7188),k=a(39197),D=a(22054),E=a(2212),N=a(87927),C=a(56680),I=a(73806),F=a(79363),b=a(75892),T=a(28436),M=a(55445),L=a(88534);console.log("process.env.NODE_ENV","production");let Y=e=>null!==e&&("Admin"===e||"Admin Viewer"===e),P=({accessToken:e,token:s,userRole:a,userID:P,keys:V,premiumUser:U})=>{let B=new Date,[O,$]=(0,g.useState)([]),[q,K]=(0,g.useState)([]),[W,H]=(0,g.useState)([]),[R,G]=(0,g.useState)([]),[z,Q]=(0,g.useState)([]),[X,J]=(0,g.useState)([]),[Z,ee]=(0,g.useState)([]),[es,ea]=(0,g.useState)([]),[et,el]=(0,g.useState)([]),[en,er]=(0,g.useState)([]),[ei,eo]=(0,g.useState)({}),[ec,ed]=(0,g.useState)([]),[eh,eu]=(0,g.useState)(""),[ex,em]=(0,g.useState)(["all-tags"]),[eg,ep]=(0,g.useState)({from:new Date(Date.now()-6048e5),to:new Date}),[eA,ej]=(0,g.useState)(null),[ey,eS]=(0,g.useState)(0),e_=new Date(B.getFullYear(),B.getMonth(),1),ef=new Date(B.getFullYear(),B.getMonth()+1,0),ew=eC(e_),ev=eC(ef);function ek(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0,notation:"compact",compactDisplay:"short"}).format(e)}console.log("keys in usage",V),console.log("premium user in usage",U);let eD=async()=>{if(e)try{let s=await (0,T.getProxyUISettings)(e);return console.log("usage tab: proxy_settings",s),s}catch(e){console.error("Error fetching proxy settings:",e)}};(0,g.useEffect)(()=>{eN(eg.from,eg.to)},[eg,ex]);let eE=async(s,a,t)=>{if(!s||!a||!e)return;console.log("uiSelectedKey",t);let l=await (0,T.adminTopEndUsersCall)(e,t,s.toISOString(),a.toISOString());console.log("End user data updated successfully",l),G(l)},eN=async(s,a)=>{if(!s||!a||!e)return;let t=await eD();t?.DISABLE_EXPENSIVE_DB_QUERIES||(J((await (0,T.tagsSpendLogsCall)(e,s.toISOString(),a.toISOString(),0===ex.length?void 0:ex)).spend_per_tag),console.log("Tag spend data updated successfully"))};function eC(e){let s=e.getFullYear(),a=e.getMonth()+1,t=e.getDate();return`${s}-${a<10?"0"+a:a}-${t<10?"0"+t:t}`}console.log(`Start date is ${ew}`),console.log(`End date is ${ev}`);let eI=async(e,s,a)=>{try{let a=await e();s(a)}catch(e){console.error(a,e)}},eF=(e,s,a,t)=>{let l=[],n=new Date(s),r=new Map(e.map(e=>{let s=(e=>{if(e.includes("-"))return e;{let[s,a]=e.split(" ");return new Date(new Date().getFullYear(),new Date(`${s} 01 2024`).getMonth(),parseInt(a)).toISOString().split("T")[0]}})(e.date);return[s,{...e,date:s}]}));for(;n<=a;){let e=n.toISOString().split("T")[0];if(r.has(e))l.push(r.get(e));else{let s={date:e,api_requests:0,total_tokens:0};t.forEach(e=>{s[e]||(s[e]=0)}),l.push(s)}n.setDate(n.getDate()+1)}return l},eb=async()=>{if(e)try{let s=await (0,T.adminSpendLogsCall)(e),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),n=eF(s,t,l,[]),r=Number(n.reduce((e,s)=>e+(s.spend||0),0).toFixed(2));eS(r),$(n)}catch(e){console.error("Error fetching overall spend:",e)}},eT=async()=>{e&&await eI(async()=>(await (0,T.adminTopKeysCall)(e)).map(e=>({key:e.api_key.substring(0,10),api_key:e.api_key,key_alias:e.key_alias,spend:Number(e.total_spend.toFixed(2))})),K,"Error fetching top keys")},eM=async()=>{e&&await eI(async()=>(await (0,T.adminTopModelsCall)(e)).map(e=>({key:e.model,spend:(0,L.HY)(e.total_spend,2)})),H,"Error fetching top models")},eL=async()=>{e&&await eI(async()=>{let s=await (0,T.teamSpendLogsCall)(e),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0);return Q(eF(s.daily_spend,t,l,s.teams)),ea(s.teams),s.total_spend_per_team.map(e=>({name:e.team_id||"",value:(0,L.HY)(e.total_spend||0,2)}))},el,"Error fetching team spend")},eY=async()=>{if(e)try{let s=await (0,T.adminGlobalActivity)(e,ew,ev),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),n=eF(s.daily_data||[],t,l,["api_requests","total_tokens"]);eo({...s,daily_data:n})}catch(e){console.error("Error fetching global activity:",e)}},eP=async()=>{if(e)try{let s=await (0,T.adminGlobalActivityPerModel)(e,ew,ev),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),n=s.map(e=>({...e,daily_data:eF(e.daily_data||[],t,l,["api_requests","total_tokens"])}));ed(n)}catch(e){console.error("Error fetching global activity per model:",e)}};return((0,g.useEffect)(()=>{(async()=>{if(e&&s&&a&&P){let t=await eD();!(t&&(ej(t),t?.DISABLE_EXPENSIVE_DB_QUERIES))&&(console.log("fetching data - valiue of proxySettings",eA),eb(),eI(()=>e&&s?(0,T.adminspendByProvider)(e,s,ew,ev):Promise.reject("No access token or token"),er,"Error fetching provider spend"),eT(),eM(),eY(),eP(),Y(a)&&(eL(),e&&eI(async()=>(await (0,T.allTagNamesCall)(e)).tag_names,ee,"Error fetching tag names"),e&&eI(()=>(0,T.tagsSpendLogsCall)(e,eg.from?.toISOString(),eg.to?.toISOString(),void 0),e=>J(e.spend_per_tag),"Error fetching top tags"),e&&eI(()=>(0,T.adminTopEndUsersCall)(e,null,void 0,void 0),G,"Error fetching top end users")))}})()},[e,s,a,P,ew,ev]),eA?.DISABLE_EXPENSIVE_DB_QUERIES)?(0,t.jsx)("div",{style:{width:"100%"},className:"p-8",children:(0,t.jsxs)(r.A,{children:[(0,t.jsx)(m.A,{children:"Database Query Limit Reached"}),(0,t.jsxs)(b.A,{className:"mt-4",children:["SpendLogs in DB has ",eA.NUM_SPEND_LOGS_ROWS," rows.",(0,t.jsx)("br",{}),"Please follow our guide to view usage when SpendLogs has more than 1M rows."]}),(0,t.jsx)(y.A,{className:"mt-4",children:(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/spending_monitoring",target:"_blank",children:"View Usage Guide"})})]})}):(0,t.jsx)("div",{style:{width:"100%"},className:"p-8",children:(0,t.jsxs)(N.A,{children:[(0,t.jsxs)(C.A,{className:"mt-2",children:[(0,t.jsx)(E.A,{children:"All Up"}),Y(a)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.A,{children:"Team Based Usage"}),(0,t.jsx)(E.A,{children:"Customer Usage"}),(0,t.jsx)(E.A,{children:"Tag Based Usage"})]}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{})})]}),(0,t.jsxs)(F.A,{children:[(0,t.jsx)(I.A,{children:(0,t.jsxs)(N.A,{children:[(0,t.jsxs)(C.A,{variant:"solid",className:"mt-1",children:[(0,t.jsx)(E.A,{children:"Cost"}),(0,t.jsx)(E.A,{children:"Activity"})]}),(0,t.jsxs)(F.A,{children:[(0,t.jsx)(I.A,{children:(0,t.jsxs)(f.A,{numItems:2,className:"gap-2 h-[100vh] w-full",children:[(0,t.jsxs)(S.A,{numColSpan:2,children:[(0,t.jsxs)(b.A,{className:"text-tremor-default text-tremor-content dark:text-dark-tremor-content mb-2 mt-2 text-lg",children:["Project Spend ",new Date().toLocaleString("default",{month:"long"})," 1 -"," ",new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate()]}),(0,t.jsx)(p.A,{userSpend:ey,selectedTeam:null,userMaxBudget:null})]}),(0,t.jsx)(S.A,{numColSpan:2,children:(0,t.jsxs)(r.A,{children:[(0,t.jsx)(m.A,{children:"Monthly Spend"}),(0,t.jsx)(l.A,{data:O,index:"date",categories:["spend"],colors:["cyan"],valueFormatter:e=>`$ ${(0,L.HY)(e,2)}`,yAxisWidth:100,tickGap:5})]})}),(0,t.jsx)(S.A,{numColSpan:1,children:(0,t.jsxs)(r.A,{className:"h-full",children:[(0,t.jsx)(m.A,{children:"Top Virtual Keys"}),(0,t.jsx)(M.A,{topKeys:q,teams:null,topKeysLimit:5,setTopKeysLimit:()=>{}})]})}),(0,t.jsx)(S.A,{numColSpan:1,children:(0,t.jsxs)(r.A,{className:"h-full",children:[(0,t.jsx)(m.A,{children:"Top Models"}),(0,t.jsx)(l.A,{className:"mt-4 h-40",data:W,index:"key",categories:["spend"],colors:["cyan"],yAxisWidth:200,layout:"vertical",showXAxis:!1,showLegend:!1,valueFormatter:e=>`\xa5${(0,L.HY)(e)}`})]})}),(0,t.jsx)(S.A,{numColSpan:1}),(0,t.jsx)(S.A,{numColSpan:2,children:(0,t.jsxs)(r.A,{className:"mb-2",children:[(0,t.jsx)(m.A,{children:"Spend by Provider"}),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(f.A,{numItems:2,children:[(0,t.jsx)(S.A,{numColSpan:1,children:(0,t.jsx)(_.A,{className:"mt-4 h-40",variant:"pie",data:en,index:"provider",category:"spend",colors:["cyan"],valueFormatter:e=>`\xa5${(0,L.HY)(e)}`})}),(0,t.jsx)(S.A,{numColSpan:1,children:(0,t.jsxs)(o.A,{children:[(0,t.jsx)(h.A,{children:(0,t.jsxs)(x.A,{children:[(0,t.jsx)(u.A,{children:"Provider"}),(0,t.jsx)(u.A,{children:"Spend"})]})}),(0,t.jsx)(c.A,{children:en.map(e=>(0,t.jsxs)(x.A,{children:[(0,t.jsx)(d.A,{children:e.provider}),(0,t.jsx)(d.A,{children:1e-5>parseFloat(e.spend.toFixed(2))?"less than 0.00":(0,L.HY)(e.spend,2)})]},e.provider))})]})})]})})]})})]})}),(0,t.jsx)(I.A,{children:(0,t.jsxs)(f.A,{numItems:1,className:"gap-2 h-[75vh] w-full",children:[(0,t.jsxs)(r.A,{children:[(0,t.jsx)(m.A,{children:"All Up"}),(0,t.jsxs)(f.A,{numItems:2,children:[(0,t.jsxs)(S.A,{children:[(0,t.jsxs)(i.A,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["API Requests ",ek(ei.sum_api_requests)]}),(0,t.jsx)(j.A,{className:"h-40",data:ei.daily_data,valueFormatter:ek,index:"date",colors:["cyan"],categories:["api_requests"],onValueChange:e=>console.log(e)})]}),(0,t.jsxs)(S.A,{children:[(0,t.jsxs)(i.A,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["Tokens ",ek(ei.sum_total_tokens)]}),(0,t.jsx)(l.A,{className:"h-40",data:ei.daily_data,valueFormatter:ek,index:"date",colors:["cyan"],categories:["total_tokens"],onValueChange:e=>console.log(e)})]})]})]}),(0,t.jsx)(t.Fragment,{children:ec.map((e,s)=>(0,t.jsxs)(r.A,{children:[(0,t.jsx)(m.A,{children:e.model}),(0,t.jsxs)(f.A,{numItems:2,children:[(0,t.jsxs)(S.A,{children:[(0,t.jsxs)(i.A,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["API Requests ",ek(e.sum_api_requests)]}),(0,t.jsx)(j.A,{className:"h-40",data:e.daily_data,index:"date",colors:["cyan"],categories:["api_requests"],valueFormatter:ek,onValueChange:e=>console.log(e)})]}),(0,t.jsxs)(S.A,{children:[(0,t.jsxs)(i.A,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["Tokens ",ek(e.sum_total_tokens)]}),(0,t.jsx)(l.A,{className:"h-40",data:e.daily_data,index:"date",colors:["cyan"],categories:["total_tokens"],valueFormatter:ek,onValueChange:e=>console.log(e)})]})]})]},s))})]})})]})]})}),(0,t.jsx)(I.A,{children:(0,t.jsxs)(f.A,{numItems:2,className:"gap-2 h-[75vh] w-full",children:[(0,t.jsxs)(S.A,{numColSpan:2,children:[(0,t.jsxs)(r.A,{className:"mb-2",children:[(0,t.jsx)(m.A,{children:"Total Spend Per Team"}),(0,t.jsx)(n.A,{data:et})]}),(0,t.jsxs)(r.A,{children:[(0,t.jsx)(m.A,{children:"Daily Spend Per Team"}),(0,t.jsx)(l.A,{className:"h-72",data:z,showLegend:!0,index:"date",categories:es,yAxisWidth:80,stack:!0})]})]}),(0,t.jsx)(S.A,{numColSpan:2})]})}),(0,t.jsxs)(I.A,{children:[(0,t.jsxs)("p",{className:"mb-2 text-gray-500 italic text-[12px]",children:["Customers of your LLM API calls. Tracked when a `user` param is passed in your LLM calls"," ",(0,t.jsx)("a",{className:"text-blue-500",href:"https://docs.litellm.ai/docs/proxy/users",target:"_blank",children:"docs here"})]}),(0,t.jsxs)(f.A,{numItems:2,children:[(0,t.jsx)(S.A,{children:(0,t.jsx)(A.A,{value:eg,onValueChange:e=>{ep(e),eE(e.from,e.to,null)}})}),(0,t.jsxs)(S.A,{children:[(0,t.jsx)(b.A,{children:"Select Key"}),(0,t.jsxs)(k.A,{defaultValue:"all-keys",children:[(0,t.jsx)(D.A,{value:"all-keys",onClick:()=>{eE(eg.from,eg.to,null)},children:"All Keys"},"all-keys"),V?.map((e,s)=>e&&null!==e.key_alias&&e.key_alias.length>0?(0,t.jsx)(D.A,{value:String(s),onClick:()=>{eE(eg.from,eg.to,e.token)},children:e.key_alias},s):null)]})]})]}),(0,t.jsx)(r.A,{className:"mt-4",children:(0,t.jsxs)(o.A,{className:"max-h-[70vh] min-h-[500px]",children:[(0,t.jsx)(h.A,{children:(0,t.jsxs)(x.A,{children:[(0,t.jsx)(u.A,{children:"Customer"}),(0,t.jsx)(u.A,{children:"Spend"}),(0,t.jsx)(u.A,{children:"Total Events"})]})}),(0,t.jsx)(c.A,{children:R?.map((e,s)=>(0,t.jsxs)(x.A,{children:[(0,t.jsx)(d.A,{children:e.end_user}),(0,t.jsx)(d.A,{children:(0,L.HY)(e.total_spend,2)}),(0,t.jsx)(d.A,{children:e.total_count})]},s))})]})})]}),(0,t.jsxs)(I.A,{children:[(0,t.jsxs)(f.A,{numItems:2,children:[(0,t.jsx)(S.A,{numColSpan:1,children:(0,t.jsx)(A.A,{className:"mb-4",value:eg,onValueChange:e=>{ep(e),eN(e.from,e.to)}})}),(0,t.jsx)(S.A,{children:U?(0,t.jsx)("div",{children:(0,t.jsxs)(w.A,{value:ex,onValueChange:e=>em(e),children:[(0,t.jsx)(v.A,{value:"all-tags",onClick:()=>em(["all-tags"]),children:"All Tags"},"all-tags"),Z&&Z.filter(e=>"all-tags"!==e).map((e,s)=>(0,t.jsx)(v.A,{value:String(e),children:e},e))]})}):(0,t.jsx)("div",{children:(0,t.jsxs)(w.A,{value:ex,onValueChange:e=>em(e),children:[(0,t.jsx)(v.A,{value:"all-tags",onClick:()=>em(["all-tags"]),children:"All Tags"},"all-tags"),Z&&Z.filter(e=>"all-tags"!==e).map((e,s)=>(0,t.jsxs)(D.A,{value:String(e),disabled:!0,children:["âœ¨ ",e," (Enterprise only Feature)"]},e))]})})})]}),(0,t.jsxs)(f.A,{numItems:2,className:"gap-2 h-[75vh] w-full mb-4",children:[(0,t.jsx)(S.A,{numColSpan:2,children:(0,t.jsxs)(r.A,{children:[(0,t.jsx)(m.A,{children:"Spend Per Tag"}),(0,t.jsxs)(b.A,{children:["Get Started by Tracking cost per tag"," ",(0,t.jsx)("a",{className:"text-blue-500",href:"https://docs.litellm.ai/docs/proxy/cost_tracking",target:"_blank",children:"here"})]}),(0,t.jsx)(l.A,{className:"h-72",data:X,index:"name",categories:["spend"],colors:["cyan"]})]})}),(0,t.jsx)(S.A,{numColSpan:2})]})]})]})]})})}}}]);