"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3303],{27707:(e,s,t)=>{t.d(s,{A:()=>r});var l=t(95155);t(12115);var a=t(23060);let r=({teams:e,value:s,onChange:t,disabled:r})=>(console.log("disabled",r),(0,l.jsx)(a.A,{showSearch:!0,placeholder:"搜索或选择分组",value:s,onChange:t,disabled:r,allowClear:!0,filterOption:(s,t)=>{if(!t)return!1;let l=e?.find(e=>e.team_id===t.key);if(!l)return!1;let a=s.toLowerCase().trim(),r=(l.team_alias||"").toLowerCase(),i=(l.team_id||"").toLowerCase();return r.includes(a)||i.includes(a)},optionFilterProp:"children",children:e?.map(e=>(0,l.jsxs)(a.A.Option,{value:e.team_id,children:[(0,l.jsx)("span",{className:"font-medium",children:e.team_alias})," ",(0,l.jsxs)("span",{className:"text-gray-500",children:["(",e.team_id,")"]})]},e.team_id))}))},32521:(e,s,t)=>{t.d(s,{A:()=>n,C:()=>i});var l=t(95155);t(12115);var a=t(23060);let{Option:r}=a.A,i=e=>e?({"24h":"daily","7d":"weekly","30d":"monthly"})[e]||e:"Not set",n=({value:e,onChange:s,className:t="",style:i={}})=>(0,l.jsxs)(a.A,{style:{width:"100%",...i},value:e||void 0,onChange:s,className:t,placeholder:"n/a",allowClear:!0,children:[(0,l.jsx)(r,{value:"24h",children:"daily"}),(0,l.jsx)(r,{value:"7d",children:"weekly"}),(0,l.jsx)(r,{value:"30d",children:"monthly"})]})},48154:(e,s,t)=>{t.d(s,{C:()=>G});var l=t(95155),a=t(94300),r=t(51345),i=t(35625),n=t(38983),d=t(22054),m=t(34487),c=t(23060),o=t(41326),x=t(25387),u=t(99876),h=t(91808),j=t(8208),g=t(87278),p=t(3373),b=t(54481),f=t(22277),y=t(12115),v=t(50410),N=t(62823),_=t(50139),w=t(72197),A=t(60896),C=t(58847),S=t(24611),k=t(87233),V=t(46732),$=t(28436),L=t(59386),E=t.n(L),I=t(91314),U=t(92982),O=t(24963),B=t(99312),F=t(12120);let M=({accessToken:e,teams:s,possibleUIRoles:t,onUsersCreated:a})=>{let[r,i]=(0,y.useState)(!1),[n,d]=(0,y.useState)([]),[m,c]=(0,y.useState)(!1),[x,u]=(0,y.useState)(null),[h,j]=(0,y.useState)(null),[g,b]=(0,y.useState)(null),[f,L]=(0,y.useState)(null),[M,R]=(0,y.useState)(null),[D,T]=(0,y.useState)("http://localhost:4000");(0,y.useEffect)(()=>{(async()=>{try{let s=await (0,$.getProxyUISettings)(e);R(s)}catch(e){console.error("Error fetching UI settings:",e)}})(),T(new URL("/",window.location.href).toString())},[e]);let P=async()=>{c(!0);let s=n.map(e=>({...e,status:"pending"}));d(s);let t=!1;for(let l=0;l<s.length;l++){let a=s[l];try{let s={user_email:a.user_email,user_role:a.user_role};if(a.teams&&"string"==typeof a.teams&&""!==a.teams.trim()&&(s.teams=a.teams.split(",").map(e=>e.trim()).filter(Boolean),0===s.teams.length&&delete s.teams),a.models&&"string"==typeof a.models&&""!==a.models.trim()&&(s.models=a.models.split(",").map(e=>e.trim()).filter(Boolean),0===s.models.length&&delete s.models),a.max_budget&&""!==a.max_budget.toString().trim()){let e=parseFloat(a.max_budget.toString());!isNaN(e)&&e>0&&(s.max_budget=e)}a.budget_duration&&""!==a.budget_duration.trim()&&(s.budget_duration=a.budget_duration.trim()),a.metadata&&"string"==typeof a.metadata&&""!==a.metadata.trim()&&(s.metadata=a.metadata.trim()),console.log("Sending user data:",s);let r=await (0,$.userCreateCall)(e,null,s);if(console.log("Full response:",r),r&&(r.key||r.user_id)){t=!0,console.log("Success case triggered");let s=r.data?.user_id||r.user_id;try{if(M?.SSO_ENABLED){let e=new URL("/ui",D).toString();d(s=>s.map((s,t)=>t===l?{...s,status:"success",key:r.key||r.user_id,invitation_link:e}:s))}else{let t=await (0,$.invitationCreateCall)(e,s),a=new URL(`/ui?invitation_id=${t.id}`,D).toString();d(e=>e.map((e,s)=>s===l?{...e,status:"success",key:r.key||r.user_id,invitation_link:a}:e))}}catch(e){console.error("Error creating invitation:",e),d(e=>e.map((e,s)=>s===l?{...e,status:"success",key:r.key||r.user_id,error:"用户创建成功，但生成邀请链接失败"}:e))}}else{console.log("Error case triggered");let e=r?.error||"创建用户失败";console.log("Error message:",e),d(s=>s.map((s,t)=>t===l?{...s,status:"failed",error:e}:s))}}catch(s){console.error("Caught error:",s);let e=s?.response?.data?.error||s?.message||String(s);d(s=>s.map((s,t)=>t===l?{...s,status:"failed",error:e}:s))}}c(!1),t&&a&&a()},z=[{title:"行号",dataIndex:"rowNumber",key:"rowNumber",width:80},{title:"邮箱",dataIndex:"user_email",key:"user_email"},{title:"角色",dataIndex:"user_role",key:"user_role"},{title:"分组",dataIndex:"teams",key:"teams"},{title:"预算",dataIndex:"max_budget",key:"max_budget"},{title:"状态",key:"status",render:(e,s)=>s.isValid?s.status&&"pending"!==s.status?"success"===s.status?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(U.A,{className:"h-5 w-5 text-green-500 mr-2"}),(0,l.jsx)("span",{className:"text-green-500",children:"成功"})]}),s.invitation_link&&(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:s.invitation_link}),(0,l.jsx)(B.CopyToClipboard,{text:s.invitation_link,onCopy:()=>F.Ay.success("邀请链接已复制"),children:(0,l.jsx)("button",{className:"ml-1 text-blue-500 text-xs hover:text-blue-700",children:"复制"})})]})})]}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(I.A,{className:"h-5 w-5 text-red-500 mr-2"}),(0,l.jsx)("span",{className:"text-red-500",children:"失败"})]}),s.error&&(0,l.jsx)("span",{className:"text-sm text-red-500 ml-7",children:JSON.stringify(s.error)})]}):(0,l.jsx)("span",{className:"text-gray-500",children:"处理中"}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(I.A,{className:"h-5 w-5 text-red-500 mr-2"}),(0,l.jsx)("span",{className:"text-red-500",children:"无效"})]}),s.error&&(0,l.jsx)("span",{className:"text-sm text-red-500 ml-7",children:s.error})]})}];return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(v.$,{className:"mb-0",onClick:()=>i(!0),children:"+ 批量创建"}),(0,l.jsx)(p.A,{title:"批量创建",open:r,width:800,onCancel:()=>i(!1),bodyStyle:{maxHeight:"70vh",overflow:"auto"},footer:null,children:(0,l.jsx)("div",{className:"flex flex-col",children:0===n.length?(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center mb-4",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center mr-3",children:"1"}),(0,l.jsx)("h3",{className:"text-lg font-medium",children:"下载并填写模板"})]}),(0,l.jsxs)("div",{className:"ml-11 mb-6",children:[(0,l.jsx)("p",{className:"mb-4",children:"按照以下步骤一次性批量创建用户："}),(0,l.jsxs)("ol",{className:"list-decimal list-inside space-y-2 ml-2 mb-4",children:[(0,l.jsx)("li",{children:"下载 CSV 模板"}),(0,l.jsx)("li",{children:"在表格中填写用户信息"}),(0,l.jsx)("li",{children:"保存并上传 CSV 文件"}),(0,l.jsx)("li",{children:"创建完成后，下载包含每个用户虚拟密钥的结果文件"})]}),(0,l.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md border border-gray-200 mb-4",children:[(0,l.jsx)("h4",{className:"font-medium mb-2",children:"模板字段说明"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500 mt-1.5 mr-2 flex-shrink-0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:"user_email"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"用户邮箱（必填）"})]})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500 mt-1.5 mr-2 flex-shrink-0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:"user_role"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:'用户角色（可选值："proxy_admin"、"proxy_admin_viewer"、 "internal_user"、"internal_user_viewer"）'})]})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-300 mt-1.5 mr-2 flex-shrink-0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:"teams"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:'逗号分隔的分组 ID（示例："team-1,team-2"）'})]})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-300 mt-1.5 mr-2 flex-shrink-0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:"max_budget"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:'预算上限（数字，示例："100"）'})]})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-300 mt-1.5 mr-2 flex-shrink-0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:"budget_duration"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:'预算重置周期（示例："30d"、"1mo"）'})]})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-300 mt-1.5 mr-2 flex-shrink-0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:"models"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:'逗号分隔的可用模型（示例："gpt-3.5-turbo,gpt-4"）'})]})]})]})]}),(0,l.jsxs)(v.$,{onClick:()=>{let e=new Blob([E().unparse([["user_email","user_role","teams","max_budget","budget_duration","models"],["user@example.com","internal_user","team-id-1,team-id-2","100","30d","gpt-3.5-turbo,gpt-4"]])],{type:"text/csv"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="bulk_users_template.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)},size:"lg",className:"w-full md:w-auto",children:[(0,l.jsx)(w.A,{className:"mr-2"})," 下载 CSV 模板"]})]}),(0,l.jsxs)("div",{className:"flex items-center mb-4",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center mr-3",children:"2"}),(0,l.jsx)("h3",{className:"text-lg font-medium",children:"上传已填写的 CSV"})]}),(0,l.jsxs)("div",{className:"ml-11",children:[f?(0,l.jsxs)("div",{className:`mb-4 p-4 rounded-md border ${g?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[g?(0,l.jsx)(A.A,{className:"text-red-500 text-xl mr-3"}):(0,l.jsx)(C.A,{className:"text-blue-500 text-xl mr-3"}),(0,l.jsxs)("div",{children:[(0,l.jsx)(o.A.Text,{strong:!0,className:g?"text-red-800":"text-blue-800",children:f.name}),(0,l.jsxs)(o.A.Text,{className:`block text-xs ${g?"text-red-600":"text-blue-600"}`,children:[(f.size/1024).toFixed(1)," KB • ",new Date().toLocaleDateString()]})]})]}),(0,l.jsxs)(v.$,{size:"xs",variant:"secondary",onClick:()=>{L(null),d([]),u(null),j(null),b(null)},className:"flex items-center",children:[(0,l.jsx)(S.A,{className:"mr-1"})," 移除"]})]}),g?(0,l.jsxs)("div",{className:"mt-3 text-red-600 text-sm flex items-start",children:[(0,l.jsx)(k.A,{className:"mr-2 mt-0.5"}),(0,l.jsx)("span",{children:g})]}):!h&&(0,l.jsxs)("div",{className:"mt-3 flex items-center",children:[(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:(0,l.jsx)("div",{className:"bg-blue-500 h-1.5 rounded-full w-full animate-pulse"})}),(0,l.jsx)("span",{className:"ml-2 text-xs text-blue-600",children:"处理中..."})]})]}):(0,l.jsx)(N.A,{beforeUpload:e=>((u(null),j(null),b(null),L(e),"text/csv"===e.type||e.name.endsWith(".csv"))?e.size>5242880?b(`文件过大（${(e.size/1048576).toFixed(1)} MB）。请上传小于 5MB 的 CSV 文件。`):E().parse(e,{complete:e=>{if(!e.data||0===e.data.length){j("CSV 文件为空，请上传包含数据的文件。"),d([]);return}if(1===e.data.length){j("CSV 文件仅包含表头，没有用户数据。请在 CSV 中添加用户数据。"),d([]);return}let t=e.data[0];if(0===t.length||1===t.length&&""===t[0]){j("CSV 文件不包含列名，请确认 CSV 包含表头。"),d([]);return}let l=["user_email","user_role"].filter(e=>!t.includes(e));if(l.length>0){j(`CSV 缺少必填列：${l.join(", ")}。请补充后重试。`),d([]);return}try{let l=e.data.slice(1).map((e,l)=>{if(0===e.length||1===e.length&&""===e[0])return null;if(e.length<t.length)return{rowNumber:l+2,isValid:!1,error:`第 ${l+2} 行列数少于表头，请检查 CSV 格式。`,user_email:"",user_role:""};let a={user_email:e[t.indexOf("user_email")]?.trim()||"",user_role:e[t.indexOf("user_role")]?.trim()||"",teams:e[t.indexOf("teams")]?.trim(),max_budget:e[t.indexOf("max_budget")]?.trim(),budget_duration:e[t.indexOf("budget_duration")]?.trim(),models:e[t.indexOf("models")]?.trim(),rowNumber:l+2,isValid:!0,error:""},r=[];if(a.user_email?a.user_email.includes("@")&&a.user_email.includes(".")||r.push("邮箱格式无效（需包含 @ 和域名）"):r.push("邮箱为必填项"),a.user_role){let e=["proxy_admin","proxy_admin_viewer","internal_user","internal_user_viewer"];e.includes(a.user_role)||r.push(`角色 "${a.user_role}" 无效，可选值：${e.join(", ")}`)}else r.push("角色为必填项");if(a.max_budget&&""!==a.max_budget.toString().trim()&&(isNaN(parseFloat(a.max_budget.toString()))?r.push(`预算上限 "${a.max_budget}" 必须是数字`):0>=parseFloat(a.max_budget.toString())&&r.push("预算上限必须大于 0")),a.budget_duration&&!a.budget_duration.match(/^\d+[dhmwy]$|^\d+mo$/)&&r.push(`预算重置周期格式无效 "${a.budget_duration}"，示例：30d、1mo、2w、6h`),a.teams&&"string"==typeof a.teams&&s&&s.length>0){let e=s.map(e=>e.team_id),t=a.teams.split(",").map(e=>e.trim()).filter(s=>!e.includes(s));t.length>0&&r.push(`未知分组：${t.join(", ")}`)}return r.length>0&&(a.isValid=!1,a.error=r.join(", ")),a}).filter(Boolean),a=l.filter(e=>e.isValid);d(l),0===l.length?j("CSV 中未找到有效数据行，请检查文件格式。"):0===a.length?u("CSV 中没有可创建的有效用户，请根据下方错误提示修正后重试。"):a.length<l.length?u(`共 ${l.length} 行，其中 ${l.length-a.length} 行存在错误，请修正后继续。`):F.Ay.success(`解析成功，共 ${a.length} 个用户`)}catch(s){let e=s instanceof Error?s.message:"未知错误";u(`CSV 解析失败：${e}`),d([])}},error:e=>{u(`CSV 解析失败：${e.message}`),d([])},header:!1}):(b(`文件类型无效：${e.name}。请上传 CSV 文件（.csv 后缀）。`),F.Ay.fromBackend("文件类型无效，请上传 CSV 文件。")),!1),accept:".csv",maxCount:1,showUploadList:!1,children:(0,l.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer",children:[(0,l.jsx)(V.A,{className:"text-3xl text-gray-400 mb-2"}),(0,l.jsx)("p",{className:"mb-1",children:"将 CSV 文件拖拽到这里"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mb-3",children:"或"}),(0,l.jsx)(v.$,{size:"sm",children:"选择文件"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-4",children:"仅支持 CSV 文件（.csv）"})]})}),h&&(0,l.jsx)("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)(O.A,{className:"h-5 w-5 text-yellow-500 mr-2 mt-0.5"}),(0,l.jsxs)("div",{children:[(0,l.jsx)(o.A.Text,{strong:!0,className:"text-yellow-800",children:"CSV 结构错误"}),(0,l.jsx)(o.A.Paragraph,{className:"text-yellow-700 mt-1 mb-0",children:h}),(0,l.jsx)(o.A.Paragraph,{className:"text-yellow-700 mt-2 mb-0",children:"请下载模板并确保 CSV 格式符合要求。"})]})]})})]})]}):(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center mb-4",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center mr-3",children:"3"}),(0,l.jsx)("h3",{className:"text-lg font-medium",children:n.some(e=>"success"===e.status||"failed"===e.status)?"创建结果":"确认并创建用户"})]}),x&&(0,l.jsx)("div",{className:"ml-11 mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)(k.A,{className:"text-red-500 mr-2 mt-1"}),(0,l.jsxs)("div",{children:[(0,l.jsx)(v.E,{className:"text-red-600 font-medium",children:x}),n.some(e=>!e.isValid)&&(0,l.jsxs)("ul",{className:"mt-2 list-disc list-inside text-red-600 text-sm",children:[(0,l.jsx)("li",{children:"请查看下方表格中每一行的具体错误"}),(0,l.jsx)("li",{children:"常见问题包括邮箱格式错误、必填项缺失或角色值不正确"}),(0,l.jsx)("li",{children:"修复后请重新上传 CSV 文件"})]})]})]})}),(0,l.jsxs)("div",{className:"ml-11",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,l.jsx)("div",{className:"flex items-center",children:n.some(e=>"success"===e.status||"failed"===e.status)?(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(v.E,{className:"text-lg font-medium mr-3",children:"创建汇总"}),(0,l.jsxs)(v.E,{className:"text-sm bg-green-100 text-green-800 px-2 py-1 rounded mr-2",children:["成功 ",n.filter(e=>"success"===e.status).length]}),n.some(e=>"failed"===e.status)&&(0,l.jsxs)(v.E,{className:"text-sm bg-red-100 text-red-800 px-2 py-1 rounded",children:["失败 ",n.filter(e=>"failed"===e.status).length]})]}):(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(v.E,{className:"text-lg font-medium mr-3",children:"用户预览"}),(0,l.jsxs)(v.E,{className:"text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["有效用户 ",n.filter(e=>e.isValid).length," / ",n.length]})]})}),!n.some(e=>"success"===e.status||"failed"===e.status)&&(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsx)(v.$,{onClick:()=>{d([]),u(null)},variant:"secondary",children:"返回"}),(0,l.jsx)(v.$,{onClick:P,disabled:0===n.filter(e=>e.isValid).length||m,children:m?"创建中...":`创建 ${n.filter(e=>e.isValid).length} 个用户`})]})]}),n.some(e=>"success"===e.status)&&(0,l.jsx)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-md",children:(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"mr-3 mt-1",children:(0,l.jsx)(U.A,{className:"h-5 w-5 text-blue-500"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)(v.E,{className:"font-medium text-blue-800",children:"用户创建完成"}),(0,l.jsxs)(v.E,{className:"block text-sm text-blue-700 mt-1",children:[(0,l.jsx)("span",{className:"font-medium",children:"下一步："}),"下载包含虚拟密钥和邀请链接的结果文件，用户可使用虚拟密钥通过 LiteLLM 发起 LLM 请求。"]})]})]})}),(0,l.jsx)(_.A,{dataSource:n,columns:z,size:"small",pagination:{pageSize:5},scroll:{y:300},rowClassName:e=>e.isValid?"":"bg-red-50"}),!n.some(e=>"success"===e.status||"failed"===e.status)&&(0,l.jsxs)("div",{className:"flex justify-end mt-4",children:[(0,l.jsx)(v.$,{onClick:()=>{d([]),u(null)},variant:"secondary",className:"mr-3",children:"返回"}),(0,l.jsx)(v.$,{onClick:P,disabled:0===n.filter(e=>e.isValid).length||m,children:m?"创建中...":`创建 ${n.filter(e=>e.isValid).length} 个用户`})]}),n.some(e=>"success"===e.status||"failed"===e.status)&&(0,l.jsxs)("div",{className:"flex justify-end mt-4",children:[(0,l.jsx)(v.$,{onClick:()=>{d([]),u(null)},variant:"secondary",className:"mr-3",children:"重新开始批量导入"}),(0,l.jsxs)(v.$,{onClick:()=>{let e=n.map(e=>({user_email:e.user_email,user_role:e.user_role,status:e.status,key:e.key||"",invitation_link:e.invitation_link||"",error:e.error||""})),s=new Blob([E().unparse(e)],{type:"text/csv"}),t=window.URL.createObjectURL(s),l=document.createElement("a");l.href=t,l.download="bulk_users_results.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(t)},variant:"primary",className:"flex items-center",children:[(0,l.jsx)(w.A,{className:"mr-2"})," 下载用户凭证结果"]})]})]})]})})})]})};var R=t(32521),D=t(27707),T=t(64601),P=t(48812);let{Option:z}=c.A,{Text:K,Link:J,Title:q}=o.A,G=({userID:e,accessToken:s,teams:t,possibleUIRoles:o,onUserCreated:v,isEmbedded:N=!1})=>{let _=(0,i.jE)(),[w,A]=(0,y.useState)(null),[C]=x.A.useForm(),[S,k]=(0,y.useState)(!1),[V,L]=(0,y.useState)(!1),[E,I]=(0,y.useState)([]),[U,O]=(0,y.useState)(!1),[B,z]=(0,y.useState)(null),[q,G]=(0,y.useState)(null);(0,y.useEffect)(()=>{let t=async()=>{try{let t=await (0,$.modelAvailableCall)(s,e,"any"),l=[];for(let e=0;e<t.data.length;e++){let s=t.data[e];l.push(s.id)}I(l);let a=await (0,$.getProxyUISettings)(s);A(a)}catch(e){console.error("Error fetching model data:",e)}};G((0,$.getProxyBaseUrl)()),t()},[]);let H=async t=>{try{F.Ay.info("正在发起请求"),N||k(!0),t.models&&0!==t.models.length||"proxy_admin"===t.user_role||(t.models=["no-default-models"]);let l=await (0,$.userCreateCall)(s,null,t);await _.invalidateQueries({queryKey:["userList"]}),L(!0);let a=l.data?.user_id||l.user_id;if(v&&N){v(a),C.resetFields();return}if(w?.SSO_ENABLED){let s={id:"u">typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let s=16*Math.random()|0;return("x"==e?s:3&s|8).toString(16)}),user_id:a,is_accepted:!1,accepted_at:null,expires_at:new Date(Date.now()+6048e5),created_at:new Date,created_by:e,updated_at:new Date,updated_by:e,has_user_setup_sso:!0};z(s),O(!0)}else(0,$.invitationCreateCall)(s,a).then(e=>{e.has_user_setup_sso=!1,z(e),O(!0)});F.Ay.success("用户创建成功"),C.resetFields(),localStorage.removeItem("userData"+e)}catch(s){let e=s.response?.data?.detail||s?.message||"创建用户失败";F.Ay.fromBackend(e),console.error("Error creating the user:",s)}};return N?(0,l.jsxs)(x.A,{form:C,onFinish:H,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:[(0,l.jsx)(u.A,{message:"邮件邀请",description:(0,l.jsxs)(l.Fragment,{children:["仅当配置了邮件集成（SMTP、Resend 或 SendGrid）时，新用户才会收到邮件邀请。"," ",(0,l.jsx)(J,{href:"https://docs.litellm.ai/docs/proxy/email",target:"_blank",children:"查看邮件通知配置方法"})]}),type:"info",showIcon:!0,className:"mb-4"}),(0,l.jsx)(x.A.Item,{label:"用户名",name:"user_email",children:(0,l.jsx)(m.A,{placeholder:"请输入用户名"})}),(0,l.jsx)(x.A.Item,{label:"用户角色",name:"user_role",children:(0,l.jsx)(c.A,{placeholder:"请选择角色",children:o&&Object.entries(o).map(([e,{ui_label:s,description:t}])=>(0,l.jsx)(d.A,{value:e,title:s,children:(0,l.jsxs)("div",{className:"flex",children:[s," ",(0,l.jsx)(K,{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:t})]})},e))})}),(0,l.jsx)(x.A.Item,{label:"分组",name:"team_id",children:(0,l.jsx)(c.A,{placeholder:"选择分组",style:{width:"100%"},children:(0,l.jsx)(D.A,{teams:t})})}),(0,l.jsx)(x.A.Item,{label:"元数据",name:"metadata",children:(0,l.jsx)(h.A.TextArea,{rows:4,placeholder:"请输入 JSON 格式元数据"})}),(0,l.jsx)(x.A.Item,{label:"预算上限",name:"max_budget",tooltip:"留空表示不限额",children:(0,l.jsx)(j.A,{min:0,step:.01,style:{width:"100%"},placeholder:"例如 100"})}),(0,l.jsx)(x.A.Item,{label:"预算重置周期",name:"budget_duration",children:(0,l.jsx)(R.A,{onChange:e=>C.setFieldValue("budget_duration",e)})}),(0,l.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,l.jsx)(g.Ay,{htmlType:"submit",children:"创建用户"})})]}):(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(n.A,{className:"mb-0",onClick:()=>k(!0),children:"+ 创建用户"}),(0,l.jsx)(M,{accessToken:s,teams:t,possibleUIRoles:o}),(0,l.jsxs)(p.A,{title:"创建用户",open:S,width:800,footer:null,onOk:()=>{k(!1),C.resetFields()},onCancel:()=>{k(!1),L(!1),C.resetFields()},children:[(0,l.jsx)(b.A,{direction:"vertical",size:"middle",style:{marginBottom:28},children:(0,l.jsx)(K,{children:"创建可管理密钥的用户"})}),(0,l.jsxs)(x.A,{form:C,onFinish:H,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:[(0,l.jsx)(x.A.Item,{label:"用户名",name:"user_email",style:{marginBottom:28},children:(0,l.jsx)(h.A,{placeholder:"请输入用户名"})}),(0,l.jsx)(x.A.Item,{style:{marginBottom:28},label:(0,l.jsxs)("span",{children:["角色"," ",(0,l.jsx)(f.A,{title:"该角色独立于任何分组/组织角色。分组/组织管理员请在设置中配置。",children:(0,l.jsx)(a.A,{})})]}),name:"user_role",children:(0,l.jsx)(c.A,{placeholder:"请选择角色",children:o&&Object.entries(o).map(([e,{ui_label:s,description:t}])=>(0,l.jsxs)(d.A,{value:e,title:s,children:[(0,l.jsx)(K,{children:s}),(0,l.jsxs)(K,{type:"secondary",children:[" - ",t]})]},e))})}),(0,l.jsx)(x.A.Item,{label:"分组",name:"team_id",help:"选择后，用户会以“user”角色加入该分组。",style:{marginBottom:44},children:(0,l.jsx)(D.A,{teams:t})}),(0,l.jsx)(x.A.Item,{style:{marginBottom:44},label:(0,l.jsxs)("span",{children:["模型"," ",(0,l.jsx)(f.A,{title:"用户在分组范围外可访问的模型。",children:(0,l.jsx)(a.A,{style:{marginLeft:"4px"}})})]}),name:"models",help:"用户在分组范围外可访问的模型。",children:(0,l.jsxs)(c.A,{mode:"multiple",placeholder:"选择模型",style:{width:"100%"},children:[(0,l.jsx)(c.A.Option,{value:"all-proxy-models",children:"全部模型"},"all-proxy-models"),(0,l.jsx)(c.A.Option,{value:"no-default-models",children:"无默认模型"},"no-default-models"),E.map(e=>(0,l.jsx)(c.A.Option,{value:e,children:(0,T.$L)(e)},e))]})}),(0,l.jsx)(x.A.Item,{label:"预算上限",name:"max_budget",tooltip:"留空表示不限额",help:"限制该用户的可用预算，留空表示无限制。",style:{marginBottom:44},children:(0,l.jsx)(j.A,{min:0,step:.01,style:{width:"100%"},placeholder:"例如 100"})}),(0,l.jsx)(x.A.Item,{label:"预算重置周期",name:"budget_duration",help:"可选。设置后按周期自动重置预算。",style:{marginBottom:44},children:(0,l.jsx)(R.A,{onChange:e=>C.setFieldValue("budget_duration",e)})}),(0,l.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,l.jsx)(g.Ay,{type:"primary",icon:(0,l.jsx)(r.A,{}),htmlType:"submit",children:"创建用户"})})]})]}),V&&(0,l.jsx)(P.A,{isInvitationLinkModalVisible:U,setIsInvitationLinkModalVisible:O,baseUrl:q||"",invitationLinkData:B})]})}},48812:(e,s,t)=>{t.d(s,{A:()=>c});var l=t(95155);t(12115);var a=t(41326),r=t(3373),i=t(99312),n=t(50410),d=t(12120),m=t(14290);function c({isInvitationLinkModalVisible:e,setIsInvitationLinkModalVisible:s,baseUrl:t,invitationLinkData:c,modalType:o="invitation"}){let{t:x}=(0,m.o)(),{Paragraph:u}=a.A,h=()=>{if(!t)return"";let e=new URL(t).pathname,s=e&&"/"!==e?`${e}/ui`:"ui";if(c?.has_user_setup_sso)return new URL(s,t).toString();let l=`${s}?invitation_id=${c?.id}`;return"resetPassword"===o&&(l+="&action=reset_password"),new URL(l,t).toString()};return(0,l.jsxs)(r.A,{title:"invitation"===o?x("onboardingModal.invitation.title"):x("onboardingModal.resetPassword.title"),open:e,width:800,footer:null,onOk:()=>{s(!1)},onCancel:()=>{s(!1)},children:[(0,l.jsx)(u,{children:"invitation"===o?x("onboardingModal.invitation.description"):x("onboardingModal.resetPassword.description")}),(0,l.jsxs)("div",{className:"flex justify-between pt-5 pb-2",children:[(0,l.jsx)(n.E,{className:"text-base",children:x("onboardingModal.userId")}),(0,l.jsx)(n.E,{children:c?.user_id})]}),(0,l.jsxs)("div",{className:"flex justify-between pt-5 pb-2",children:[(0,l.jsx)(n.E,{children:"invitation"===o?x("onboardingModal.invitation.linkLabel"):x("onboardingModal.resetPassword.linkLabel")}),(0,l.jsx)(n.E,{children:(0,l.jsx)(n.E,{children:h()})})]}),(0,l.jsx)("div",{className:"flex justify-end mt-5",children:(0,l.jsx)(i.CopyToClipboard,{text:h(),onCopy:()=>d.Ay.success(x("onboardingModal.copied")),children:(0,l.jsx)(n.$,{variant:"primary",children:"invitation"===o?x("onboardingModal.invitation.copyButton"):x("onboardingModal.resetPassword.copyButton")})})})]})}},50410:(e,s,t)=>{t.d(s,{$:()=>l.A,E:()=>a.A});var l=t(38983),a=t(75892)},67667:(e,s,t)=>{t.d(s,{$:()=>l.A});var l=t(38983)},96130:(e,s,t)=>{t.d(s,{Kp:()=>i.A,T2:()=>n.A,fu:()=>a.A,oz:()=>l.A,wb:()=>r.A});var l=t(2212),a=t(87927),r=t(56680),i=t(73806),n=t(79363)}}]);