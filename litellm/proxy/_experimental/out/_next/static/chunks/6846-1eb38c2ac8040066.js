"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6846],{36846:(e,s,l)=>{l.d(s,{A:()=>eL});var t=l(95155),r=l(96130),a=l(12115),i=l(67667),n=l(41326),d=l(87056),o=l(3373),c=l(61484),u=l(50139),m=l(7339),x=l(69779),h=l(54481),g=l(23060),j=l(8208),p=l(28436),f=l(94300),_=l(38983),y=l(22054),b=l(34487),v=l(72473),A=l(25387),S=l(22277),N=l(90550),w=l(32521),k=l(64601),E=l(66904),C=l(14290);function I({userData:e,onCancel:s,onSubmit:l,teams:r,accessToken:i,userID:n,userRole:d,userModels:o,possibleUIRoles:u,isBulkEdit:m=!1}){let{t:x}=(0,C.o)(),[h]=A.A.useForm(),[j,p]=(0,a.useState)(!1);return a.useEffect(()=>{let s=e.user_info?.max_budget,l=null==s;p(l),h.setFieldsValue({user_id:e.user_id,user_email:e.user_info?.user_email,user_alias:e.user_info?.user_alias,user_role:e.user_info?.user_role,models:e.user_info?.models||[],max_budget:l?"":s,budget_duration:e.user_info?.budget_duration,metadata:e.user_info?.metadata?JSON.stringify(e.user_info.metadata,null,2):void 0})},[e,h]),(0,t.jsxs)(A.A,{form:h,onFinish:e=>{if(e.metadata&&"string"==typeof e.metadata)try{e.metadata=JSON.parse(e.metadata)}catch(e){console.error("Error parsing metadata JSON:",e);return}(j||""===e.max_budget||void 0===e.max_budget)&&(e.max_budget=null),l(e)},layout:"vertical",children:[!m&&(0,t.jsx)(A.A.Item,{label:x("users.userEdit.userId"),name:"user_id",children:(0,t.jsx)(b.A,{disabled:!0})}),!m&&(0,t.jsx)(A.A.Item,{label:x("users.userEdit.email"),name:"user_email",children:(0,t.jsx)(b.A,{placeholder:x("users.userEdit.inputPlaceholder")})}),(0,t.jsx)(A.A.Item,{label:x("users.userEdit.userAlias"),name:"user_alias",children:(0,t.jsx)(b.A,{placeholder:x("users.userEdit.inputPlaceholder")})}),(0,t.jsx)(A.A.Item,{label:(0,t.jsxs)("span",{children:[x("users.userEdit.globalProxyRole")," ",(0,t.jsx)(S.A,{title:x("users.userEdit.globalProxyRoleTooltip"),children:(0,t.jsx)(f.A,{})})]}),name:"user_role",children:(0,t.jsx)(g.A,{children:u&&Object.entries(u).map(([e,{ui_label:s,description:l}])=>(0,t.jsx)(y.A,{value:e,title:s,children:(0,t.jsxs)("div",{className:"flex",children:[s," ",(0,t.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:l})]})},e))})}),(0,t.jsx)(A.A.Item,{label:(0,t.jsxs)("span",{children:[x("users.userEdit.personalModels")," ",(0,t.jsx)(S.A,{title:x("users.userEdit.personalModelsTooltip"),children:(0,t.jsx)(f.A,{style:{marginLeft:"4px"}})})]}),name:"models",children:(0,t.jsxs)(g.A,{mode:"multiple",placeholder:x("users.userEdit.personalModelsPlaceholder"),style:{width:"100%"},disabled:!N.CX.includes(d||""),children:[(0,t.jsx)(g.A.Option,{value:"all-proxy-models",children:x("users.userEdit.allProxyModels")},"all-proxy-models"),(0,t.jsx)(g.A.Option,{value:"no-default-models",children:x("users.userEdit.noDefaultModels")},"no-default-models"),o.map(e=>(0,t.jsx)(g.A.Option,{value:e,children:(0,k.$L)(e)},e))]})}),(0,t.jsx)(A.A.Item,{label:(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,t.jsx)("span",{children:x("users.userEdit.maxBudget")}),(0,t.jsx)(c.A,{checked:j,onChange:e=>{let s=e.target.checked;p(s),s&&h.setFieldsValue({max_budget:""})},children:x("users.userEdit.unlimitedBudget")})]}),name:"max_budget",rules:[{validator:(e,s)=>j||""!==s&&null!=s?Promise.resolve():Promise.reject(Error(x("users.userEdit.maxBudgetValidation")))}],children:(0,t.jsx)(E.A,{step:.01,precision:2,style:{width:"100%"},disabled:j})}),(0,t.jsx)(A.A.Item,{label:x("users.userEdit.resetBudget"),name:"budget_duration",children:(0,t.jsx)(w.A,{})}),(0,t.jsx)(A.A.Item,{label:x("users.userEdit.metadata"),name:"metadata",children:(0,t.jsx)(v.A,{rows:4,placeholder:x("users.userEdit.metadataPlaceholder")})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(_.A,{variant:"secondary",type:"button",onClick:s,children:x("users.userEdit.cancel")}),(0,t.jsx)(_.A,{type:"submit",children:x("users.userEdit.saveChanges")})]})]})}var D=l(12120);let{Text:Y,Title:U}=n.A,$=({open:e,onCancel:s,selectedUsers:l,possibleUIRoles:r,accessToken:i,onSuccess:n,teams:f,userRole:_,userModels:y,allowAllUsers:b=!1})=>{let[v,A]=(0,a.useState)(!1),[S,N]=(0,a.useState)([]),[w,k]=(0,a.useState)(null),[E,C]=(0,a.useState)(!1),[$,B]=(0,a.useState)(!1),L=()=>{N([]),k(null),C(!1),B(!1),s()},z=a.useMemo(()=>({user_id:"bulk_edit",user_info:{user_email:"",user_role:"",teams:[],models:[],max_budget:null,spend:0,metadata:{},created_at:null,updated_at:null},keys:[],teams:f||[]}),[f,e]),O=async e=>{if(console.log("formValues",e),!i)return void D.Ay.fromBackend("Access token not found");A(!0);try{let t=l.map(e=>e.user_id),r={};e.user_role&&""!==e.user_role&&(r.user_role=e.user_role),null!==e.max_budget&&void 0!==e.max_budget&&(r.max_budget=e.max_budget),e.models&&e.models.length>0&&(r.models=e.models),e.budget_duration&&""!==e.budget_duration&&(r.budget_duration=e.budget_duration),e.metadata&&Object.keys(e.metadata).length>0&&(r.metadata=e.metadata);let a=Object.keys(r).length>0,o=E&&S.length>0;if(!a&&!o)return void D.Ay.fromBackend("Please modify at least one field or select teams to add users to");let c=[];if(a)if($){let e=await (0,p.userBulkUpdateUserCall)(i,r,void 0,!0);c.push(`Updated all users (${e.total_requested} total)`)}else await (0,p.userBulkUpdateUserCall)(i,r,t),c.push(`Updated ${t.length} user(s)`);if(o){let e=[];for(let s of S)try{let t=null;t=$?null:l.map(e=>({user_id:e.user_id,role:"user",user_email:e.user_email||null}));let r=await (0,p.teamBulkMemberAddCall)(i,s,t||null,w||void 0,$);console.log("result",r),e.push({teamId:s,success:!0,successfulAdditions:r.successful_additions,failedAdditions:r.failed_additions})}catch(l){console.error(`Failed to add users to team ${s}:`,l),e.push({teamId:s,success:!1,error:l})}let s=e.filter(e=>e.success),t=e.filter(e=>!e.success);if(s.length>0){let e=s.reduce((e,s)=>e+s.successfulAdditions,0);c.push(`Added users to ${s.length} team(s) (${e} total additions)`)}t.length>0&&d.Ay.warning(`Failed to add users to ${t.length} team(s)`)}c.length>0&&D.Ay.success(c.join(". ")),N([]),k(null),C(!1),B(!1),n(),s()}catch(e){console.error("Bulk operation failed:",e),D.Ay.fromBackend("Failed to perform bulk operations")}finally{A(!1)}};return(0,t.jsxs)(o.A,{open:e,onCancel:L,footer:null,title:$?"Bulk Edit All Users":`Bulk Edit ${l.length} User(s)`,width:800,children:[b&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)(c.A,{checked:$,onChange:e=>B(e.target.checked),children:(0,t.jsx)(Y,{strong:!0,children:"Update ALL users in the system"})}),$&&(0,t.jsx)("div",{style:{marginTop:8},children:(0,t.jsx)(Y,{type:"warning",style:{fontSize:"12px"},children:"⚠️ This will apply changes to ALL users in the system, not just the selected ones."})})]}),!$&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)(U,{level:5,children:["Selected Users (",l.length,"):"]}),(0,t.jsx)(u.A,{size:"small",bordered:!0,dataSource:l,pagination:!1,scroll:{y:200},rowKey:"user_id",columns:[{title:"User ID",dataIndex:"user_id",key:"user_id",width:"30%",render:e=>(0,t.jsx)(Y,{strong:!0,style:{fontSize:"12px"},children:e.length>20?`${e.slice(0,20)}...`:e})},{title:"Email",dataIndex:"user_email",key:"user_email",width:"25%",render:e=>(0,t.jsx)(Y,{type:"secondary",style:{fontSize:"12px"},children:e||"No email"})},{title:"Current Role",dataIndex:"user_role",key:"user_role",width:"25%",render:e=>(0,t.jsx)(Y,{style:{fontSize:"12px"},children:r?.[e]?.ui_label||e})},{title:"Budget",dataIndex:"max_budget",key:"max_budget",width:"20%",render:e=>(0,t.jsx)(Y,{style:{fontSize:"12px"},children:null!==e?`\xa5${e}`:"Unlimited"})}]})]}),(0,t.jsx)(m.A,{}),(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)(Y,{children:[(0,t.jsx)("strong",{children:"Instructions:"})," Fill in the fields below with the values you want to apply to all selected users. You can bulk edit: role, budget, models, and metadata. You can also add users to teams."]})}),(0,t.jsx)(x.A,{title:"Team Management",size:"small",className:"mb-4",style:{backgroundColor:"#fafafa"},children:(0,t.jsxs)(h.A,{direction:"vertical",style:{width:"100%"},children:[(0,t.jsx)(c.A,{checked:E,onChange:e=>C(e.target.checked),children:"Add selected users to teams"}),E&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(Y,{strong:!0,children:"Select Teams:"}),(0,t.jsx)(g.A,{mode:"multiple",placeholder:"Select teams to add users to",value:S,onChange:N,style:{width:"100%",marginTop:8},options:f?.map(e=>({label:e.team_alias||e.team_id,value:e.team_id}))||[]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(Y,{strong:!0,children:"Team Budget (Optional):"}),(0,t.jsx)(j.A,{placeholder:"Max budget per user in team",value:w,onChange:e=>k(e),style:{width:"100%",marginTop:8},min:0,step:.01,precision:2}),(0,t.jsx)(Y,{type:"secondary",style:{fontSize:"12px"},children:"Leave empty for unlimited budget within team limits"})]}),(0,t.jsx)(Y,{type:"secondary",style:{fontSize:"12px"},children:'Users will be added with "user" role by default. All users will be added to each selected team.'})]})]})}),(0,t.jsx)(I,{userData:z,onCancel:L,onSubmit:O,teams:f,accessToken:i,userID:"bulk_edit",userRole:_,userModels:y,possibleUIRoles:r,isBulkEdit:!0}),v&&(0,t.jsx)("div",{style:{textAlign:"center",marginTop:"10px"},children:(0,t.jsxs)(Y,{children:["Updating ",$?"all users":l.length," user(s)..."]})})]})};var B=l(48154),L=l(87278);let z=({visible:e,possibleUIRoles:s,onCancel:l,user:r,onSubmit:i})=>{let[n,d]=(0,a.useState)(r),[c]=A.A.useForm();(0,a.useEffect)(()=>{c.resetFields()},[r]);let u=async()=>{c.resetFields(),l()},m=async e=>{i(e),c.resetFields(),l()};return r?(0,t.jsx)(o.A,{open:e,onCancel:u,footer:null,title:"Edit User "+r.user_id,width:1e3,children:(0,t.jsx)(A.A,{form:c,onFinish:m,initialValues:r,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.A.Item,{className:"mt-8",label:"User Email",tooltip:"Email of the User",name:"user_email",children:(0,t.jsx)(b.A,{})}),(0,t.jsx)(A.A.Item,{label:"user_id",name:"user_id",hidden:!0,children:(0,t.jsx)(b.A,{})}),(0,t.jsx)(A.A.Item,{label:"User Role",name:"user_role",children:(0,t.jsx)(g.A,{children:s&&Object.entries(s).map(([e,{ui_label:s,description:l}])=>(0,t.jsx)(y.A,{value:e,title:s,children:(0,t.jsxs)("div",{className:"flex",children:[s," ",(0,t.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:l})]})},e))})}),(0,t.jsx)(A.A.Item,{label:"花费",name:"spend",tooltip:"(float) - Spend of all LLM calls completed by this user",help:"Across all keys (including keys with team_id).",children:(0,t.jsx)(j.A,{min:0,step:.01})}),(0,t.jsx)(A.A.Item,{label:"用户预算",name:"max_budget",tooltip:"(float) - Maximum budget of this user",help:"Maximum budget of this user.",children:(0,t.jsx)(E.A,{min:0,step:.01})}),(0,t.jsx)(A.A.Item,{label:"Reset Budget",name:"budget_duration",children:(0,t.jsx)(w.A,{})}),(0,t.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,t.jsx)(L.Ay,{htmlType:"submit",children:"Save"})}),(0,t.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,t.jsx)(L.Ay,{htmlType:"submit",children:"Save"})})]})})}):null};var O=l(48812),T=l(88534),F=l(5433),R=l(35625),M=l(26708),P=l(66793),K=l(77258),V=l(16989),Z=l(95049),q=l(24611),H=l(22864);let J={"view/create/delete their own keys, view their own spend":"可查看/创建/删除自己的密钥，并查看自己的花费","view their own keys, view their own spend":"仅可查看自己的密钥和花费"},G={"Default role assigned to new users created":"users.defaultSettings.fieldDescriptions.userRole","Default maximum budget (in USD) for new users created":"users.defaultSettings.fieldDescriptions.maxBudget","Default budget duration for new users (e.g. 'daily', 'weekly', 'monthly')":"users.defaultSettings.fieldDescriptions.budgetDuration","Default allowed models for new users":"users.defaultSettings.fieldDescriptions.models","Default team assignments for new users":"users.defaultSettings.fieldDescriptions.teams"},Q=({accessToken:e,possibleUIRoles:s,userID:l,userRole:r})=>{var i;let{t:d}=(0,C.o)(),[o,c]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(!1),[f,_]=(0,a.useState)({}),[y,b]=(0,a.useState)(!1),[v,A]=(0,a.useState)([]),{Paragraph:S}=n.A,{Option:N}=g.A;(0,a.useEffect)(()=>{(async()=>{if(!e)return c(!1);try{let s=await (0,p.getInternalUserSettings)(e);if(m(s),_(s.values||{}),e)try{let s=await (0,p.modelAvailableCall)(e,l,r);if(s&&s.data){let e=s.data.map(e=>e.id);A(e)}}catch(e){console.error("Error fetching available models:",e)}}catch(e){console.error("Error fetching SSO settings:",e),D.Ay.fromBackend("Failed to fetch SSO settings")}finally{c(!1)}})()},[e]);let E=async()=>{if(e){b(!0);try{let s=Object.entries(f).reduce((e,[s,l])=>(e[s]=""===l?null:l,e),{}),l=await (0,p.updateInternalUserSettings)(e,s);m({...u,values:l.settings}),h(!1)}catch(e){console.error("Error updating SSO settings:",e),D.Ay.fromBackend("Failed to update settings: "+e)}finally{b(!1)}}},I=(e,s)=>{_(l=>({...l,[e]:s}))},Y=e=>e&&Array.isArray(e)?e.map(e=>"string"==typeof e?{team_id:e,user_role:"user"}:"object"==typeof e&&e.team_id?{team_id:e.team_id,max_budget_in_team:e.max_budget_in_team,user_role:e.user_role||"user"}:{team_id:"",user_role:"user"}):[];return o?(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)(Z.A,{size:"large"})}):u?(0,t.jsxs)(K.Zp,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(K.hE,{children:d("users.defaultSettings.title")}),!o&&u&&(x?(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(K.$n,{variant:"secondary",onClick:()=>{h(!1),_(u.values||{})},disabled:y,children:d("users.defaultSettings.cancel")}),(0,t.jsx)(K.$n,{onClick:E,loading:y,children:d("users.defaultSettings.saveChanges")})]}):(0,t.jsx)(K.$n,{onClick:()=>h(!0),children:d("users.defaultSettings.editSettings")}))]}),u?.field_schema?.description&&(0,t.jsx)(S,{className:"mb-4",children:(i=u.field_schema.description)?i.includes("Default parameters to apply when a new user signs in via SSO")?d("users.defaultSettings.schemaDescription"):i:""}),(0,t.jsx)(K.cG,{}),(0,t.jsx)("div",{className:"mt-4 space-y-4",children:(()=>{let{values:e,field_schema:l}=u;return l&&l.properties?Object.entries(l.properties).map(([l,r])=>{let a=e[l],i={user_role:d("users.defaultSettings.fieldLabels.userRole"),max_budget:d("users.defaultSettings.fieldLabels.maxBudget"),budget_duration:d("users.defaultSettings.fieldLabels.budgetDuration"),models:d("users.defaultSettings.fieldLabels.models"),teams:d("users.defaultSettings.fieldLabels.teams")}[l]||l.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),n=((e,s)=>{let l={user_role:d("users.defaultSettings.fieldDescriptions.userRole"),max_budget:d("users.defaultSettings.fieldDescriptions.maxBudget"),budget_duration:d("users.defaultSettings.fieldDescriptions.budgetDuration"),models:d("users.defaultSettings.fieldDescriptions.models"),teams:d("users.defaultSettings.fieldDescriptions.teams")};if(l[e])return l[e];if(s){let e=G[s];return e?d(e):s}return d("users.defaultSettings.noDescription")})(l,r.description);return(0,t.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200 last:border-0",children:[(0,t.jsx)(K.EY,{className:"font-medium text-lg",children:i}),(0,t.jsx)(S,{className:"text-sm text-gray-500 mt-1",children:n}),x?(0,t.jsx)("div",{className:"mt-2",children:((e,l,r)=>{let a=l.type;if("teams"===e){let s,l;return(0,t.jsx)("div",{className:"mt-2",children:(s=Y(f[e]||[]),l=(e,l,t)=>{let r=[...s];r[e]={...r[e],[l]:t},I("teams",r)},(0,t.jsxs)("div",{className:"space-y-3",children:[s.map((e,r)=>(0,t.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)(K.EY,{className:"font-medium",children:[d("users.defaultSettings.team")," ",r+1]}),(0,t.jsx)(K.$n,{size:"sm",variant:"secondary",icon:q.A,onClick:()=>{I("teams",s.filter((e,s)=>s!==r))},className:"text-red-500 hover:text-red-700",children:d("users.defaultSettings.remove")})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(K.EY,{className:"text-sm font-medium mb-1",children:d("users.defaultSettings.teamId")}),(0,t.jsx)(K.ks,{value:e.team_id,onChange:e=>l(r,"team_id",e.target.value),placeholder:d("users.defaultSettings.teamIdPlaceholder")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(K.EY,{className:"text-sm font-medium mb-1",children:d("users.defaultSettings.maxBudget")}),(0,t.jsx)(j.A,{style:{width:"100%"},value:e.max_budget_in_team,onChange:e=>l(r,"max_budget_in_team",e),placeholder:d("users.defaultSettings.notSpecified"),min:0,step:.01,precision:2})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(K.EY,{className:"text-sm font-medium mb-1",children:d("users.defaultSettings.userRole")}),(0,t.jsxs)(g.A,{style:{width:"100%"},value:e.user_role,onChange:e=>l(r,"user_role",e),children:[(0,t.jsx)(N,{value:"user",children:d("users.defaultSettings.userRoleUser")}),(0,t.jsx)(N,{value:"admin",children:d("users.defaultSettings.userRoleAdmin")})]})]})]})]},r)),(0,t.jsx)(K.$n,{variant:"secondary",icon:H.A,onClick:()=>{I("teams",[...s,{team_id:"",user_role:"user"}])},className:"w-full",children:d("users.defaultSettings.addTeam")})]}))})}{if("user_role"===e&&s)return(0,t.jsx)(g.A,{style:{width:"100%"},value:f[e]||"",onChange:s=>I(e,s),className:"mt-2",children:Object.entries(s).filter(([e])=>e.includes("internal_user")).map(([e,{ui_label:s,description:l}])=>(0,t.jsx)(N,{value:e,children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{children:s}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:l?J[l]||l:""})]})},e))});if("budget_duration"===e)return(0,t.jsx)(w.A,{value:f[e]||null,onChange:s=>I(e,s),className:"mt-2"});if("boolean"===a)return(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(V.A,{checked:!!f[e],onChange:s=>I(e,s)})});if("array"===a&&l.items?.enum)return(0,t.jsx)(g.A,{mode:"multiple",style:{width:"100%"},value:f[e]||[],onChange:s=>I(e,s),className:"mt-2",children:l.items.enum.map(e=>(0,t.jsx)(N,{value:e,children:e},e))});if("models"===e)return(0,t.jsxs)(g.A,{mode:"multiple",style:{width:"100%"},value:f[e]||[],onChange:s=>I(e,s),className:"mt-2",children:[(0,t.jsx)(N,{value:"no-default-models",children:d("users.defaultSettings.noDefaultModels")},"no-default-models"),(0,t.jsx)(N,{value:"all-proxy-models",children:d("users.defaultSettings.allProxyModels")},"all-proxy-models"),v.map(e=>(0,t.jsx)(N,{value:e,children:(0,k.$L)(e)},e))]});if("string"===a&&l.enum)return(0,t.jsx)(g.A,{style:{width:"100%"},value:f[e]||"",onChange:s=>I(e,s),className:"mt-2",children:l.enum.map(e=>(0,t.jsx)(N,{value:e,children:e},e))});if("number"===a||"integer"===a)return(0,t.jsx)(j.A,{style:{width:"100%"},value:null===f[e]||void 0===f[e]?void 0:f[e],onChange:s=>I(e,s),placeholder:d("users.defaultSettings.notSpecified"),className:"mt-2"});let r=l.description,i=r&&G[r]?d(G[r]):r||"";return(0,t.jsx)(K.ks,{value:null===f[e]||void 0===f[e]?"":String(f[e]),onChange:s=>I(e,s.target.value),placeholder:i,className:"mt-2"})}})(l,r,0)}):(0,t.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded",children:((e,l)=>{if(null==l)return(0,t.jsx)("span",{className:"text-gray-400",children:d("users.defaultSettings.notSet")});if("teams"===e&&Array.isArray(l)){if(0===l.length)return(0,t.jsx)("span",{className:"text-gray-400",children:d("users.defaultSettings.noTeamsAssigned")});let e=Y(l);return(0,t.jsx)("div",{className:"space-y-2 mt-1",children:e.map((e,s)=>(0,t.jsx)("div",{className:"border rounded-lg p-3 bg-white",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:d("users.defaultSettings.teamIdLabel")}),(0,t.jsx)("p",{className:"text-gray-900",children:e.team_id||d("users.defaultSettings.notSpecified")})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-medium text-gray-600",children:[d("users.defaultSettings.maxBudget"),":"]}),(0,t.jsx)("p",{className:"text-gray-900",children:void 0!==e.max_budget_in_team?`\xa5${(0,T.HY)(e.max_budget_in_team,4)}`:d("users.defaultSettings.noLimit")})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"font-medium text-gray-600",children:[d("users.defaultSettings.role"),":"]}),(0,t.jsx)("p",{className:"text-gray-900 capitalize",children:e.user_role})]})]})},s))})}if("user_role"===e&&s&&s[l]){let{ui_label:e,description:r}=s[l];return(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:e}),r&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:J[r]||r})]})}if("budget_duration"===e)return(0,t.jsx)("span",{children:(0,w.C)(l)});if("boolean"==typeof l)return(0,t.jsx)("span",{children:l?d("users.defaultSettings.enabled"):d("users.defaultSettings.disabled")});if("models"===e&&Array.isArray(l))return 0===l.length?(0,t.jsx)("span",{className:"text-gray-400",children:d("users.defaultSettings.none")}):(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:l.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:(0,k.$L)(e)},s))});if("object"==typeof l)return Array.isArray(l)?0===l.length?(0,t.jsx)("span",{className:"text-gray-400",children:d("users.defaultSettings.none")}):(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:l.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:"object"==typeof e?JSON.stringify(e):String(e)},s))}):(0,t.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(l,null,2)});return(0,t.jsx)("span",{children:String(l)})})(l,a)})]},l)}):(0,t.jsx)(K.EY,{children:d("users.defaultSettings.noSchema")})})()})]}):(0,t.jsx)(K.Zp,{children:(0,t.jsx)(K.EY,{children:d("users.defaultSettings.notAvailable")})})};var W=l(34254),X=l(13121),ee=l(19602),es=l(55012),el=l(55726),et=l(45588),er=l(73317);let ea=(e,s,l,r,a,i)=>{let n=[{header:"用户 ID",accessorKey:"user_id",enableSorting:!0,cell:({row:e})=>(0,t.jsx)(S.A,{title:e.original.user_id,children:(0,t.jsx)("span",{className:"text-xs",children:e.original.user_id?`${e.original.user_id.slice(0,7)}...`:"-"})})},{header:"用户名",accessorKey:"user_email",enableSorting:!0,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:e.original.user_email||"-"})},{header:"全局代理角色",accessorKey:"user_role",enableSorting:!0,cell:({row:s})=>(0,t.jsx)("span",{className:"text-xs",children:e?.[s.original.user_role]?.ui_label||"-"})},{header:"花费",accessorKey:"spend",enableSorting:!0,cell:({row:e})=>{let s=e.original.spend;return(0,t.jsx)("span",{className:"text-xs",children:null!=s?`\xa5${(0,T.HY)(s,4)}`:"-"})}},{header:"预算",accessorKey:"max_budget",enableSorting:!1,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:null!==e.original.max_budget?e.original.max_budget:"不限制"})},{header:()=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"SSO ID"}),(0,t.jsx)(S.A,{title:"SSO ID 是用户在 SSO 提供方中的标识。若用户未使用 SSO，则为空。",children:(0,t.jsx)(es.A,{className:"w-4 h-4"})})]}),accessorKey:"sso_user_id",enableSorting:!1,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:null!==e.original.sso_user_id?e.original.sso_user_id:"-"})},{header:"API密钥",accessorKey:"key_count",enableSorting:!1,cell:({row:e})=>(0,t.jsx)(X.A,{numItems:2,children:e.original.key_count>0?(0,t.jsxs)(W.A,{size:"xs",color:"indigo",children:[e.original.key_count," ",(e.original.key_count,"个密钥")]}):(0,t.jsx)(W.A,{size:"xs",color:"gray",children:"无密钥"})})},{header:"创建时间",accessorKey:"created_at",enableSorting:!0,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:e.original.created_at?new Date(e.original.created_at).toLocaleDateString():"-"})},{header:"更新时间",accessorKey:"updated_at",enableSorting:!1,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:e.original.updated_at?new Date(e.original.updated_at).toLocaleDateString():"-"})},{id:"actions",header:"操作",enableSorting:!1,cell:({row:e})=>(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(S.A,{title:"编辑用户详情",children:(0,t.jsx)(ee.A,{icon:el.A,size:"sm",onClick:()=>a(e.original.user_id,!0),className:"cursor-pointer hover:text-blue-600"})}),(0,t.jsx)(S.A,{title:"删除用户",children:(0,t.jsx)(ee.A,{icon:et.A,size:"sm",onClick:()=>l(e.original),className:"cursor-pointer hover:text-red-600"})}),(0,t.jsx)(S.A,{title:"重置密码",children:(0,t.jsx)(ee.A,{icon:er.A,size:"sm",onClick:()=>r(e.original.user_id),className:"cursor-pointer hover:text-green-600"})})]})}];if(i){let{onSelectUser:e,onSelectAll:s,isUserSelected:l,isAllSelected:r,isIndeterminate:a}=i;return[{id:"select",enableSorting:!1,header:()=>(0,t.jsx)(c.A,{indeterminate:a,checked:r,onChange:e=>s(e.target.checked),onClick:e=>e.stopPropagation()}),cell:({row:s})=>(0,t.jsx)(c.A,{checked:l(s.original),onChange:l=>e(s.original,l.target.checked),onClick:e=>e.stopPropagation()})},...n]}return n},ei={proxy_admin:"管理员（全部权限）",proxy_admin_viewer:"管理员（仅查看）",internal_user:"内部用户（可创建/删除/查看）",internal_user_viewer:"内部用户（仅查看）"},en={"Admin (All Permissions)":"管理员（全部权限）","Admin (View Only)":"管理员（仅查看）","Internal User (Create/Delete/View)":"内部用户（可创建/删除/查看）","Internal User (View Only)":"内部用户（仅查看）"};var ed=l(37621),eo=l(3134),ec=l(39197),eu=l(30489),em=l(96961),ex=l(95517),eh=l(8179),eg=l(31556),ej=l(95171),ep=l(14992),ef=l(17293),e_=l(73946),ey=l(8536),eb=l(16252),ev=l(44926),eA=l(94514),eS=l(67635);function eN({userId:e,onClose:s,accessToken:l,userRole:r,onDelete:i,possibleUIRoles:n,initialTab:d=0,startInEditMode:o=!1}){let[c,u]=(0,a.useState)(null),[m,x]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),[j,f]=(0,a.useState)(!0),[_,y]=(0,a.useState)(o),[b,v]=(0,a.useState)([]),[A,S]=(0,a.useState)(!1),[k,E]=(0,a.useState)(null),[C,Y]=(0,a.useState)(null),[U,$]=(0,a.useState)(d),[B,z]=(0,a.useState)({}),[F,R]=(0,a.useState)(!1);a.useEffect(()=>{Y((0,p.getProxyBaseUrl)())},[]),a.useEffect(()=>{console.log(`userId: ${e}, userRole: ${r}, accessToken: ${l}`),(async()=>{try{if(!l)return;let s=await (0,p.userInfoCall)(l,e,r||"",!1,null,null,!0);u(s);let t=(await (0,p.modelAvailableCall)(l,e,r||"")).data.map(e=>e.id);v(t)}catch(e){console.error("Error fetching user data:",e),D.Ay.fromBackend("获取用户数据失败")}finally{f(!1)}})()},[l,e,r]);let M=async()=>{if(!l)return void D.Ay.fromBackend("未找到访问令牌");try{D.Ay.success("正在生成重置密码链接...");let s=await (0,p.invitationCreateCall)(l,e);E(s),S(!0)}catch(e){D.Ay.fromBackend("生成重置密码链接失败")}},K=async()=>{try{if(!l)return;g(!0),await (0,p.userDeleteCall)(l,[e]),D.Ay.success("用户删除成功"),i&&i(),s()}catch(e){console.error("Error deleting user:",e),D.Ay.fromBackend("删除用户失败")}finally{x(!1),g(!1)}},V=async e=>{try{if(!l||!c)return;await (0,p.userUpdateUserCall)(l,e,null),u({...c,user_info:{...c.user_info,user_email:e.user_email,user_alias:e.user_alias,models:e.models,max_budget:e.max_budget,budget_duration:e.budget_duration,metadata:e.metadata}}),D.Ay.success("用户更新成功"),y(!1)}catch(e){console.error("Error updating user:",e),D.Ay.fromBackend("更新用户失败")}};if(j)return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)(eb.$n,{icon:ev.A,variant:"light",onClick:s,className:"mb-4",children:"返回用户列表"}),(0,t.jsx)(eb.EY,{children:"正在加载用户数据..."})]});if(!c)return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)(eb.$n,{icon:ev.A,variant:"light",onClick:s,className:"mb-4",children:"返回用户列表"}),(0,t.jsx)(eb.EY,{children:"未找到用户"})]});let Z=async(e,s)=>{await (0,T.lW)(e)&&(z(e=>({...e,[s]:!0})),setTimeout(()=>{z(e=>({...e,[s]:!1}))},2e3))};return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.$n,{icon:ev.A,variant:"light",onClick:s,className:"mb-4",children:"返回用户列表"}),(0,t.jsx)(eb.hE,{children:c.user_info?.user_email||"用户"}),(0,t.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,t.jsx)(eb.EY,{className:"text-gray-500 font-mono",children:c.user_id}),(0,t.jsx)(L.Ay,{type:"text",size:"small",icon:B["user-id"]?(0,t.jsx)(eA.A,{size:12}):(0,t.jsx)(eS.A,{size:12}),onClick:()=>Z(c.user_id,"user-id"),className:`left-2 z-10 transition-all duration-200 ${B["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),r&&N.FJ.includes(r)&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eb.$n,{icon:er.A,variant:"secondary",onClick:M,className:"flex items-center",children:"重置密码"}),(0,t.jsx)(eb.$n,{icon:et.A,variant:"secondary",onClick:()=>x(!0),className:"flex items-center text-red-500 border-red-500 hover:text-red-600 hover:border-red-600",children:"删除用户"})]})]}),(0,t.jsx)(P.A,{isOpen:m,title:"删除用户？",message:"确认删除该用户吗？此操作不可撤销。",resourceInformationTitle:"用户信息",resourceInformation:[{label:"邮箱",value:c.user_info?.user_email},{label:"用户 ID",value:c.user_id,code:!0},{label:"全局代理角色",value:c.user_info?.user_role&&n?.[c.user_info.user_role]?.ui_label||c.user_info?.user_role||"-"},{label:"总花费",value:c.user_info?.spend!==null&&c.user_info?.spend!==void 0?`\xa5${c.user_info.spend.toFixed(2)}`:void 0}],onCancel:()=>{x(!1)},onOk:K,confirmLoading:h}),(0,t.jsxs)(eb.fu,{defaultIndex:U,onIndexChange:$,children:[(0,t.jsxs)(eb.wb,{className:"mb-4",children:[(0,t.jsx)(eb.oz,{children:"概览"}),(0,t.jsx)(eb.oz,{children:"详情"})]}),(0,t.jsxs)(eb.T2,{children:[(0,t.jsx)(eb.Kp,{children:(0,t.jsxs)(eb.xA,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,t.jsxs)(eb.Zp,{children:[(0,t.jsx)(eb.EY,{children:"花费"}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsxs)(eb.hE,{children:["\xa5",(0,T.HY)(c.user_info?.spend||0,4)]}),(0,t.jsxs)(eb.EY,{children:["of"," ",c.user_info?.max_budget!==null?`\xa5${(0,T.HY)(c.user_info.max_budget,4)}`:"不限制"]})]})]}),(0,t.jsxs)(eb.Zp,{children:[(0,t.jsx)(eb.EY,{children:"分组"}),(0,t.jsx)("div",{className:"mt-2",children:c.teams?.length&&c.teams?.length>0?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[c.teams?.slice(0,F?c.teams.length:20).map((e,s)=>(0,t.jsx)(eb.Ex,{color:"blue",title:e.team_alias,children:e.team_alias},s)),!F&&c.teams?.length>20&&(0,t.jsxs)(eb.Ex,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>R(!0),children:["+",c.teams.length-20," 更多"]}),F&&c.teams?.length>20&&(0,t.jsx)(eb.Ex,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>R(!1),children:"收起"})]}):(0,t.jsx)(eb.EY,{children:"无分组"})})]}),(0,t.jsxs)(eb.Zp,{children:[(0,t.jsx)(eb.EY,{children:"API密钥"}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsxs)(eb.EY,{children:[c.keys?.length||0," ",(c.keys?.length,"个密钥")]})})]}),(0,t.jsxs)(eb.Zp,{children:[(0,t.jsx)(eb.EY,{children:"个人模型"}),(0,t.jsx)("div",{className:"mt-2",children:c.user_info?.models?.length&&c.user_info?.models?.length>0?c.user_info?.models?.map((e,s)=>(0,t.jsx)(eb.EY,{children:e},s)):(0,t.jsx)(eb.EY,{children:"全部模型"})})]})]})}),(0,t.jsx)(eb.Kp,{children:(0,t.jsxs)(eb.Zp,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(eb.hE,{children:"用户设置"}),!_&&r&&N.FJ.includes(r)&&(0,t.jsx)(eb.$n,{onClick:()=>y(!0),children:"编辑设置"})]}),_&&c?(0,t.jsx)(I,{userData:c,onCancel:()=>y(!1),onSubmit:V,teams:c.teams,accessToken:l,userID:e,userRole:r,userModels:b,possibleUIRoles:n}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"用户 ID"}),(0,t.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,t.jsx)(eb.EY,{className:"font-mono",children:c.user_id}),(0,t.jsx)(L.Ay,{type:"text",size:"small",icon:B["user-id"]?(0,t.jsx)(eA.A,{size:12}):(0,t.jsx)(eS.A,{size:12}),onClick:()=>Z(c.user_id,"user-id"),className:`left-2 z-10 transition-all duration-200 ${B["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"邮箱"}),(0,t.jsx)(eb.EY,{children:c.user_info?.user_email||"未设置"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"用户别名"}),(0,t.jsx)(eb.EY,{children:c.user_info?.user_alias||"未设置"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"全局代理角色"}),(0,t.jsx)(eb.EY,{children:c.user_info?.user_role||"未设置"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"创建时间"}),(0,t.jsx)(eb.EY,{children:c.user_info?.created_at?new Date(c.user_info.created_at).toLocaleString():"未知"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"最近更新时间"}),(0,t.jsx)(eb.EY,{children:c.user_info?.updated_at?new Date(c.user_info.updated_at).toLocaleString():"未知"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"分组"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:c.teams?.length&&c.teams?.length>0?(0,t.jsxs)(t.Fragment,{children:[c.teams?.slice(0,F?c.teams.length:20).map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",title:e.team_alias||e.team_id,children:e.team_alias||e.team_id},s)),!F&&c.teams?.length>20&&(0,t.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>R(!0),children:["+",c.teams.length-20," 更多"]}),F&&c.teams?.length>20&&(0,t.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>R(!1),children:"收起"})]}):(0,t.jsx)(eb.EY,{children:"无分组"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"个人模型"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:c.user_info?.models?.length&&c.user_info?.models?.length>0?c.user_info?.models?.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:e},s)):(0,t.jsx)(eb.EY,{children:"全部模型"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"API密钥"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:c.keys?.length&&c.keys?.length>0?c.keys.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-green-100 rounded text-xs",children:e.key_alias||e.token},s)):(0,t.jsx)(eb.EY,{children:"无API密钥"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"最大预算"}),(0,t.jsx)(eb.EY,{children:c.user_info?.max_budget!==null&&c.user_info?.max_budget!==void 0?`\xa5${(0,T.HY)(c.user_info.max_budget,4)}`:"不限制"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"预算重置周期"}),(0,t.jsx)(eb.EY,{children:(0,w.C)(c.user_info?.budget_duration??null)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eb.EY,{className:"font-medium",children:"元数据"}),(0,t.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(c.user_info?.metadata||{},null,2)})]})]})]})})]})]}),(0,t.jsx)(O.A,{isInvitationLinkModalVisible:A,setIsInvitationLinkModalVisible:S,baseUrl:C||"",invitationLinkData:k,modalType:"resetPassword"})]})}var ew=l(25495),ek=l(17976),eE=l(89337),eC=l(61878),eI=l(42869),eD=l(70707);function eY({data:e=[],columns:s,isLoading:l=!1,onSortChange:r,currentSort:i,accessToken:n,userRole:d,possibleUIRoles:o,handleEdit:c,handleDelete:u,handleResetPassword:m,selectedUsers:x=[],onSelectionChange:h,enableSelection:g=!1,filters:j,updateFilters:p,initialFilters:f,teams:_,userListResponse:b,currentPage:v,handlePageChange:A}){let[S,N]=a.useState([{id:i?.sortBy||"created_at",desc:i?.sortOrder==="desc"}]),[w,k]=a.useState(null),[E,C]=a.useState(!1),[I,D]=a.useState(!1),Y=(e,s=!1)=>{k(e),C(s)},U=(e,s)=>{h&&(s?h([...x,e]):h(x.filter(s=>s.user_id!==e.user_id)))},$=s=>{h&&(s?h(e):h([]))},B=e=>x.some(s=>s.user_id===e.user_id),L=e.length>0&&x.length===e.length,z=x.length>0&&x.length<e.length,O=a.useMemo(()=>o?ea(o,c,u,m,Y,g?{selectedUsers:x,onSelectUser:U,onSelectAll:$,isUserSelected:B,isAllSelected:L,isIndeterminate:z}:void 0):s,[o,c,u,m,Y,s,g,x,L,z]),T=(0,ed.N4)({data:e,columns:O,state:{sorting:S},onSortingChange:e=>{let s="function"==typeof e?e(S):e;if(N(s),s&&Array.isArray(s)&&s.length>0&&s[0]){let e=s[0];if(e.id){let s=e.id,l=e.desc?"desc":"asc";r?.(s,l)}}else r?.("created_at","desc")},getCoreRowModel:(0,eo.HT)(),manualSorting:!0,enableSorting:!0});return(a.useEffect(()=>{i&&N([{id:i.sortBy,desc:"desc"===i.sortOrder}])},[i]),w)?(0,t.jsx)(eN,{userId:w,onClose:()=>{k(null),C(!1)},accessToken:n,userRole:d,possibleUIRoles:o,initialTab:+!!E,startInEditMode:E}):(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,t.jsx)("div",{className:"border-b px-6 py-4",children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsx)(ew.Z,{placeholder:"按邮箱搜索...",value:j.email,onChange:e=>p({email:e}),icon:eC.A}),(0,t.jsx)(ek.e,{onClick:()=>D(!I),active:I,hasActiveFilters:!!(j.user_id||j.user_role||j.team),label:"筛选"}),(0,t.jsx)(eE.$,{onClick:()=>{p(f)},label:"重置筛选"})]}),I&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[(0,t.jsx)(ew.Z,{placeholder:"按用户 ID 筛选",value:j.user_id,onChange:e=>p({user_id:e}),icon:eI.A}),(0,t.jsx)(ew.Z,{placeholder:"按 SSO ID 筛选",value:j.sso_user_id,onChange:e=>p({sso_user_id:e}),icon:eD.A}),(0,t.jsx)("div",{className:"w-64",children:(0,t.jsx)(ec.A,{value:j.user_role,onValueChange:e=>p({user_role:e}),placeholder:"选择角色",children:o&&Object.entries(o).map(([e,s])=>(0,t.jsx)(y.A,{value:e,children:s.ui_label},e))})}),(0,t.jsx)("div",{className:"w-64",children:(0,t.jsx)(ec.A,{value:j.team,onValueChange:e=>p({team:e}),placeholder:"选择分组",children:_?.map(e=>(0,t.jsx)(y.A,{value:e.team_id,children:e.team_alias||e.team_id},e.team_id))})})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[l?(0,t.jsx)(ey.A.Input,{active:!0,style:{width:192,height:20}}):(0,t.jsxs)("span",{className:"text-sm text-gray-700",children:["显示"," ",b&&b.users&&b.users.length>0?(b.page-1)*b.page_size+1:0," ","-"," ",b&&b.users?Math.min(b.page*b.page_size,b.total):0," ","/ 共 ",b?b.total:0," 条"]}),(0,t.jsx)("div",{className:"flex space-x-2",children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ey.A.Button,{active:!0,size:"small",style:{width:80,height:30}}),(0,t.jsx)(ey.A.Button,{active:!0,size:"small",style:{width:60,height:30}})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>A(v-1),disabled:1===v,className:`px-3 py-1 text-sm border rounded-md ${1===v?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"}`,children:"上一页"}),(0,t.jsx)("button",{onClick:()=>A(v+1),disabled:!b||v>=b.total_pages,className:`px-3 py-1 text-sm border rounded-md ${!b||v>=b.total_pages?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"}`,children:"下一页"})]})})]})]})}),(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(eu.A,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,t.jsx)(eh.A,{children:T.getHeaderGroups().map(e=>(0,t.jsx)(ej.A,{children:e.headers.map(e=>(0,t.jsx)(eg.A,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""} ${e.column.getCanSort()?"cursor-pointer hover:bg-gray-50":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,ed.Kv)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&e.column.getCanSort()&&(0,t.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,t.jsx)(ep.A,{className:"h-4 w-4 text-blue-500"}),desc:(0,t.jsx)(ef.A,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,t.jsx)(e_.A,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,t.jsx)(em.A,{children:l?(0,t.jsx)(ej.A,{children:(0,t.jsx)(ex.A,{colSpan:O.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"\uD83D\uDE85 正在加载用户..."})})})}):e.length>0?T.getRowModel().rows.map(e=>(0,t.jsx)(ej.A,{className:"h-8",children:e.getVisibleCells().map(e=>(0,t.jsx)(ex.A,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:()=>{"user_id"===e.column.id&&Y(e.getValue(),!1)},style:{cursor:"user_id"===e.column.id?"pointer":"default",color:"user_id"===e.column.id?"#3b82f6":"inherit"},children:(0,ed.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,t.jsx)(ej.A,{children:(0,t.jsx)(ex.A,{colSpan:O.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"未找到用户"})})})})})]})})})})]})}let{Text:eU,Title:e$}=n.A,eB={email:"",user_id:"",user_role:"",sso_user_id:"",team:"",model:"",min_spend:null,max_spend:null,sort_by:"created_at",sort_order:"desc"},eL=({accessToken:e,token:s,userRole:l,userID:n,teams:d})=>{let{t:o}=(0,C.o)(),c=(0,R.jE)(),[u,m]=(0,a.useState)(1),[x,h]=(0,a.useState)(!1),[g,j]=(0,a.useState)(null),[f,_]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[v,A]=(0,a.useState)(null),[S,w]=(0,a.useState)("users"),[k,E]=(0,a.useState)(eB),[I,Y,U]=(0,F.M)(k,{wait:300}),[L,K]=(0,a.useState)(!1),[V,Z]=(0,a.useState)(null),[q,H]=(0,a.useState)(null),[J,G]=(0,a.useState)([]),[W,X]=(0,a.useState)(!1),[ee,es]=(0,a.useState)(!1),[el,et]=(0,a.useState)([]),er=e=>{A(e),_(!0)};(0,a.useEffect)(()=>()=>{U.cancel()},[U]),(0,a.useEffect)(()=>{H((0,p.getProxyBaseUrl)())},[]),(0,a.useEffect)(()=>{(async()=>{try{if(!n||!l||!e)return;let s=(await (0,p.modelAvailableCall)(e,n,l)).data.map(e=>e.id);console.log("available_model_names:",s),et(s)}catch(e){console.error("Error fetching user models:",e)}})()},[e,n,l]);let ed=e=>{E(s=>{let l={...s,...e};return Y(l),l})},eo=async s=>{if(!e)return void D.Ay.fromBackend("未找到访问令牌");try{D.Ay.success("正在生成重置密码链接...");let l=await (0,p.invitationCreateCall)(e,s);Z(l),K(!0)}catch(e){D.Ay.fromBackend("生成重置密码链接失败")}},ec=async()=>{if(v&&e)try{b(!0),await (0,p.userDeleteCall)(e,[v.user_id]),c.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let s=e.users.filter(e=>e.user_id!==v.user_id);return{...e,users:s}}),D.Ay.success("用户删除成功")}catch(e){console.error("Error deleting user:",e),D.Ay.fromBackend("删除用户失败")}finally{_(!1),A(null),b(!1)}},eu=async()=>{j(null),h(!1)},em=async t=>{if(console.log("inside handleEditSubmit:",t),e&&s&&l&&n){try{let s=await (0,p.userUpdateUserCall)(e,t,null);c.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let l=e.users.map(e=>e.user_id===s.data.user_id?(0,T.$b)(e,s.data):e);return{...e,users:l}}),D.Ay.success(`用户 ${t.user_id} 更新成功`)}catch(e){console.error("There was an error updating the user",e)}j(null),h(!1)}},ex=async e=>{m(e)},eh=(0,M.I)({queryKey:["userList",{debouncedFilter:I,currentPage:u}],queryFn:async()=>{if(!e)throw Error("需要访问令牌");return await (0,p.userListCall)(e,I.user_id?[I.user_id]:null,u,25,I.email||null,I.user_role||null,I.team||null,I.sso_user_id||null,I.sort_by,I.sort_order)},enabled:!!(e&&s&&l&&n),placeholderData:e=>e}),eg=eh.data,ej=(0,M.I)({queryKey:["userRoles"],initialData:()=>({}),queryFn:async()=>{if(!e)throw Error("需要访问令牌");return await (0,p.getPossibleUserRoles)(e)},enabled:!!(e&&s&&l&&n)}).data,ep=(0,a.useMemo)(()=>(e=>{if(!e)return null;let s={};for(let[l,t]of Object.entries(e)){let e=ei[l]||(t.ui_label?en[t.ui_label]:void 0)||t.ui_label||l;s[l]={...t,ui_label:e}}return s})(ej),[ej]),ef=ea(ep||{},e=>{j(e),h(!0)},er,eo,()=>{});return(0,t.jsxs)("div",{className:"w-full p-8 overflow-hidden",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsx)("div",{className:"flex space-x-3",children:eh.isLoading?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ey.A.Button,{active:!0,size:"default",shape:"default",style:{width:110,height:36}}),(0,t.jsx)(ey.A.Button,{active:!0,size:"default",shape:"default",style:{width:145,height:36}}),(0,t.jsx)(ey.A.Button,{active:!0,size:"default",shape:"default",style:{width:110,height:36}})]}):n&&e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(B.C,{userID:n,accessToken:e,teams:d,possibleUIRoles:ep}),(0,t.jsx)(i.$,{onClick:()=>{es(!ee),G([])},variant:ee?"primary":"secondary",className:"flex items-center",children:o(ee?"users.cancelSelection":"users.selectUsers")}),ee&&(0,t.jsxs)(i.$,{onClick:()=>{0===J.length?D.Ay.fromBackend("请先选择要编辑的用户"):X(!0)},disabled:0===J.length,className:"flex items-center",children:[o("users.bulkEdit")," (",o("users.selected")," ",J.length,")"]})]}):null})}),(0,t.jsxs)(r.fu,{defaultIndex:0,onIndexChange:e=>w(0===e?"users":"settings"),children:[(0,t.jsxs)(r.wb,{className:"mb-4",children:[(0,t.jsx)(r.oz,{children:o("users.tabs.users")}),(0,t.jsx)(r.oz,{children:o("users.tabs.defaultSettings")})]}),(0,t.jsxs)(r.T2,{children:[(0,t.jsx)(r.Kp,{children:(0,t.jsx)(eY,{data:eh.data?.users||[],columns:ef,isLoading:eh.isLoading,accessToken:e,userRole:l,onSortChange:(e,s)=>{ed({sort_by:e,sort_order:s})},currentSort:{sortBy:k.sort_by,sortOrder:k.sort_order},possibleUIRoles:ep,handleEdit:e=>{j(e),h(!0)},handleDelete:er,handleResetPassword:eo,enableSelection:ee,selectedUsers:J,onSelectionChange:e=>{G(e)},filters:k,updateFilters:ed,initialFilters:eB,teams:d,userListResponse:eg,currentPage:u,handlePageChange:ex})}),(0,t.jsx)(r.Kp,{children:n&&l&&e?(0,t.jsx)(Q,{accessToken:e,possibleUIRoles:ep,userID:n,userRole:l}):(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)(ey.A,{active:!0,paragraph:{rows:4}})})})]})]}),(0,t.jsx)(z,{visible:x,possibleUIRoles:ep,onCancel:eu,user:g,onSubmit:em}),(0,t.jsx)(P.A,{isOpen:f,title:"删除用户？",message:"确认删除该用户吗？此操作不可撤销。",resourceInformationTitle:"用户信息",resourceInformation:[{label:"邮箱",value:v?.user_email},{label:"用户 ID",value:v?.user_id,code:!0},{label:"全局代理角色",value:v&&ep?.[v.user_role]?.ui_label||v?.user_role||"-"},{label:"总花费",value:v?.spend!==null&&v?.spend!==void 0?`\xa5${v.spend.toFixed(2)}`:"\xa50.00"}],onCancel:()=>{_(!1),A(null)},onOk:ec,confirmLoading:y}),(0,t.jsx)(O.A,{isInvitationLinkModalVisible:L,setIsInvitationLinkModalVisible:K,baseUrl:q||"",invitationLinkData:V,modalType:"resetPassword"}),(0,t.jsx)($,{open:W,onCancel:()=>X(!1),selectedUsers:J,possibleUIRoles:ep,accessToken:e,onSuccess:()=>{c.invalidateQueries({queryKey:["userList"]}),G([]),es(!1)},teams:d,userRole:l,userModels:el,allowAllUsers:!!l&&(0,N.OY)(l)})]})}},77258:(e,s,l)=>{l.d(s,{$n:()=>t.A,EY:()=>i.A,Zp:()=>r.A,cG:()=>a.A,hE:()=>d.A,ks:()=>n.A});var t=l(38983),r=l(42837),a=l(54747),i=l(75892),n=l(34487),d=l(64628)}}]);