"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6592],{16592:(e,t,a)=>{a.d(t,{A:()=>ar});var l,r,i=a(95155),s=a(12115),n=a(17276),o=a(6808),d=a(22864),c=a(99749),m=a(17432),p=a(28436),u=a(41326),g=a(23060),x=a(25387),h=a(91808),y=a(48849),f=a(87278),j=a(3373),_=a(12120),v=a(69779),b=a(54481),A=a(62823),C=a(46732);let{Text:N}=u.A,{Option:w}=g.A,S=({visible:e,prebuiltPatterns:t,categories:a,selectedPatternName:l,patternAction:r,onPatternNameChange:s,onActionChange:n,onAdd:o,onCancel:d})=>(0,i.jsxs)(j.A,{title:"Add prebuilt pattern",open:e,onCancel:d,footer:null,width:800,children:[(0,i.jsxs)(b.A,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(N,{strong:!0,children:"Pattern type"}),(0,i.jsx)(g.A,{placeholder:"Choose pattern type",value:l,onChange:s,style:{width:"100%",marginTop:8},showSearch:!0,filterOption:(e,a)=>{let l=t.find(e=>e.name===a?.value);return!!l&&(l.display_name.toLowerCase().includes(e.toLowerCase())||l.name.toLowerCase().includes(e.toLowerCase()))},children:a.map(e=>{let a=t.filter(t=>t.category===e);return 0===a.length?null:(0,i.jsx)(g.A.OptGroup,{label:e,children:a.map(e=>(0,i.jsx)(w,{value:e.name,children:e.display_name},e.name))},e)})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(N,{strong:!0,children:"Action"}),(0,i.jsx)(N,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this pattern is detected"}),(0,i.jsxs)(g.A,{value:r,onChange:n,style:{width:"100%"},children:[(0,i.jsx)(w,{value:"BLOCK",children:"Block"}),(0,i.jsx)(w,{value:"MASK",children:"Mask"})]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,i.jsx)(f.Ay,{onClick:d,children:"Cancel"}),(0,i.jsx)(f.Ay,{type:"primary",onClick:o,children:"Add"})]})]}),{Text:k}=u.A,{Option:P}=g.A,I=({visible:e,patternName:t,patternRegex:a,patternAction:l,onNameChange:r,onRegexChange:s,onActionChange:n,onAdd:o,onCancel:d})=>(0,i.jsxs)(j.A,{title:"Add custom regex pattern",open:e,onCancel:d,footer:null,width:800,children:[(0,i.jsxs)(b.A,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(k,{strong:!0,children:"Pattern name"}),(0,i.jsx)(h.A,{placeholder:"e.g., internal_id, employee_code",value:t,onChange:e=>r(e.target.value),style:{marginTop:8}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(k,{strong:!0,children:"Regex pattern"}),(0,i.jsx)(h.A,{placeholder:"e.g., ID-[0-9]{6}",value:a,onChange:e=>s(e.target.value),style:{marginTop:8}}),(0,i.jsx)(k,{type:"secondary",style:{fontSize:12},children:"Enter a valid regular expression to match sensitive data"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(k,{strong:!0,children:"Action"}),(0,i.jsx)(k,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this pattern is detected"}),(0,i.jsxs)(g.A,{value:l,onChange:n,style:{width:"100%"},children:[(0,i.jsx)(P,{value:"BLOCK",children:"Block"}),(0,i.jsx)(P,{value:"MASK",children:"Mask"})]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,i.jsx)(f.Ay,{onClick:d,children:"Cancel"}),(0,i.jsx)(f.Ay,{type:"primary",onClick:o,children:"Add"})]})]}),{Text:O}=u.A,{Option:L}=g.A,B=({visible:e,keyword:t,action:a,description:l,onKeywordChange:r,onActionChange:s,onDescriptionChange:n,onAdd:o,onCancel:d})=>(0,i.jsxs)(j.A,{title:"Add blocked keyword",open:e,onCancel:d,footer:null,width:800,children:[(0,i.jsxs)(b.A,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(O,{strong:!0,children:"Keyword"}),(0,i.jsx)(h.A,{placeholder:"Enter sensitive keyword or phrase",value:t,onChange:e=>r(e.target.value),style:{marginTop:8}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(O,{strong:!0,children:"Action"}),(0,i.jsx)(O,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this keyword is detected"}),(0,i.jsxs)(g.A,{value:a,onChange:s,style:{width:"100%"},children:[(0,i.jsx)(L,{value:"BLOCK",children:"Block"}),(0,i.jsx)(L,{value:"MASK",children:"Mask"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(O,{strong:!0,children:"Description (optional)"}),(0,i.jsx)(h.A.TextArea,{placeholder:"Explain why this keyword is sensitive",value:l,onChange:e=>n(e.target.value),rows:3,style:{marginTop:8}})]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,i.jsx)(f.Ay,{onClick:d,children:"Cancel"}),(0,i.jsx)(f.Ay,{type:"primary",onClick:o,children:"Add"})]})]});var T=a(50139),E=a(24611);let{Text:z}=u.A,{Option:F}=g.A,$=({patterns:e,onActionChange:t,onRemove:a})=>{let l=[{title:"Type",dataIndex:"type",key:"type",width:100,render:e=>(0,i.jsx)(y.A,{color:"prebuilt"===e?"blue":"green",children:"prebuilt"===e?"Prebuilt":"Custom"})},{title:"Pattern name",dataIndex:"name",key:"name",render:(e,t)=>t.display_name||t.name},{title:"Regex pattern",dataIndex:"pattern",key:"pattern",render:e=>e?(0,i.jsxs)(z,{code:!0,style:{fontSize:12},children:[e.substring(0,40),"..."]}):"-"},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,a)=>(0,i.jsxs)(g.A,{value:e,onChange:e=>t(a.id,e),style:{width:120},size:"small",children:[(0,i.jsx)(F,{value:"BLOCK",children:"Block"}),(0,i.jsx)(F,{value:"MASK",children:"Mask"})]})},{title:"",key:"actions",width:100,render:(e,t)=>(0,i.jsx)(f.Ay,{type:"text",danger:!0,size:"small",icon:(0,i.jsx)(E.A,{}),onClick:()=>a(t.id),children:"Delete"})}];return 0===e.length?(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"No patterns added."}):(0,i.jsx)(T.A,{dataSource:e,columns:l,rowKey:"id",pagination:!1,size:"small"})},{Text:M}=u.A,{Option:R}=g.A,G=({keywords:e,onActionChange:t,onRemove:a})=>{let l=[{title:"Keyword",dataIndex:"keyword",key:"keyword"},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,a)=>(0,i.jsxs)(g.A,{value:e,onChange:e=>t(a.id,"action",e),style:{width:120},size:"small",children:[(0,i.jsx)(R,{value:"BLOCK",children:"Block"}),(0,i.jsx)(R,{value:"MASK",children:"Mask"})]})},{title:"Description",dataIndex:"description",key:"description",render:e=>e||"-"},{title:"",key:"actions",width:100,render:(e,t)=>(0,i.jsx)(f.Ay,{type:"text",danger:!0,size:"small",icon:(0,i.jsx)(E.A,{}),onClick:()=>a(t.id),children:"Delete"})}];return 0===e.length?(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"No keywords added."}):(0,i.jsx)(T.A,{dataSource:e,columns:l,rowKey:"id",pagination:!1,size:"small"})};var D=a(10639),K=a(58847);let{Title:J,Text:q}=u.A,{Option:W}=g.A,H=({availableCategories:e,selectedCategories:t,onCategoryAdd:a,onCategoryRemove:l,onCategoryUpdate:r,accessToken:n,pendingSelection:o,onPendingSelectionChange:c})=>{let[m,u]=s.useState(""),x=void 0!==o?o:m,h=c||u,[j,_]=s.useState({}),[b,A]=s.useState({}),[C,N]=s.useState({}),[w,S]=s.useState([]),[k,P]=s.useState(""),[I,O]=s.useState(!1),L=async e=>{if(n&&!j[e]){N(t=>({...t,[e]:!0}));try{let t=await (0,p.getCategoryYaml)(n,e),a=t.yaml_content;if("json"===t.file_type)try{let e=JSON.parse(a);a=JSON.stringify(e,null,2)}catch(t){console.warn(`Failed to format JSON for ${e}:`,t)}_(t=>({...t,[e]:a})),A(a=>({...a,[e]:t.file_type||"yaml"}))}catch(t){console.error(`Failed to fetch content for category ${e}:`,t)}finally{N(t=>({...t,[e]:!1}))}}};s.useEffect(()=>{if(x&&n){let e=j[x];if(e)return void P(e);O(!0),console.log(`Fetching content for category: ${x}`,{accessToken:n?"present":"missing"}),(0,p.getCategoryYaml)(n,x).then(e=>{console.log(`Successfully fetched content for ${x}:`,e);let t=e.yaml_content;if("json"===e.file_type)try{let e=JSON.parse(t);t=JSON.stringify(e,null,2)}catch(e){console.warn(`Failed to format JSON for ${x}:`,e)}P(t),_(e=>({...e,[x]:t})),A(t=>({...t,[x]:e.file_type||"yaml"}))}).catch(e=>{console.error(`Failed to fetch preview content for category ${x}:`,e),P("")}).finally(()=>{O(!1)})}else P(""),O(!1)},[x,n]);let B=[{title:"Category",dataIndex:"display_name",key:"display_name",render:(t,a)=>{let l=e.find(e=>e.name===a.category);return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:500},children:t}),l?.description&&(0,i.jsx)("div",{style:{fontSize:"12px",color:"#888",marginTop:"4px"},children:l.description})]})}},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,t)=>(0,i.jsxs)(g.A,{value:e,onChange:e=>r(t.id,"action",e),style:{width:"100%"},children:[(0,i.jsx)(W,{value:"BLOCK",children:(0,i.jsx)(y.A,{color:"red",children:"BLOCK"})}),(0,i.jsx)(W,{value:"MASK",children:(0,i.jsx)(y.A,{color:"orange",children:"MASK"})})]})},{title:"Severity Threshold",dataIndex:"severity_threshold",key:"severity_threshold",width:180,render:(e,t)=>(0,i.jsxs)(g.A,{value:e,onChange:e=>r(t.id,"severity_threshold",e),style:{width:"100%"},children:[(0,i.jsx)(W,{value:"low",children:"Low"}),(0,i.jsx)(W,{value:"medium",children:"Medium"}),(0,i.jsx)(W,{value:"high",children:"High"})]})},{title:"",key:"actions",width:80,render:(e,t)=>(0,i.jsx)(f.Ay,{icon:(0,i.jsx)(E.A,{}),onClick:()=>l(t.id),size:"small",children:"Remove"})}],z=e.filter(e=>!t.some(t=>t.category===e.name));return(0,i.jsxs)(v.A,{title:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8},children:[(0,i.jsx)(J,{level:5,style:{margin:0},children:"Blocked topics"}),(0,i.jsx)(q,{type:"secondary",style:{fontSize:12,fontWeight:400},children:"Select topics to block using keyword and semantic analysis"})]}),size:"small",children:[(0,i.jsxs)("div",{style:{marginBottom:16,display:"flex",gap:8},children:[(0,i.jsx)(g.A,{placeholder:"Select a content category",value:x||void 0,onChange:h,style:{flex:1},showSearch:!0,optionLabelProp:"label",filterOption:(e,t)=>(t?.label?.toString().toLowerCase()??"").includes(e.toLowerCase()),children:z.map(e=>(0,i.jsx)(W,{value:e.name,label:e.display_name,children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:500},children:e.display_name}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"2px"},children:e.description})]})},e.name))}),(0,i.jsx)(f.Ay,{type:"primary",onClick:()=>{if(!x)return;let l=e.find(e=>e.name===x);!l||t.some(e=>e.category===x)||(a({id:`category-${Date.now()}`,category:l.name,display_name:l.display_name,action:l.default_action,severity_threshold:"medium"}),h(""),P(""))},disabled:!x,icon:(0,i.jsx)(d.A,{}),children:"Add"})]}),x&&(0,i.jsxs)("div",{style:{marginBottom:16,padding:"12px",background:"#f9f9f9",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,i.jsxs)("div",{style:{marginBottom:8,fontWeight:500,fontSize:"14px"},children:["Preview: ",e.find(e=>e.name===x)?.display_name,b[x]&&(0,i.jsxs)("span",{style:{marginLeft:8,fontSize:"12px",color:"#888",fontWeight:400},children:["(",b[x]?.toUpperCase(),")"]})]}),I?(0,i.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#888"},children:"Loading content..."}):k?(0,i.jsx)("pre",{style:{background:"#fff",padding:"12px",borderRadius:"4px",overflow:"auto",maxHeight:"300px",maxWidth:"100%",fontSize:"12px",lineHeight:"1.5",margin:0,border:"1px solid #e0e0e0",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:(0,i.jsx)("code",{children:k})}):(0,i.jsx)("div",{style:{padding:"8px",textAlign:"center",color:"#888",fontSize:"12px"},children:"Unable to load category content"})]}),t.length>0?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T.A,{dataSource:t,columns:B,pagination:!1,size:"small",rowKey:"id"}),(0,i.jsx)("div",{style:{marginTop:16},children:(0,i.jsx)(D.A,{activeKey:w,onChange:e=>{let t=Array.isArray(e)?e:e?[e]:[],a=new Set(w);t.forEach(e=>{a.has(e)||j[e]||L(e)}),S(t)},ghost:!0,items:t.map(e=>{let t=(b[e.category]||"yaml").toUpperCase();return{key:e.category,label:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(K.A,{}),(0,i.jsxs)("span",{children:["View ",t," for ",e.display_name]})]}),children:C[e.category]?(0,i.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#888"},children:"Loading content..."}):j[e.category]?(0,i.jsx)("pre",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"4px",overflow:"auto",maxHeight:"400px",fontSize:"12px",lineHeight:"1.5",margin:0},children:(0,i.jsx)("code",{children:j[e.category]})}):(0,i.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#888"},children:"Content will load when expanded"})}})})})]}):(0,i.jsx)("div",{style:{textAlign:"center",padding:"24px",color:"#888",border:"1px dashed #d9d9d9",borderRadius:"4px"},children:"No blocked topics selected. Add topics to detect and block harmful content."})]})};var U=a(16989),V=a(8208);let{Title:Y,Text:Z}=u.A,{Option:Q}=g.A,X={competitor_intent_type:"airline",brand_self:[],locations:[],policy:{competitor_comparison:"refuse",possible_competitor_comparison:"reframe"},threshold_high:.7,threshold_medium:.45,threshold_low:.3},ee=({enabled:e,config:t,onChange:a,accessToken:l})=>{let r=t??X,[n,o]=(0,s.useState)([]),[d,c]=(0,s.useState)(!1);(0,s.useEffect)(()=>{"airline"===r.competitor_intent_type&&l&&0===n.length&&(c(!0),(0,p.getMajorAirlines)(l).then(e=>o(e.airlines??[])).catch(()=>o([])).finally(()=>c(!1)))},[r.competitor_intent_type,l,n.length]);let m=e=>{a(e,e?{...X}:null)},u=(t,l)=>{a(e,{...r,[t]:l})},h=(t,l)=>{a(e,{...r,policy:{...r.policy,[t]:l}})},y=(t,l)=>{a(e,{...r,[t]:l.filter(Boolean)})};return e?(0,i.jsxs)(v.A,{title:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(Y,{level:5,style:{margin:0},children:"Competitor Intent Filter"}),(0,i.jsx)(U.A,{checked:e,onChange:m})]}),size:"small",children:[(0,i.jsx)(Z,{type:"secondary",style:{display:"block",marginBottom:16},children:"Block or reframe competitor comparison questions. Airline type uses major airlines (excluding your brand); generic requires manual competitor list."}),(0,i.jsxs)(x.A,{layout:"vertical",size:"small",children:[(0,i.jsx)(x.A.Item,{label:"Type",children:(0,i.jsxs)(g.A,{value:r.competitor_intent_type,onChange:e=>u("competitor_intent_type",e),style:{width:"100%"},children:[(0,i.jsx)(Q,{value:"airline",children:"Airline (auto-load competitors from IATA)"}),(0,i.jsx)(Q,{value:"generic",children:"Generic (specify competitors manually)"})]})}),(0,i.jsx)(x.A.Item,{label:"Your Brand (brand_self)",required:!0,help:"airline"===r.competitor_intent_type?"Select your airline from the list (excluded from competitors) or type to add a custom term":"Names/codes users use for your brand",children:(0,i.jsx)(g.A,{mode:"tags",style:{width:"100%"},placeholder:d?"Loading airlines...":"airline"===r.competitor_intent_type?"Search or select airline, or type to add custom":"Type and press Enter to add",value:r.brand_self,onChange:t=>"airline"===r.competitor_intent_type&&n.length>0?(t=>{let l=t.filter(Boolean),i=[],s=new Set;for(let e of l){let t=n.find(t=>t.match.split("|")[0]?.trim().toLowerCase()===e.toLowerCase());if(t)for(let e of t.match.split("|").map(e=>e.trim().toLowerCase()).filter(Boolean))s.has(e)||(s.add(e),i.push(e));else s.has(e.toLowerCase())||(s.add(e.toLowerCase()),i.push(e))}a(e,{...r,brand_self:i})})(t??[]):y("brand_self",t??[]),tokenSeparators:[","],loading:d,showSearch:!0,filterOption:(e,t)=>(t?.label?.toString().toLowerCase()??"").includes(e.toLowerCase()),optionFilterProp:"label",options:"airline"===r.competitor_intent_type&&n.length>0?n.map(e=>{let t=e.match.split("|")[0]?.trim()??e.id,a=e.match.split("|").map(e=>e.trim().toLowerCase()).filter(Boolean);return{value:t.toLowerCase(),label:`${t}${a.length>1?` (${a.slice(1).join(", ")})`:""}`}}):void 0})}),"airline"===r.competitor_intent_type&&(0,i.jsx)(x.A.Item,{label:"Locations (optional)",help:"Countries, cities, airports for disambiguation (e.g. qatar, doha)",children:(0,i.jsx)(g.A,{mode:"tags",style:{width:"100%"},placeholder:"Type and press Enter to add",value:r.locations??[],onChange:e=>y("locations",e??[]),tokenSeparators:[","]})}),"generic"===r.competitor_intent_type&&(0,i.jsx)(x.A.Item,{label:"Competitors",required:!0,help:"Competitor names to detect (required for generic type)",children:(0,i.jsx)(g.A,{mode:"tags",style:{width:"100%"},placeholder:"Type and press Enter to add",value:r.competitors??[],onChange:e=>y("competitors",e??[]),tokenSeparators:[","]})}),(0,i.jsx)(x.A.Item,{label:"Policy: Competitor comparison",children:(0,i.jsxs)(g.A,{value:r.policy?.competitor_comparison??"refuse",onChange:e=>h("competitor_comparison",e),style:{width:"100%"},children:[(0,i.jsx)(Q,{value:"refuse",children:"Refuse (block request)"}),(0,i.jsx)(Q,{value:"reframe",children:"Reframe (suggest alternative)"})]})}),(0,i.jsx)(x.A.Item,{label:"Policy: Possible competitor comparison",children:(0,i.jsxs)(g.A,{value:r.policy?.possible_competitor_comparison??"reframe",onChange:e=>h("possible_competitor_comparison",e),style:{width:"100%"},children:[(0,i.jsx)(Q,{value:"refuse",children:"Refuse (block request)"}),(0,i.jsx)(Q,{value:"reframe",children:"Reframe (suggest alternative to backend LLM)"})]})}),(0,i.jsx)(x.A.Item,{label:"Confidence thresholds",help:(0,i.jsxs)(i.Fragment,{children:["Classify competitor intent by confidence (0–1). Higher confidence → stronger intent.",(0,i.jsxs)("ul",{style:{marginBottom:0,marginTop:4,paddingLeft:20},children:[(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"High (≥)"}),': Treat as full competitor comparison → uses "Competitor comparison" policy']}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Medium (≥)"}),': Treat as possible comparison → uses "Possible competitor comparison" policy']}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Low (≥)"}),": Log only; allow request. Below Low → allow with no action"]})]}),"Raise thresholds to be more permissive; lower them to be stricter."]}),children:(0,i.jsxs)(b.A,{wrap:!0,children:[(0,i.jsx)(x.A.Item,{label:"High",style:{marginBottom:0},help:"e.g. 0.7",children:(0,i.jsx)(V.A,{min:0,max:1,step:.05,value:r.threshold_high??.7,onChange:e=>u("threshold_high",e??.7),style:{width:80}})}),(0,i.jsx)(x.A.Item,{label:"Medium",style:{marginBottom:0},help:"e.g. 0.45",children:(0,i.jsx)(V.A,{min:0,max:1,step:.05,value:r.threshold_medium??.45,onChange:e=>u("threshold_medium",e??.45),style:{width:80}})}),(0,i.jsx)(x.A.Item,{label:"Low",style:{marginBottom:0},help:"e.g. 0.3",children:(0,i.jsx)(V.A,{min:0,max:1,step:.05,value:r.threshold_low??.3,onChange:e=>u("threshold_low",e??.3),style:{width:80}})})]})})]})]}):(0,i.jsx)(v.A,{title:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(Y,{level:5,style:{margin:0},children:"Competitor Intent Filter"}),(0,i.jsx)(U.A,{checked:!1,onChange:m})]}),size:"small",children:(0,i.jsx)(Z,{type:"secondary",children:"Block or reframe competitor comparison questions. When enabled, airline type auto-loads competitors from IATA; generic type requires manual competitor list."})})},{Title:et,Text:ea}=u.A,el=({prebuiltPatterns:e,categories:t,selectedPatterns:a,blockedWords:l,onPatternAdd:r,onPatternRemove:n,onPatternActionChange:o,onBlockedWordAdd:c,onBlockedWordRemove:m,onBlockedWordUpdate:u,onFileUpload:g,accessToken:x,showStep:h,contentCategories:y=[],selectedContentCategories:j=[],onContentCategoryAdd:N,onContentCategoryRemove:w,onContentCategoryUpdate:k,pendingCategorySelection:P,onPendingCategorySelectionChange:O,competitorIntentEnabled:L=!1,competitorIntentConfig:T=null,onCompetitorIntentChange:E})=>{let[z,F]=(0,s.useState)(!1),[M,R]=(0,s.useState)(!1),[D,K]=(0,s.useState)(!1),[J,q]=(0,s.useState)(""),[W,U]=(0,s.useState)("BLOCK"),[V,Y]=(0,s.useState)(""),[Z,Q]=(0,s.useState)(""),[X,el]=(0,s.useState)("BLOCK"),[er,ei]=(0,s.useState)(""),[es,en]=(0,s.useState)("BLOCK"),[eo,ed]=(0,s.useState)(""),[ec,em]=(0,s.useState)(!1),ep=async e=>{em(!0);try{let t=await e.text();if(x){let e=await (0,p.validateBlockedWordsFile)(x,t);if(e.valid)g&&g(t),_.Ay.success(e.message||"File uploaded successfully");else{let t=e.error||e.errors&&e.errors.join(", ")||"Invalid file";_.Ay.error(`Validation failed: ${t}`)}}}catch(e){_.Ay.error(`Failed to upload file: ${e}`)}finally{em(!1)}return!1};return(0,i.jsxs)("div",{className:"space-y-6",children:[!h&&(0,i.jsx)("div",{children:(0,i.jsx)(ea,{type:"secondary",children:"Configure patterns, keywords, and content categories to detect and filter sensitive information in requests and responses."})}),(!h||"patterns"===h)&&(0,i.jsxs)(v.A,{title:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(et,{level:5,style:{margin:0},children:"Pattern Detection"}),(0,i.jsx)(ea,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Detect sensitive information using regex patterns (SSN, credit cards, API keys, etc.)"})]}),size:"small",children:[(0,i.jsx)("div",{style:{marginBottom:16},children:(0,i.jsxs)(b.A,{children:[(0,i.jsx)(f.Ay,{type:"primary",onClick:()=>F(!0),icon:(0,i.jsx)(d.A,{}),children:"Add prebuilt pattern"}),(0,i.jsx)(f.Ay,{onClick:()=>K(!0),icon:(0,i.jsx)(d.A,{}),children:"Add custom regex"})]})}),(0,i.jsx)($,{patterns:a,onActionChange:o,onRemove:n})]}),(!h||"keywords"===h)&&(0,i.jsxs)(v.A,{title:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(et,{level:5,style:{margin:0},children:"Blocked Keywords"}),(0,i.jsx)(ea,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Block or mask specific sensitive terms and phrases"})]}),size:"small",children:[(0,i.jsx)("div",{style:{marginBottom:16},children:(0,i.jsxs)(b.A,{children:[(0,i.jsx)(f.Ay,{type:"primary",onClick:()=>R(!0),icon:(0,i.jsx)(d.A,{}),children:"Add keyword"}),(0,i.jsx)(A.A,{beforeUpload:ep,accept:".yaml,.yml",showUploadList:!1,children:(0,i.jsx)(f.Ay,{icon:(0,i.jsx)(C.A,{}),loading:ec,children:"Upload YAML file"})})]})}),(0,i.jsx)(G,{keywords:l,onActionChange:u,onRemove:m})]}),(!h||"competitor_intent"===h||"categories"===h)&&E&&(0,i.jsx)(ee,{enabled:L,config:T,onChange:E,accessToken:x}),(!h||"categories"===h)&&y.length>0&&N&&w&&k&&(0,i.jsx)(H,{availableCategories:y,selectedCategories:j,onCategoryAdd:N,onCategoryRemove:w,onCategoryUpdate:k,accessToken:x,pendingSelection:P,onPendingSelectionChange:O}),(0,i.jsx)(S,{visible:z,prebuiltPatterns:e,categories:t,selectedPatternName:J,patternAction:W,onPatternNameChange:q,onActionChange:e=>U(e),onAdd:()=>{if(!J)return void _.Ay.error("Please select a pattern");let t=e.find(e=>e.name===J);r({id:`pattern-${Date.now()}`,type:"prebuilt",name:J,display_name:t?.display_name,action:W}),F(!1),q(""),U("BLOCK")},onCancel:()=>{F(!1),q(""),U("BLOCK")}}),(0,i.jsx)(I,{visible:D,patternName:V,patternRegex:Z,patternAction:X,onNameChange:Y,onRegexChange:Q,onActionChange:e=>el(e),onAdd:()=>{V&&Z?(r({id:`custom-${Date.now()}`,type:"custom",name:V,pattern:Z,action:X}),K(!1),Y(""),Q(""),el("BLOCK")):_.Ay.error("Please provide pattern name and regex")},onCancel:()=>{K(!1),Y(""),Q(""),el("BLOCK")}}),(0,i.jsx)(B,{visible:M,keyword:er,action:es,description:eo,onKeywordChange:ei,onActionChange:e=>en(e),onDescriptionChange:ed,onAdd:()=>{er?(c({id:`word-${Date.now()}`,keyword:er,action:es,description:eo||void 0}),R(!1),ei(""),ed(""),en("BLOCK")):_.Ay.error("Please enter a keyword")},onCancel:()=>{R(!1),ei(""),ed(""),en("BLOCK")}})]})};var er=((l={}).PresidioPII="Presidio PII",l.Bedrock="Bedrock Guardrail",l.Lakera="Lakera",l);let ei={},es=e=>{let t={};return t.PresidioPII="Presidio PII",t.Bedrock="Bedrock Guardrail",t.Lakera="Lakera",Object.entries(e).forEach(([e,a])=>{a&&"object"==typeof a&&"ui_friendly_name"in a&&(t[e.split("_").map((e,t)=>e.charAt(0).toUpperCase()+e.slice(1)).join("")]=a.ui_friendly_name)}),ei=t,t},en=()=>Object.keys(ei).length>0?ei:er,eo={PresidioPII:"presidio",Bedrock:"bedrock",Lakera:"lakera_v2",LitellmContentFilter:"litellm_content_filter",ToolPermission:"tool_permission"},ed=e=>{Object.entries(e).forEach(([e,t])=>{t&&"object"==typeof t&&"ui_friendly_name"in t&&(eo[e.split("_").map((e,t)=>e.charAt(0).toUpperCase()+e.slice(1)).join("")]=e)})},ec=e=>!!e&&"Presidio PII"===en()[e],em=e=>!!e&&"Silinex Content Filter"===en()[e],ep="../ui/assets/logos/",eu={"Zscaler AI Guard":`${ep}zscaler.svg`,"Presidio PII":`${ep}microsoft_azure.svg`,"Bedrock Guardrail":`${ep}bedrock.svg`,Lakera:`${ep}lakeraai.jpeg`,"Azure Content Safety Prompt Shield":`${ep}microsoft_azure.svg`,"Azure Content Safety Text Moderation":`${ep}microsoft_azure.svg`,"Aporia AI":`${ep}aporia.png`,"PANW Prisma AIRS":`${ep}palo_alto_networks.jpeg`,"Noma Security":`${ep}noma_security.png`,"Javelin Guardrails":`${ep}javelin.png`,"Pillar Guardrail":`${ep}pillar.jpeg`,"Google Cloud Model Armor":`${ep}google.svg`,"Guardrails AI":`${ep}guardrails_ai.jpeg`,"Lasso Guardrail":`${ep}lasso.png`,"Pangea Guardrail":`${ep}pangea.png`,"AIM Guardrail":`${ep}aim_security.jpeg`,"OpenAI Moderation":`${ep}openai_small.svg`,EnkryptAI:`${ep}enkrypt_ai.avif`,"Prompt Security":`${ep}prompt_security.png`,"Silinex Content Filter":`${ep}litellm_logo.jpg`},eg=e=>{if(!e)return{logo:"",displayName:"-"};let t=Object.keys(eo).find(t=>eo[t].toLowerCase()===e.toLowerCase());if(!t)return{logo:"",displayName:e};let a=en()[t];return{logo:eu[a]||"",displayName:a||e}};var ex=a(66904);let{Title:eh}=u.A,ey=({field:e,fieldKey:t,fullFieldKey:a,value:l})=>{let[r,n]=s.useState([]),[o,d]=s.useState(e.dict_key_options||[]);return s.useEffect(()=>{if(l&&"object"==typeof l){let t=Object.keys(l);n(t.map(e=>({key:e,id:`${e}_${Date.now()}_${Math.random()}`}))),d((e.dict_key_options||[]).filter(e=>!t.includes(e)))}},[l,e.dict_key_options]),(0,i.jsxs)("div",{className:"space-y-3",children:[r.map(t=>(0,i.jsxs)("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[(0,i.jsx)("div",{className:"w-24 font-medium text-sm",children:t.key}),(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)(x.A.Item,{name:Array.isArray(a)?[...a,t.key]:[a,t.key],style:{marginBottom:0},initialValue:l&&"object"==typeof l?l[t.key]:void 0,normalize:"number"===e.dict_value_type?e=>{if(null==e||""===e)return;let t=Number(e);return isNaN(t)?e:t}:void 0,children:"number"===e.dict_value_type?(0,i.jsx)(ex.A,{step:1,width:200,placeholder:`Enter ${t.key} value`}):"boolean"===e.dict_value_type?(0,i.jsxs)(g.A,{placeholder:`Select ${t.key} value`,children:[(0,i.jsx)(g.A.Option,{value:!0,children:"True"}),(0,i.jsx)(g.A.Option,{value:!1,children:"False"})]}):(0,i.jsx)(h.A,{placeholder:`Enter ${t.key} value`})})}),(0,i.jsx)(f.Ay,{type:"text",danger:!0,size:"small",onClick:()=>{var e,a;return e=t.id,a=t.key,void(n(r.filter(t=>t.id!==e)),d([...o,a].sort()))},children:"Remove"})]},t.id)),o.length>0&&(0,i.jsxs)("div",{className:"flex items-center space-x-3 mt-2",children:[(0,i.jsx)(g.A,{placeholder:"Select category to configure",style:{width:200},onSelect:e=>e&&void(!e||(n([...r,{key:e,id:`${e}_${Date.now()}`}]),d(o.filter(t=>t!==e)))),value:void 0,children:o.map(e=>(0,i.jsx)(g.A.Option,{value:e,children:e},e))}),(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"Select a category to add threshold configuration"})]})]})},ef=({optionalParams:e,parentFieldKey:t,values:a})=>e.fields&&0!==Object.keys(e.fields).length?(0,i.jsxs)("div",{className:"guardrail-optional-params",children:[(0,i.jsxs)("div",{className:"mb-8 pb-4 border-b border-gray-100",children:[(0,i.jsx)(eh,{level:3,className:"mb-2 font-semibold text-gray-900",children:"Optional Parameters"}),(0,i.jsx)("p",{className:"text-gray-600 text-sm",children:e.description||"Configure additional settings for this guardrail provider"})]}),(0,i.jsx)("div",{className:"space-y-8",children:Object.entries(e.fields).map(([e,l])=>{let r,s;return r=`${t}.${e}`,(console.log("value",s=a?.[e]),"dict"===l.type&&l.dict_key_options)?(0,i.jsxs)("div",{className:"mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200",children:[(0,i.jsx)("div",{className:"mb-4 font-medium text-gray-900 text-base",children:e}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:l.description}),(0,i.jsx)(ey,{field:l,fieldKey:e,fullFieldKey:[t,e],value:s})]},r):(0,i.jsx)("div",{className:"mb-8 p-6 bg-white rounded-lg border border-gray-200 shadow-sm",children:(0,i.jsx)(x.A.Item,{name:[t,e],label:(0,i.jsxs)("div",{className:"mb-2",children:[(0,i.jsx)("div",{className:"font-medium text-gray-900 text-base",children:e}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:l.description})]}),rules:l.required?[{required:!0,message:`${e} is required`}]:void 0,className:"mb-0",initialValue:void 0!==s?s:l.default_value,normalize:"number"===l.type?e=>{if(null==e||""===e)return;let t=Number(e);return isNaN(t)?e:t}:void 0,children:"select"===l.type&&l.options?(0,i.jsx)(g.A,{placeholder:l.description,children:l.options.map(e=>(0,i.jsx)(g.A.Option,{value:e,children:e},e))}):"multiselect"===l.type&&l.options?(0,i.jsx)(g.A,{mode:"multiple",placeholder:l.description,children:l.options.map(e=>(0,i.jsx)(g.A.Option,{value:e,children:e},e))}):"bool"===l.type||"boolean"===l.type?(0,i.jsxs)(g.A,{placeholder:l.description,children:[(0,i.jsx)(g.A.Option,{value:"true",children:"True"}),(0,i.jsx)(g.A.Option,{value:"false",children:"False"})]}):"number"===l.type?(0,i.jsx)(ex.A,{step:1,width:400,placeholder:l.description}):e.includes("password")||e.includes("secret")||e.includes("key")?(0,i.jsx)(h.A.Password,{placeholder:l.description}):(0,i.jsx)(h.A,{placeholder:l.description})})},r)})})]}):null;var ej=a(95049);let e_=({selectedProvider:e,accessToken:t,providerParams:a=null,value:l=null})=>{let[r,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)(a),[c,m]=(0,s.useState)(null);if((0,s.useEffect)(()=>{if(a)return void d(a);let e=async()=>{if(t){n(!0),m(null);try{let e=await (0,p.getGuardrailProviderSpecificParams)(t);console.log("Provider params API response:",e),d(e),es(e),ed(e)}catch(e){console.error("Error fetching provider params:",e),m("Failed to load provider parameters")}finally{n(!1)}}};a||e()},[t,a]),!e)return null;if(r)return(0,i.jsx)(ej.A,{tip:"Loading provider parameters..."});if(c)return(0,i.jsx)("div",{className:"text-red-500",children:c});let u=eo[e]?.toLowerCase(),y=o&&o[u];if(console.log("Provider key:",u),console.log("Provider fields:",y),!y||0===Object.keys(y).length)return(0,i.jsx)("div",{children:"No configuration fields available for this provider."});console.log("Value:",l);let f=new Set(["patterns","blocked_words","blocked_words_file","categories","severity_threshold","pattern_redaction_format","keyword_redaction_tag"]),j=em(e),_=(e,t="",a)=>Object.entries(e).map(([e,r])=>{let s=t?`${t}.${e}`:e,n=a?a[e]:l?.[e];return(console.log("Field value:",n),"ui_friendly_name"===e||"optional_params"===e&&"nested"===r.type&&r.fields||j&&f.has(e))?null:"nested"===r.type&&r.fields?(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"mb-2 font-medium",children:e}),(0,i.jsx)("div",{className:"ml-4 border-l-2 border-gray-200 pl-4",children:_(r.fields,s,n)})]},s):(0,i.jsx)(x.A.Item,{name:s,label:e,tooltip:r.description,rules:r.required?[{required:!0,message:`${e} is required`}]:void 0,children:"select"===r.type&&r.options?(0,i.jsx)(g.A,{placeholder:r.description,defaultValue:n||r.default_value,children:r.options.map(e=>(0,i.jsx)(g.A.Option,{value:e,children:e},e))}):"multiselect"===r.type&&r.options?(0,i.jsx)(g.A,{mode:"multiple",placeholder:r.description,defaultValue:n||r.default_value,children:r.options.map(e=>(0,i.jsx)(g.A.Option,{value:e,children:e},e))}):"bool"===r.type||"boolean"===r.type?(0,i.jsxs)(g.A,{placeholder:r.description,defaultValue:void 0!==n?String(n):r.default_value,children:[(0,i.jsx)(g.A.Option,{value:"true",children:"True"}),(0,i.jsx)(g.A.Option,{value:"false",children:"False"})]}):"number"===r.type?(0,i.jsx)(ex.A,{step:1,width:400,placeholder:r.description,defaultValue:void 0!==n?Number(n):void 0}):e.includes("password")||e.includes("secret")||e.includes("key")?(0,i.jsx)(h.A.Password,{placeholder:r.description,defaultValue:n||""}):(0,i.jsx)(h.A,{placeholder:r.description,defaultValue:n||""})},s)});return(0,i.jsx)(i.Fragment,{children:_(y)})};var ev=a(22277),eb=a(61484),eA=a(86167),eC=a(6516),eN=a(45696),ew=a(50218);let{Text:eS}=u.A,{Option:ek}=g.A,eP=({categories:e,selectedCategories:t,onChange:a})=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center mb-2",children:[(0,i.jsx)(eN.A,{className:"text-gray-500 mr-1"}),(0,i.jsx)(eS,{className:"text-gray-500 font-medium",children:"Filter by category"})]}),(0,i.jsx)(g.A,{mode:"multiple",placeholder:"Select categories to filter by",style:{width:"100%"},onChange:a,value:t,allowClear:!0,showSearch:!0,optionFilterProp:"children",className:"mb-4",tagRender:e=>(0,i.jsx)(y.A,{color:"blue",closable:e.closable,onClose:e.onClose,className:"mr-2 mb-2",children:e.label}),children:e.map(e=>(0,i.jsx)(ek,{value:e.category,children:e.category},e.category))})]}),eI=({onSelectAll:e,onUnselectAll:t,hasSelectedEntities:a})=>(0,i.jsxs)("div",{className:"bg-gray-50 p-5 rounded-lg mb-6 border border-gray-200 shadow-sm",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(eS,{strong:!0,className:"text-gray-700 text-base",children:"Quick Actions"}),(0,i.jsx)(ev.A,{title:"Apply action to all PII types at once",children:(0,i.jsx)("div",{className:"ml-2 text-gray-400 cursor-help text-xs",children:"ⓘ"})})]}),(0,i.jsx)(f.Ay,{color:"danger",variant:"outlined",onClick:t,disabled:!a,icon:(0,i.jsx)(ew.A,{}),children:"Unselect All"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsx)(f.Ay,{color:"primary",variant:"outlined",onClick:()=>e("MASK"),className:"h-10",block:!0,icon:(0,i.jsx)(eA.A,{}),children:"Select All & Mask"}),(0,i.jsx)(f.Ay,{color:"danger",variant:"outlined",onClick:()=>e("BLOCK"),className:"h-10 hover:bg-red-100",block:!0,icon:(0,i.jsx)(eC.A,{}),children:"Select All & Block"})]})]}),eO=({entities:e,selectedEntities:t,selectedActions:a,actions:l,onEntitySelect:r,onActionSelect:s,entityToCategoryMap:n})=>(0,i.jsxs)("div",{className:"border rounded-lg overflow-hidden shadow-sm",children:[(0,i.jsxs)("div",{className:"bg-gray-50 px-5 py-3 border-b flex",children:[(0,i.jsx)(eS,{strong:!0,className:"flex-1 text-gray-700",children:"PII Type"}),(0,i.jsx)(eS,{strong:!0,className:"w-32 text-right text-gray-700",children:"Action"})]}),(0,i.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:0===e.length?(0,i.jsx)("div",{className:"py-10 text-center text-gray-500",children:"No PII types match your filter criteria"}):e.map(e=>(0,i.jsxs)("div",{className:`px-5 py-3 flex items-center justify-between hover:bg-gray-50 border-b ${t.includes(e)?"bg-blue-50":""}`,children:[(0,i.jsxs)("div",{className:"flex items-center flex-1",children:[(0,i.jsx)(eb.A,{checked:t.includes(e),onChange:()=>r(e),className:"mr-3"}),(0,i.jsx)(eS,{className:t.includes(e)?"font-medium text-gray-900":"text-gray-700",children:e.replace(/_/g," ")}),n.get(e)&&(0,i.jsx)(y.A,{className:"ml-2 text-xs",color:"blue",children:n.get(e)})]}),(0,i.jsx)("div",{className:"w-32",children:(0,i.jsx)(g.A,{value:t.includes(e)&&a[e]||"MASK",onChange:t=>s(e,t),style:{width:120},disabled:!t.includes(e),className:`${!t.includes(e)?"opacity-50":""}`,dropdownMatchSelectWidth:!1,children:l.map(e=>(0,i.jsx)(ek,{value:e,children:(0,i.jsxs)("div",{className:"flex items-center",children:[(e=>{switch(e){case"MASK":return(0,i.jsx)(eA.A,{style:{marginRight:4}});case"BLOCK":return(0,i.jsx)(eC.A,{style:{marginRight:4}});default:return null}})(e),e]})},e))})})]},e))})]}),{Title:eL,Text:eB}=u.A,eT=({entities:e,actions:t,selectedEntities:a,selectedActions:l,onEntitySelect:r,onActionSelect:n,entityCategories:o=[]})=>{let[d,c]=(0,s.useState)([]),m=new Map;o.forEach(e=>{e.entities.forEach(t=>{m.set(t,e.category)})});let p=e.filter(e=>0===d.length||d.includes(m.get(e)||""));return(0,i.jsxs)("div",{className:"pii-configuration",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-5",children:[(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)(eL,{level:4,className:"!m-0 font-semibold text-gray-800",children:"Configure PII Protection"})}),(0,i.jsxs)(eB,{className:"text-gray-500",children:[a.length," items selected"]})]}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)(eP,{categories:o,selectedCategories:d,onChange:c}),(0,i.jsx)(eI,{onSelectAll:t=>{e.forEach(e=>{a.includes(e)||r(e),n(e,t)})},onUnselectAll:()=>{a.forEach(e=>{r(e)})},hasSelectedEntities:a.length>0})]}),(0,i.jsx)(eO,{entities:p,selectedEntities:a,selectedActions:l,actions:t,onEntitySelect:r,onActionSelect:n,entityToCategoryMap:m})]})};var eE=a(99988),ez=a(7339),eF=a(25339),e$=a(94300);let eM={rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""},eR=({value:e,onChange:t,disabled:a=!1})=>{let l={...eM,...e||{},rules:e?.rules?[...e.rules]:[]},r=e=>{let a={...l,...e};t?.(a)},s=(e,t)=>{r({rules:l.rules.map((a,l)=>l===e?{...a,...t}:a)})},n=(e,t)=>{let a=l.rules[e];if(!a)return;let r=Object.entries(a.allowed_param_patterns||{});t(r);let i={};r.forEach(([e,t])=>{i[e]=t}),s(e,{allowed_param_patterns:Object.keys(i).length>0?i:void 0})};return(0,i.jsxs)(eE.Z,{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(eE.E,{className:"text-lg font-semibold",children:"Silinex Tool Permission Guardrail"}),(0,i.jsx)(eE.E,{className:"text-sm text-gray-500",children:"Provide regex patterns (e.g., ^mcp__github_.*$) for tool names or types and optionally constrain payload fields."})]}),!a&&(0,i.jsx)(f.Ay,{icon:(0,i.jsx)(d.A,{}),type:"primary",onClick:()=>{r({rules:[...l.rules,{id:`rule_${Math.random().toString(36).slice(2,8)}`,decision:"allow",allowed_param_patterns:void 0}]})},className:"!bg-blue-600 !text-white hover:!bg-blue-500",children:"Add Rule"})]}),(0,i.jsx)(ez.A,{}),0===l.rules.length?(0,i.jsx)(eF.A,{description:"No tool rules added yet"}):(0,i.jsx)("div",{className:"space-y-4",children:l.rules.map((e,t)=>{let o;return(0,i.jsxs)(eE.Z,{className:"bg-gray-50",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsxs)(eE.E,{className:"font-semibold",children:["Rule ",t+1]}),(0,i.jsx)(f.Ay,{icon:(0,i.jsx)(E.A,{}),danger:!0,type:"text",disabled:a,onClick:()=>{r({rules:l.rules.filter((e,a)=>a!==t)})},children:"Remove"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(eE.E,{className:"text-sm font-medium",children:"Rule ID"}),(0,i.jsx)(h.A,{disabled:a,placeholder:"unique_rule_id",value:e.id,onChange:e=>s(t,{id:e.target.value})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eE.E,{className:"text-sm font-medium",children:"Tool Name (optional)"}),(0,i.jsx)(h.A,{disabled:a,placeholder:"^mcp__github_.*$",value:e.tool_name??"",onChange:e=>s(t,{tool_name:""===e.target.value.trim()?void 0:e.target.value})})]})]}),(0,i.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 mt-4",children:(0,i.jsxs)("div",{children:[(0,i.jsx)(eE.E,{className:"text-sm font-medium",children:"Tool Type (optional)"}),(0,i.jsx)(h.A,{disabled:a,placeholder:"^function$",value:e.tool_type??"",onChange:e=>s(t,{tool_type:""===e.target.value.trim()?void 0:e.target.value})})]})}),(0,i.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,i.jsx)(eE.E,{className:"text-sm font-medium",children:"Decision"}),(0,i.jsxs)(g.A,{disabled:a,value:e.decision,style:{width:200},onChange:e=>s(t,{decision:e}),children:[(0,i.jsx)(g.A.Option,{value:"allow",children:"Allow"}),(0,i.jsx)(g.A.Option,{value:"deny",children:"Deny"})]})]}),(0,i.jsx)("div",{className:"mt-4",children:0===(o=Object.entries(e.allowed_param_patterns||{})).length?(0,i.jsx)(f.Ay,{disabled:a,size:"small",onClick:()=>s(t,{allowed_param_patterns:{"":""}}),children:"+ Restrict tool arguments (optional)"}):(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(eE.E,{className:"text-sm text-gray-600",children:"Argument constraints (dot or array paths)"}),o.map(([l,r],s)=>(0,i.jsxs)(b.A,{align:"start",children:[(0,i.jsx)(h.A,{disabled:a,placeholder:"messages[0].content",value:l,onChange:e=>{var a;return a=e.target.value,void n(t,e=>{if(!e[s])return;let[,t]=e[s];e[s]=[a,t]})}}),(0,i.jsx)(h.A,{disabled:a,placeholder:"^email@.*$",value:r,onChange:e=>{var a;return a=e.target.value,void n(t,e=>{if(!e[s])return;let[t]=e[s];e[s]=[t,a]})}}),(0,i.jsx)(f.Ay,{disabled:a,icon:(0,i.jsx)(E.A,{}),danger:!0,onClick:()=>n(t,e=>{e.splice(s,1)})})]},`${e.id||t}-${s}`)),(0,i.jsx)(f.Ay,{disabled:a,size:"small",onClick:()=>s(t,{allowed_param_patterns:{...e.allowed_param_patterns||{},"":""}}),children:"+ Add another constraint"})]})})]},e.id||t)})}),(0,i.jsx)(ez.A,{}),(0,i.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(eE.E,{className:"text-sm font-medium",children:"Default action"}),(0,i.jsxs)(g.A,{disabled:a,value:l.default_action,onChange:e=>r({default_action:e}),children:[(0,i.jsx)(g.A.Option,{value:"allow",children:"Allow"}),(0,i.jsx)(g.A.Option,{value:"deny",children:"Deny"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)(eE.E,{className:"text-sm font-medium flex items-center gap-1",children:["On disallowed action",(0,i.jsx)(ev.A,{title:"Block returns an error when a forbidden tool is invoked. Rewrite strips the tool call but lets the rest of the response continue.",children:(0,i.jsx)(e$.A,{})})]}),(0,i.jsxs)(g.A,{disabled:a,value:l.on_disallowed_action,onChange:e=>r({on_disallowed_action:e}),children:[(0,i.jsx)(g.A.Option,{value:"block",children:"Block"}),(0,i.jsx)(g.A.Option,{value:"rewrite",children:"Rewrite"})]})]})]}),(0,i.jsxs)("div",{className:"mt-4",children:[(0,i.jsx)(eE.E,{className:"text-sm font-medium",children:"Violation message (optional)"}),(0,i.jsx)(h.A.TextArea,{disabled:a,rows:3,placeholder:"This violates our org policy...",value:l.violation_message_template,onChange:e=>r({violation_message_template:e.target.value})})]})]})},{Title:eG,Text:eD,Link:eK}=u.A,{Option:eJ}=g.A,eq={pre_call:"Before LLM Call - Runs before the LLM call and checks the input (Recommended)",during_call:"During LLM Call - Runs in parallel with the LLM call, with response held until check completes",post_call:"After LLM Call - Runs after the LLM call and checks only the output",logging_only:"Logging Only - Only runs on logging callbacks without affecting the LLM call",pre_mcp_call:"Before MCP Tool Call - Runs before MCP tool execution and validates tool calls",during_mcp_call:"During MCP Tool Call - Runs in parallel with MCP tool execution for monitoring"},eW=({visible:e,onClose:t,accessToken:a,onSuccess:l,preset:r})=>{let[n]=x.A.useForm(),[o,d]=(0,s.useState)(!1),[c,m]=(0,s.useState)(null),[u,v]=(0,s.useState)(null),[b,A]=(0,s.useState)([]),[C,N]=(0,s.useState)({}),[w,S]=(0,s.useState)(0),[k,P]=(0,s.useState)(null),[I,O]=(0,s.useState)([]),[L,B]=(0,s.useState)(2),[T,E]=(0,s.useState)({}),[z,F]=(0,s.useState)([]),[$,M]=(0,s.useState)([]),[R,G]=(0,s.useState)([]),[D,K]=(0,s.useState)(""),[J,q]=(0,s.useState)(!1),[W,H]=(0,s.useState)(null),[U,V]=(0,s.useState)({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""}),Y=(0,s.useMemo)(()=>!!c&&"tool_permission"===(eo[c]||"").toLowerCase(),[c]);(0,s.useEffect)(()=>{a&&(async()=>{try{let[e,t]=await Promise.all([(0,p.getGuardrailUISettings)(a),(0,p.getGuardrailProviderSpecificParams)(a)]);v(e),P(t),es(t),ed(t)}catch(e){console.error("Error fetching guardrail data:",e),_.Ay.fromBackend("Failed to load guardrail configuration")}})()},[a]),(0,s.useEffect)(()=>{if(r&&e&&u&&(m(r.provider),n.setFieldsValue({provider:r.provider,guardrail_name:r.guardrailNameSuggestion,mode:r.mode,default_on:r.defaultOn}),r.categoryName&&u.content_filter_settings?.content_categories)){let e=u.content_filter_settings.content_categories.find(e=>e.name===r.categoryName);e&&G([{id:`category-${Date.now()}`,category:e.name,display_name:e.display_name,action:e.default_action,severity_threshold:"medium"}])}},[r,e,u]);let Z=e=>{m(e),n.setFieldsValue({config:void 0,presidio_analyzer_api_base:void 0,presidio_anonymizer_api_base:void 0}),A([]),N({}),O([]),B(2),E({}),F([]),M([]),G([]),K(""),q(!1),H(null),V({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""})},Q=e=>{A(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},X=(e,t)=>{N(a=>({...a,[e]:t}))},ee=async()=>{try{if(0===w&&(await n.validateFields(["guardrail_name","provider","mode","default_on"]),c)){let e=["guardrail_name","provider","mode","default_on"];"PresidioPII"===c&&e.push("presidio_analyzer_api_base","presidio_anonymizer_api_base"),await n.validateFields(e)}if(1===w&&ec(c)&&0===b.length)return void _.Ay.fromBackend("Please select at least one PII entity to continue");S(w+1)}catch(e){console.error("Form validation failed:",e)}},et=()=>{n.resetFields(),m(null),A([]),N({}),O([]),B(2),E({}),F([]),M([]),G([]),K(""),V({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""}),S(0)},ea=()=>{et(),t()},er=async()=>{try{d(!0),await n.validateFields();let e=n.getFieldsValue(!0),r=eo[e.provider],i={guardrail_name:e.guardrail_name,litellm_params:{guardrail:r,mode:e.mode,default_on:e.default_on},guardrail_info:{}};if("PresidioPII"===e.provider&&b.length>0){let t={};b.forEach(e=>{t[e]=C[e]||"MASK"}),i.litellm_params.pii_entities_config=t,e.presidio_analyzer_api_base&&(i.litellm_params.presidio_analyzer_api_base=e.presidio_analyzer_api_base),e.presidio_anonymizer_api_base&&(i.litellm_params.presidio_anonymizer_api_base=e.presidio_anonymizer_api_base)}if(em(e.provider)){let e=J&&W?.brand_self?.length>0;if(0===z.length&&0===$.length&&0===R.length&&!e){_.Ay.fromBackend("Please configure at least one content filter setting (category, pattern, keyword, or competitor intent)"),d(!1);return}z.length>0&&(i.litellm_params.patterns=z.map(e=>({pattern_type:"prebuilt"===e.type?"prebuilt":"regex",pattern_name:"prebuilt"===e.type?e.name:void 0,pattern:"custom"===e.type?e.pattern:void 0,name:e.name,action:e.action}))),$.length>0&&(i.litellm_params.blocked_words=$.map(e=>({keyword:e.keyword,action:e.action,description:e.description}))),R.length>0&&(i.litellm_params.categories=R.map(e=>({category:e.category,enabled:!0,action:e.action,severity_threshold:e.severity_threshold||"medium"}))),J&&W?.brand_self?.length>0&&(i.litellm_params.competitor_intent_config={competitor_intent_type:W.competitor_intent_type??"airline",brand_self:W.brand_self,locations:W.locations?.length>0?W.locations:void 0,competitors:"generic"===W.competitor_intent_type&&W.competitors?.length>0?W.competitors:void 0,policy:W.policy,threshold_high:W.threshold_high,threshold_medium:W.threshold_medium,threshold_low:W.threshold_low})}else if(e.config)try{i.guardrail_info=JSON.parse(e.config)}catch(e){_.Ay.fromBackend("Invalid JSON in configuration"),d(!1);return}if("tool_permission"===r){if(0===U.rules.length){_.Ay.fromBackend("Add at least one tool permission rule"),d(!1);return}i.litellm_params.rules=U.rules,i.litellm_params.default_action=U.default_action,i.litellm_params.on_disallowed_action=U.on_disallowed_action,U.violation_message_template&&(i.litellm_params.violation_message_template=U.violation_message_template)}if(console.log("values: ",JSON.stringify(e)),k&&c){let t=eo[c]?.toLowerCase();console.log("providerKey: ",t);let a=k[t]||{},l=new Set;console.log("providerSpecificParams: ",JSON.stringify(a)),Object.keys(a).forEach(e=>{"optional_params"!==e&&l.add(e)}),a.optional_params&&a.optional_params.fields&&Object.keys(a.optional_params.fields).forEach(e=>{l.add(e)}),console.log("allowedParams: ",l),l.forEach(t=>{let a=e[t];(null==a||""===a)&&(a=e.optional_params?.[t]),null!=a&&""!==a&&(i.litellm_params[t]=a)})}if(!a)throw Error("No access token available");console.log("Sending guardrail data:",JSON.stringify(i)),await (0,p.createGuardrailCall)(a,i),_.Ay.success("Guardrail created successfully"),et(),l(),t()}catch(e){console.error("Failed to create guardrail:",e),_.Ay.fromBackend("Failed to create guardrail: "+(e instanceof Error?e.message:String(e)))}finally{d(!1)}},ei=e=>{if(!u||!em(c))return null;let t=u.content_filter_settings;return t?(0,i.jsx)(el,{prebuiltPatterns:t.prebuilt_patterns||[],categories:t.pattern_categories||[],selectedPatterns:z,blockedWords:$,onPatternAdd:e=>F([...z,e]),onPatternRemove:e=>F(z.filter(t=>t.id!==e)),onPatternActionChange:(e,t)=>{F(z.map(a=>a.id===e?{...a,action:t}:a))},onBlockedWordAdd:e=>M([...$,e]),onBlockedWordRemove:e=>M($.filter(t=>t.id!==e)),onBlockedWordUpdate:(e,t,a)=>{M($.map(l=>l.id===e?{...l,[t]:a}:l))},contentCategories:t.content_categories||[],selectedContentCategories:R,onContentCategoryAdd:e=>G([...R,e]),onContentCategoryRemove:e=>G(R.filter(t=>t.id!==e)),onContentCategoryUpdate:(e,t,a)=>{G(R.map(l=>l.id===e?{...l,[t]:a}:l))},pendingCategorySelection:D,onPendingCategorySelectionChange:K,accessToken:a,showStep:e,competitorIntentEnabled:J,competitorIntentConfig:W,onCompetitorIntentChange:(e,t)=>{q(e),H(t)}}):null},ep=em(c)?[{title:"Basic Info",optional:!1},{title:"Default Categories",optional:!1},{title:"Patterns",optional:!1},{title:"Keywords",optional:!1}]:ec(c)?[{title:"Basic Info",optional:!1},{title:"PII Configuration",optional:!1}]:[{title:"Basic Info",optional:!1},{title:"Provider Configuration",optional:!1}];return(0,i.jsx)(j.A,{title:null,open:e,onCancel:ea,footer:null,width:1e3,closable:!1,className:"top-8",styles:{body:{padding:0}},children:(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,i.jsx)("h3",{className:"text-base font-semibold text-gray-900 m-0",children:"Create guardrail"}),(0,i.jsx)("button",{onClick:ea,className:"text-gray-400 hover:text-gray-600 bg-transparent border-none cursor-pointer text-base leading-none p-1",children:"✕"})]}),(0,i.jsx)("div",{className:"overflow-auto px-6 py-4",style:{maxHeight:"calc(80vh - 120px)"},children:(0,i.jsx)(x.A,{form:n,layout:"vertical",initialValues:{mode:"pre_call",default_on:!1},children:ep.map((e,t)=>{let l=t<w,r=t===w,s=t===ep.length-1;return(0,i.jsxs)("div",{className:"relative flex gap-4",style:{paddingBottom:8*!s},children:[(0,i.jsxs)("div",{className:"flex flex-col items-center flex-shrink-0",style:{width:24},children:[(0,i.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium flex-shrink-0",style:{background:l?"#4f46e5":r?"#fff":"#f8fafc",color:l?"#fff":r?"#4f46e5":"#94a3b8",border:r?"2px solid #4f46e5":l?"none":"1px solid #e2e8f0"},children:l?"✓":t+1}),!s&&(0,i.jsx)("div",{className:"flex-1",style:{width:1,background:l?"#4f46e5":"#e2e8f0",minHeight:16}})]}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",style:{paddingBottom:16*!s},children:[(0,i.jsxs)("div",{className:`flex items-center gap-2 ${l?"cursor-pointer":""}`,onClick:()=>{l&&S(t)},style:{minHeight:24},children:[(0,i.jsx)("span",{className:"text-sm",style:{fontWeight:r?600:500,color:r?"#1e293b":l?"#4f46e5":"#94a3b8"},children:e.title}),e.optional&&!r&&(0,i.jsx)("span",{className:"text-[11px] text-slate-400",children:"optional"}),l&&(0,i.jsx)("span",{className:"text-[11px] text-indigo-500 hover:underline",children:"Edit"})]}),r&&(0,i.jsx)("div",{className:"mt-3",children:(()=>{switch(w){case 0:return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.A.Item,{name:"guardrail_name",label:"Guardrail Name",rules:[{required:!0,message:"Please enter a guardrail name"}],children:(0,i.jsx)(h.A,{placeholder:"Enter a name for this guardrail"})}),(0,i.jsx)(x.A.Item,{name:"provider",label:"Guardrail Provider",rules:[{required:!0,message:"Please select a provider"}],children:(0,i.jsx)(g.A,{placeholder:"Select a guardrail provider",onChange:Z,labelInValue:!1,optionLabelProp:"label",dropdownRender:e=>e,showSearch:!0,children:Object.entries(en()).map(([e,t])=>(0,i.jsx)(eJ,{value:e,label:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[eu[t]&&(0,i.jsx)("img",{src:eu[t],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,i.jsx)("span",{children:t})]}),children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[eu[t]&&(0,i.jsx)("img",{src:eu[t],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,i.jsx)("span",{children:t})]})},e))})}),(0,i.jsx)(x.A.Item,{name:"mode",label:"Mode",tooltip:"How the guardrail should be applied",rules:[{required:!0,message:"Please select a mode"}],children:(0,i.jsx)(g.A,{optionLabelProp:"label",mode:"multiple",children:u?.supported_modes?.map(e=>(0,i.jsx)(eJ,{value:e,label:e,children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:e}),"pre_call"===e&&(0,i.jsx)(y.A,{color:"green",style:{marginLeft:"8px"},children:"Recommended"})]}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eq[e]})]})},e))||(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eJ,{value:"pre_call",label:"pre_call",children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"pre_call"})," ",(0,i.jsx)(y.A,{color:"green",children:"Recommended"})]}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eq.pre_call})]})}),(0,i.jsx)(eJ,{value:"during_call",label:"during_call",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:"during_call"})}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eq.during_call})]})}),(0,i.jsx)(eJ,{value:"post_call",label:"post_call",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:"post_call"})}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eq.post_call})]})}),(0,i.jsx)(eJ,{value:"logging_only",label:"logging_only",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:"logging_only"})}),(0,i.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eq.logging_only})]})})]})})}),(0,i.jsx)(x.A.Item,{name:"default_on",label:"Always On",tooltip:"If enabled, this guardrail will be applied to all requests by default.",children:(0,i.jsxs)(g.A,{children:[(0,i.jsx)(g.A.Option,{value:!0,children:"Yes"}),(0,i.jsx)(g.A.Option,{value:!1,children:"No"})]})}),!Y&&!em(c)&&(0,i.jsx)(e_,{selectedProvider:c,accessToken:a,providerParams:k})]});case 1:if(ec(c))return u&&"PresidioPII"===c?(0,i.jsx)(eT,{entities:u.supported_entities,actions:u.supported_actions,selectedEntities:b,selectedActions:C,onEntitySelect:Q,onActionSelect:X,entityCategories:u.pii_entity_categories}):null;if(em(c))return ei("categories");if(!c)return null;if(Y)return(0,i.jsx)(eR,{value:U,onChange:V});if(!k)return null;console.log("guardrail_provider_map: ",eo),console.log("selectedProvider: ",c);let e=eo[c]?.toLowerCase(),t=k&&k[e];return t&&t.optional_params?(0,i.jsx)(ef,{optionalParams:t.optional_params,parentFieldKey:"optional_params"}):null;case 2:if(em(c))return ei("patterns");return null;case 3:if(em(c))return ei("keywords");return null;default:return null}})()})]})]},t)})})}),(0,i.jsxs)("div",{className:"flex items-center justify-end space-x-3 px-6 py-3 border-t border-gray-200",children:[(0,i.jsx)(f.Ay,{onClick:ea,children:"Cancel"}),w>0&&(0,i.jsx)(f.Ay,{onClick:()=>{S(w-1)},children:"Previous"}),w<ep.length-1?(0,i.jsx)(f.Ay,{type:"primary",onClick:ee,children:"Next"}):(0,i.jsx)(f.Ay,{type:"primary",onClick:er,loading:o,children:"Create Guardrail"})]})]})})};var eH=a(38983),eU=a(19602),eV=a(30489),eY=a(96961),eZ=a(95517),eQ=a(8179),eX=a(31556),e0=a(95171),e1=a(45588),e2=a(14992),e4=a(17293),e6=a(73946),e8=a(77062),e5=a(37621),e3=a(3134),e9=a(21590);let{Title:e7,Text:te}=u.A,{Option:tt}=g.A,ta=({visible:e,onClose:t,accessToken:a,onSuccess:l,guardrailId:r,initialValues:n})=>{let[o]=x.A.useForm(),[d,c]=(0,s.useState)(!1),[m,u]=(0,s.useState)(n?.provider||null),[y,f]=(0,s.useState)(null),[v,b]=(0,s.useState)([]),[A,C]=(0,s.useState)({});(0,s.useEffect)(()=>{(async()=>{try{if(!a)return;let e=await (0,p.getGuardrailUISettings)(a);f(e)}catch(e){console.error("Error fetching guardrail settings:",e),_.Ay.fromBackend("Failed to load guardrail settings")}})()},[a]),(0,s.useEffect)(()=>{n?.pii_entities_config&&Object.keys(n.pii_entities_config).length>0&&(b(Object.keys(n.pii_entities_config)),C(n.pii_entities_config))},[n]);let N=e=>{b(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},w=(e,t)=>{C(a=>({...a,[e]:t}))},S=async()=>{try{c(!0);let e=await o.validateFields(),i=eo[e.provider],s={guardrail_id:r,guardrail:{guardrail_name:e.guardrail_name,litellm_params:{guardrail:i,mode:e.mode,default_on:e.default_on},guardrail_info:{}}};if("PresidioPII"===e.provider&&v.length>0){let e={};v.forEach(t=>{e[t]=A[t]||"MASK"}),s.guardrail.litellm_params.pii_entities_config=e}else if(e.config)try{let t=JSON.parse(e.config);"Bedrock"===e.provider&&t?(t.guardrail_id&&(s.guardrail.litellm_params.guardrailIdentifier=t.guardrail_id),t.guardrail_version&&(s.guardrail.litellm_params.guardrailVersion=t.guardrail_version)):s.guardrail.guardrail_info=t}catch(e){_.Ay.fromBackend("Invalid JSON in configuration"),c(!1);return}if(!a)throw Error("No access token available");console.log("Sending guardrail update data:",JSON.stringify(s));let n=`/guardrails/${r}`,d=await fetch(n,{method:"PUT",headers:{[(0,p.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!d.ok){let e=await d.text();throw Error(e||"Failed to update guardrail")}_.Ay.success("Guardrail updated successfully"),l(),t()}catch(e){console.error("Failed to update guardrail:",e),_.Ay.fromBackend("Failed to update guardrail: "+(e instanceof Error?e.message:String(e)))}finally{c(!1)}};return(0,i.jsx)(j.A,{title:"Edit Guardrail",open:e,onCancel:t,footer:null,width:700,children:(0,i.jsxs)(x.A,{form:o,layout:"vertical",initialValues:n,children:[(0,i.jsx)(x.A.Item,{name:"guardrail_name",label:"Guardrail Name",rules:[{required:!0,message:"Please enter a guardrail name"}],children:(0,i.jsx)(e9.k,{placeholder:"Enter a name for this guardrail"})}),(0,i.jsx)(x.A.Item,{name:"provider",label:"Guardrail Provider",rules:[{required:!0,message:"Please select a provider"}],children:(0,i.jsx)(g.A,{placeholder:"Select a guardrail provider",onChange:e=>{u(e),o.setFieldsValue({config:void 0}),b([]),C({})},disabled:!0,optionLabelProp:"label",children:Object.entries(en()).map(([e,t])=>(0,i.jsx)(tt,{value:e,label:t,children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[eu[t]&&(0,i.jsx)("img",{src:eu[t],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,i.jsx)("span",{children:t})]})},e))})}),(0,i.jsx)(x.A.Item,{name:"mode",label:"Mode",tooltip:"How the guardrail should be applied",rules:[{required:!0,message:"Please select a mode"}],children:(0,i.jsx)(g.A,{children:y?.supported_modes?.map(e=>(0,i.jsx)(tt,{value:e,children:e},e))||(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tt,{value:"pre_call",children:"pre_call"}),(0,i.jsx)(tt,{value:"post_call",children:"post_call"})]})})}),(0,i.jsx)(x.A.Item,{name:"default_on",label:"Always On",tooltip:"If enabled, this guardrail will be applied to all requests by default",valuePropName:"checked",children:(0,i.jsx)(U.A,{})}),(()=>{if(!m)return null;if("PresidioPII"===m)return y&&m&&"PresidioPII"===m?(0,i.jsx)(eT,{entities:y.supported_entities,actions:y.supported_actions,selectedEntities:v,selectedActions:A,onEntitySelect:N,onActionSelect:w,entityCategories:y.pii_entity_categories}):null;switch(m){case"Aporia":return(0,i.jsx)(x.A.Item,{label:"Aporia Configuration",name:"config",tooltip:"JSON configuration for Aporia",children:(0,i.jsx)(h.A.TextArea,{rows:4,placeholder:`{
  "api_key": "your_aporia_api_key",
  "project_name": "your_project_name"
}`})});case"AimSecurity":return(0,i.jsx)(x.A.Item,{label:"Aim Security Configuration",name:"config",tooltip:"JSON configuration for Aim Security",children:(0,i.jsx)(h.A.TextArea,{rows:4,placeholder:`{
  "api_key": "your_aim_api_key"
}`})});case"Bedrock":return(0,i.jsx)(x.A.Item,{label:"Amazon Bedrock Configuration",name:"config",tooltip:"JSON configuration for Amazon Bedrock guardrails",children:(0,i.jsx)(h.A.TextArea,{rows:4,placeholder:`{
  "guardrail_id": "your_guardrail_id",
  "guardrail_version": "your_guardrail_version"
}`})});case"GuardrailsAI":return(0,i.jsx)(x.A.Item,{label:"Guardrails.ai Configuration",name:"config",tooltip:"JSON configuration for Guardrails.ai",children:(0,i.jsx)(h.A.TextArea,{rows:4,placeholder:`{
  "api_key": "your_guardrails_api_key",
  "guardrail_id": "your_guardrail_id"
}`})});case"LakeraAI":return(0,i.jsx)(x.A.Item,{label:"Lakera AI Configuration",name:"config",tooltip:"JSON configuration for Lakera AI",children:(0,i.jsx)(h.A.TextArea,{rows:4,placeholder:`{
  "api_key": "your_lakera_api_key"
}`})});case"PromptInjection":return(0,i.jsx)(x.A.Item,{label:"Prompt Injection Configuration",name:"config",tooltip:"JSON configuration for prompt injection detection",children:(0,i.jsx)(h.A.TextArea,{rows:4,placeholder:`{
  "threshold": 0.8
}`})});default:return(0,i.jsx)(x.A.Item,{label:"Custom Configuration",name:"config",tooltip:"JSON configuration for your custom guardrail",children:(0,i.jsx)(h.A.TextArea,{rows:4,placeholder:`{
  "key1": "value1",
  "key2": "value2"
}`})})}})(),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,i.jsx)(e9.$,{variant:"secondary",onClick:t,children:"Cancel"}),(0,i.jsx)(e9.$,{onClick:S,loading:d,children:"Update Guardrail"})]})]})})};var tl=((r={}).DB="db",r.CONFIG="config",r);let tr=({guardrailsList:e,isLoading:t,onDeleteClick:a,accessToken:l,onGuardrailUpdated:r,isAdmin:n=!1,onGuardrailClick:o})=>{let[d,c]=(0,s.useState)([{id:"created_at",desc:!0}]),[m,p]=(0,s.useState)(!1),[u,g]=(0,s.useState)(null),x=e=>e?new Date(e).toLocaleString():"-",h=[{header:"Guardrail ID",accessorKey:"guardrail_id",cell:e=>(0,i.jsx)(ev.A,{title:String(e.getValue()||""),children:(0,i.jsx)(eH.A,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>e.getValue()&&o(e.getValue()),children:e.getValue()?`${String(e.getValue()).slice(0,7)}...`:""})})},{header:"Name",accessorKey:"guardrail_name",cell:({row:e})=>{let t=e.original;return(0,i.jsx)(ev.A,{title:t.guardrail_name,children:(0,i.jsx)("span",{className:"text-xs font-medium",children:t.guardrail_name||"-"})})}},{header:"Provider",accessorKey:"litellm_params.guardrail",cell:({row:e})=>{let{logo:t,displayName:a}=eg(e.original.litellm_params.guardrail);return(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[t&&(0,i.jsx)("img",{src:t,alt:`${a} logo`,className:"w-4 h-4",onError:e=>{e.target.style.display="none"}}),(0,i.jsx)("span",{className:"text-xs",children:a})]})}},{header:"Mode",accessorKey:"litellm_params.mode",cell:({row:e})=>{let t=e.original;return(0,i.jsx)("span",{className:"text-xs",children:t.litellm_params.mode})}},{header:"Default On",accessorKey:"litellm_params.default_on",cell:({row:e})=>{let t=e.original;return(0,i.jsx)(e8.E,{color:t.litellm_params?.default_on?"green":"gray",className:"text-xs font-normal",size:"xs",children:t.litellm_params?.default_on?"Default On":"Default Off"})}},{header:"Created At",accessorKey:"created_at",cell:({row:e})=>{let t=e.original;return(0,i.jsx)(ev.A,{title:t.created_at,children:(0,i.jsx)("span",{className:"text-xs",children:x(t.created_at)})})}},{header:"Updated At",accessorKey:"updated_at",cell:({row:e})=>{let t=e.original;return(0,i.jsx)(ev.A,{title:t.updated_at,children:(0,i.jsx)("span",{className:"text-xs",children:x(t.updated_at)})})}},{id:"actions",header:"Actions",cell:({row:e})=>{let t=e.original,l=t.guardrail_definition_location===tl.CONFIG;return(0,i.jsx)("div",{className:"flex space-x-2",children:l?(0,i.jsx)(ev.A,{title:"Config guardrail cannot be deleted on the dashboard. Please delete it from the config file.",children:(0,i.jsx)(eU.A,{"data-testid":"config-delete-icon",icon:e1.A,size:"sm",className:"cursor-not-allowed text-gray-400",title:"Config guardrail cannot be deleted on the dashboard. Please delete it from the config file.","aria-label":"Delete guardrail (config)"})}):(0,i.jsx)(ev.A,{title:"Delete guardrail",children:(0,i.jsx)(eU.A,{icon:e1.A,size:"sm",onClick:()=>t.guardrail_id&&a(t.guardrail_id,t.guardrail_name||"Unnamed Guardrail"),className:"cursor-pointer hover:text-red-500"})})})}}],y=(0,e5.N4)({data:e,columns:h,state:{sorting:d},onSortingChange:c,getCoreRowModel:(0,e3.HT)(),getSortedRowModel:(0,e3.h5)(),enableSorting:!0});return(0,i.jsxs)("div",{className:"rounded-lg custom-border relative",children:[(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)(eV.A,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,i.jsx)(eQ.A,{children:y.getHeaderGroups().map(e=>(0,i.jsx)(e0.A,{children:e.headers.map(e=>(0,i.jsx)(eX.A,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,i.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,i.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,e5.Kv)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,i.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,i.jsx)(e2.A,{className:"h-4 w-4 text-blue-500"}),desc:(0,i.jsx)(e4.A,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,i.jsx)(e6.A,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,i.jsx)(eY.A,{children:t?(0,i.jsx)(e0.A,{children:(0,i.jsx)(eZ.A,{colSpan:h.length,className:"h-8 text-center",children:(0,i.jsx)("div",{className:"text-center text-gray-500",children:(0,i.jsx)("p",{children:"Loading..."})})})}):e.length>0?y.getRowModel().rows.map(e=>(0,i.jsx)(e0.A,{className:"h-8",children:e.getVisibleCells().map(e=>(0,i.jsx)(eZ.A,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,children:(0,e5.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,i.jsx)(e0.A,{children:(0,i.jsx)(eZ.A,{colSpan:h.length,className:"h-8 text-center",children:(0,i.jsx)("div",{className:"text-center text-gray-500",children:(0,i.jsx)("p",{children:"No guardrails found"})})})})})]})}),u&&(0,i.jsx)(ta,{visible:m,onClose:()=>p(!1),accessToken:l,onSuccess:()=>{p(!1),g(null),r()},guardrailId:u.guardrail_id||"",initialValues:{guardrail_name:u.guardrail_name||"",provider:Object.keys(eo).find(e=>eo[e]===u?.litellm_params.guardrail)||"",mode:u.litellm_params.mode,default_on:u.litellm_params.default_on,pii_entities_config:u.litellm_params.pii_entities_config,...u.guardrail_info}})]})};var ti=a(90550),ts=a(14290),tn=a(88534),to=a(44926),td=a(34254),tc=a(42837),tm=a(13121),tp=a(2212),tu=a(87927),tg=a(56680),tx=a(73806),th=a(79363),ty=a(75892),tf=a(64628),tj=a(94514),t_=a(67635),tv=a(99876);let{Text:tb}=u.A,{Option:tA}=g.A,tC=({categories:e,onActionChange:t,onSeverityChange:a,onRemove:l,readOnly:r=!1})=>{let s=[{title:"Category",dataIndex:"display_name",key:"display_name",render:(e,t)=>(0,i.jsxs)("div",{children:[(0,i.jsx)(tb,{strong:!0,children:e}),e!==t.category&&(0,i.jsx)("div",{children:(0,i.jsx)(tb,{type:"secondary",style:{fontSize:12},children:t.category})})]})},{title:"Severity Threshold",dataIndex:"severity_threshold",key:"severity_threshold",width:180,render:(e,t)=>r?(0,i.jsx)(y.A,{color:{high:"red",medium:"orange",low:"yellow"}[e],children:e.toUpperCase()}):(0,i.jsxs)(g.A,{value:e,onChange:e=>a?.(t.id,e),style:{width:150},size:"small",children:[(0,i.jsx)(tA,{value:"high",children:"High"}),(0,i.jsx)(tA,{value:"medium",children:"Medium"}),(0,i.jsx)(tA,{value:"low",children:"Low"})]})},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,a)=>r?(0,i.jsx)(y.A,{color:"BLOCK"===e?"red":"blue",children:e}):(0,i.jsxs)(g.A,{value:e,onChange:e=>t?.(a.id,e),style:{width:120},size:"small",children:[(0,i.jsx)(tA,{value:"BLOCK",children:"Block"}),(0,i.jsx)(tA,{value:"MASK",children:"Mask"})]})}];return(r||s.push({title:"",key:"actions",width:100,render:(e,t)=>(0,i.jsx)(f.Ay,{type:"text",danger:!0,size:"small",icon:(0,i.jsx)(E.A,{}),onClick:()=>l?.(t.id),children:"Delete"})}),0===e.length)?(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"No categories configured."}):(0,i.jsx)(T.A,{dataSource:e,columns:s,rowKey:"id",pagination:!1,size:"small"})},tN=({patterns:e,blockedWords:t,categories:a=[],readOnly:l=!0,onPatternActionChange:r,onPatternRemove:s,onBlockedWordUpdate:n,onBlockedWordRemove:o,onCategoryActionChange:d,onCategorySeverityChange:c,onCategoryRemove:m})=>{if(0===e.length&&0===t.length&&0===a.length)return null;let p=()=>{};return(0,i.jsxs)(i.Fragment,{children:[a.length>0&&(0,i.jsxs)(tc.A,{className:"mt-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)(ty.A,{className:"text-lg font-semibold",children:"Content Categories"}),(0,i.jsxs)(td.A,{color:"blue",children:[a.length," categories configured"]})]}),(0,i.jsx)(tC,{categories:a,onActionChange:l?void 0:d,onSeverityChange:l?void 0:c,onRemove:l?void 0:m,readOnly:l})]}),e.length>0&&(0,i.jsxs)(tc.A,{className:"mt-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)(ty.A,{className:"text-lg font-semibold",children:"Pattern Detection"}),(0,i.jsxs)(td.A,{color:"blue",children:[e.length," patterns configured"]})]}),(0,i.jsx)($,{patterns:e,onActionChange:l?p:r||p,onRemove:l?p:s||p})]}),t.length>0&&(0,i.jsxs)(tc.A,{className:"mt-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)(ty.A,{className:"text-lg font-semibold",children:"Blocked Keywords"}),(0,i.jsxs)(td.A,{color:"blue",children:[t.length," keywords configured"]})]}),(0,i.jsx)(G,{keywords:t,onActionChange:l?p:n||p,onRemove:l?p:o||p})]})]})},{Text:tw}=u.A,tS=({guardrailData:e,guardrailSettings:t,isEditing:a,accessToken:l,onDataChange:r,onUnsavedChanges:n})=>{let[o,d]=(0,s.useState)([]),[c,m]=(0,s.useState)([]),[p,u]=(0,s.useState)([]),[g,x]=(0,s.useState)([]),[h,y]=(0,s.useState)([]),[f,j]=(0,s.useState)([]),[_,v]=(0,s.useState)(!1),[b,A]=(0,s.useState)(null),[C,N]=(0,s.useState)(!1),[w,S]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(e?.litellm_params?.patterns){let t=e.litellm_params.patterns.map((e,t)=>({id:`pattern-${t}`,type:"prebuilt"===e.pattern_type?"prebuilt":"custom",name:e.pattern_name||e.name,display_name:e.display_name,pattern:e.pattern,action:e.action||"BLOCK"}));d(t),x(t)}else d([]),x([]);if(e?.litellm_params?.blocked_words){let t=e.litellm_params.blocked_words.map((e,t)=>({id:`word-${t}`,keyword:e.keyword,action:e.action||"BLOCK",description:e.description}));m(t),y(t)}else m([]),y([]);if(e?.litellm_params?.categories?.length>0){let a=t?.content_filter_settings?.content_categories?Object.fromEntries(t.content_filter_settings.content_categories.map(e=>[e.name,e])):{},l=e.litellm_params.categories.map((e,t)=>{let l=a[e.category];return{id:`category-${t}`,category:e.category,display_name:l?.display_name??e.category,action:e.action||"BLOCK",severity_threshold:e.severity_threshold||"medium"}});u(l),j(l)}else u([]),j([]);let a=e?.litellm_params?.competitor_intent_config;if(a&&"object"==typeof a){let e=!!(a.brand_self&&Array.isArray(a.brand_self)&&a.brand_self.length>0),t={competitor_intent_type:a.competitor_intent_type??"airline",brand_self:Array.isArray(a.brand_self)?a.brand_self:[],locations:Array.isArray(a.locations)?a.locations:[],competitors:Array.isArray(a.competitors)?a.competitors:[],policy:a.policy??{competitor_comparison:"refuse",possible_competitor_comparison:"reframe"},threshold_high:"number"==typeof a.threshold_high?a.threshold_high:.7,threshold_medium:"number"==typeof a.threshold_medium?a.threshold_medium:.45,threshold_low:"number"==typeof a.threshold_low?a.threshold_low:.3};v(e),A(t),N(e),S(t)}else v(!1),A(null),N(!1),S(null)},[e,t?.content_filter_settings?.content_categories]),(0,s.useEffect)(()=>{r&&r(o,c,p,_,b)},[o,c,p,_,b,r]);let k=s.useMemo(()=>{let e=JSON.stringify(o)!==JSON.stringify(g),t=JSON.stringify(c)!==JSON.stringify(h),a=JSON.stringify(p)!==JSON.stringify(f),l=_!==C||JSON.stringify(b)!==JSON.stringify(w);return e||t||a||l},[o,c,p,_,b,g,h,f,C,w]);return((0,s.useEffect)(()=>{a&&n&&n(k)},[k,a,n]),e?.litellm_params?.guardrail!=="litellm_content_filter")?null:a?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ez.A,{orientation:"left",children:"Content Filter Configuration"}),k&&(0,i.jsx)(tv.A,{type:"warning",showIcon:!0,className:"mb-4",message:(0,i.jsx)(tw,{children:'You have unsaved changes to patterns or keywords. Remember to click "Save Changes" at the bottom.'})}),(0,i.jsx)("div",{className:"mb-6",children:t&&t.content_filter_settings&&(0,i.jsx)(el,{prebuiltPatterns:t.content_filter_settings.prebuilt_patterns||[],categories:t.content_filter_settings.pattern_categories||[],selectedPatterns:o,blockedWords:c,onPatternAdd:e=>d([...o,e]),onPatternRemove:e=>d(o.filter(t=>t.id!==e)),onPatternActionChange:(e,t)=>d(o.map(a=>a.id===e?{...a,action:t}:a)),onBlockedWordAdd:e=>m([...c,e]),onBlockedWordRemove:e=>m(c.filter(t=>t.id!==e)),onBlockedWordUpdate:(e,t,a)=>m(c.map(l=>l.id===e?{...l,[t]:a}:l)),onFileUpload:e=>{console.log("File uploaded:",e)},accessToken:l,contentCategories:t.content_filter_settings.content_categories||[],selectedContentCategories:p,onContentCategoryAdd:e=>u([...p,e]),onContentCategoryRemove:e=>u(p.filter(t=>t.id!==e)),onContentCategoryUpdate:(e,t,a)=>u(p.map(l=>l.id===e?{...l,[t]:a}:l)),competitorIntentEnabled:_,competitorIntentConfig:b,onCompetitorIntentChange:(e,t)=>{v(e),A(t)}})})]}):(0,i.jsx)(tN,{patterns:o,blockedWords:c,categories:p,readOnly:!0})};var tk=a(59615),tP=a(30866),tI=a(97209),tO=a(86960),tL=a(28508),tB=a(91242),tT=a(9018);let{Panel:tE}=D.A,{TextArea:tz}=h.A,tF={empty:{name:"Empty Template",code:`async def apply_guardrail(inputs, request_data, input_type):
    # inputs: {texts, images, tools, tool_calls, structured_messages, model}
    # request_data: {model, user_id, team_id, end_user_id, metadata}
    # input_type: "request" or "response"
    return allow()`},blockSSN:{name:"Block SSN",code:`def apply_guardrail(inputs, request_data, input_type):
    for text in inputs["texts"]:
        if regex_match(text, r"\\d{3}-\\d{2}-\\d{4}"):
            return block("SSN detected")
    return allow()`},redactEmail:{name:"Redact Emails",code:`def apply_guardrail(inputs, request_data, input_type):
    pattern = r"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}"
    modified = []
    for text in inputs["texts"]:
        modified.append(regex_replace(text, pattern, "[EMAIL REDACTED]"))
    return modify(texts=modified)`},blockSQL:{name:"Block SQL Injection",code:`def apply_guardrail(inputs, request_data, input_type):
    if input_type != "request":
        return allow()
    for text in inputs["texts"]:
        if contains_code_language(text, ["sql"]):
            return block("SQL code not allowed")
    return allow()`},validateJSON:{name:"Validate JSON",code:`def apply_guardrail(inputs, request_data, input_type):
    if input_type != "response":
        return allow()
    
    schema = {"type": "object", "required": ["name", "value"]}
    
    for text in inputs["texts"]:
        obj = json_parse(text)
        if obj is None:
            return block("Invalid JSON response")
        if not json_schema_valid(obj, schema):
            return block("Response missing required fields")
    return allow()`},externalAPI:{name:"External API Check (async)",code:`async def apply_guardrail(inputs, request_data, input_type):
    # Call an external moderation API (async for non-blocking)
    for text in inputs["texts"]:
        response = await http_post(
            "https://api.example.com/moderate",
            body={"text": text, "user_id": request_data["user_id"]},
            headers={"Authorization": "Bearer YOUR_API_KEY"},
            timeout=10
        )
        
        if not response["success"]:
            # API call failed, allow by default or block
            return allow()
        
        if response["body"].get("flagged"):
            return block(response["body"].get("reason", "Content flagged"))
    
    return allow()`}},t$={"Return Values":[{name:"allow()",desc:"Let request/response through"},{name:"block(reason)",desc:"Reject with message"},{name:"modify(texts=[], images=[], tool_calls=[])",desc:"Transform content"}],"HTTP Requests (async)":[{name:"await http_request(url, method, headers, body)",desc:"Make async HTTP request"},{name:"await http_get(url, headers)",desc:"Async GET request"},{name:"await http_post(url, body, headers)",desc:"Async POST request"}],"Regex Functions":[{name:"regex_match(text, pattern)",desc:"Returns True if pattern found"},{name:"regex_replace(text, pattern, replacement)",desc:"Replace all matches"},{name:"regex_find_all(text, pattern)",desc:"Return list of matches"}],"JSON Functions":[{name:"json_parse(text)",desc:"Parse JSON string, returns None on error"},{name:"json_stringify(obj)",desc:"Convert to JSON string"},{name:"json_schema_valid(obj, schema)",desc:"Validate against JSON schema"}],"URL Functions":[{name:"extract_urls(text)",desc:"Extract all URLs from text"},{name:"is_valid_url(url)",desc:"Check if URL is valid"},{name:"all_urls_valid(text)",desc:"Check all URLs in text are valid"}],"Code Detection":[{name:"detect_code(text)",desc:"Returns True if code detected"},{name:"detect_code_languages(text)",desc:"Returns list of detected languages"},{name:'contains_code_language(text, ["sql"])',desc:"Check for specific languages"}],"Text Utilities":[{name:"contains(text, substring)",desc:"Check if substring exists"},{name:"contains_any(text, [substr1, substr2])",desc:"Check if any substring exists"},{name:"word_count(text)",desc:"Count words"},{name:"char_count(text)",desc:"Count characters"},{name:"lower(text) / upper(text) / trim(text)",desc:"String transforms"}]},tM=[{value:"pre_call",label:"pre_call (Request)"},{value:"post_call",label:"post_call (Response)"},{value:"during_call",label:"during_call (Parallel)"},{value:"logging_only",label:"logging_only"},{value:"pre_mcp_call",label:"pre_mcp_call (Before MCP Tool Call)"},{value:"post_mcp_call",label:"post_mcp_call (After MCP Tool Call)"},{value:"during_mcp_call",label:"during_mcp_call (During MCP Tool Call)"}],tR=({visible:e,onClose:t,onSuccess:a,accessToken:l,editData:r})=>{let n=!!r,[o,d]=(0,s.useState)(""),[m,u]=(0,s.useState)(["pre_call"]),[x,h]=(0,s.useState)(!1),[y,f]=(0,s.useState)("empty"),[v,b]=(0,s.useState)(tF.empty.code),[A,C]=(0,s.useState)(!1),[N,w]=(0,s.useState)(!1),[S,k]=(0,s.useState)(!1),P={texts:["Hello, my SSN is 123-45-6789"],images:[],tools:[{type:"function",function:{name:"get_weather",description:"Get the current weather in a location",parameters:{type:"object",properties:{location:{type:"string",description:"City name"}},required:["location"]}}}],tool_calls:[],structured_messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:"Hello, my SSN is 123-45-6789"}],model:"gpt-4"},I={texts:["The weather in San Francisco is 72\xb0F and sunny."],images:[],tools:[],tool_calls:[{id:"call_abc123",type:"function",function:{name:"get_weather",arguments:'{"location": "San Francisco"}'}}],structured_messages:[],model:"gpt-4"},O={texts:['Tool: read_wiki_structure\nArguments: {"repoName": "BerriAI/litellm"}'],images:[],tools:[{type:"function",function:{name:"read_wiki_structure",description:"Read the structure of a GitHub repository (MCP tool passed as OpenAI tool)",parameters:{type:"object",properties:{repoName:{type:"string",description:"Repository name, e.g. BerriAI/litellm"}},required:["repoName"]}}}],tool_calls:[{id:"call_mcp_001",type:"function",function:{name:"read_wiki_structure",arguments:'{"repoName": "BerriAI/litellm"}'}}],structured_messages:[{role:"user",content:'Tool: read_wiki_structure\nArguments: {"repoName": "BerriAI/litellm"}'}],model:"mcp-tool-call"},[L,B]=(0,s.useState)(JSON.stringify(P,null,2)),[T,E]=(0,s.useState)(null),[z,F]=(0,s.useState)(null),$=(0,s.useRef)(null),M=e=>null==e?["pre_call"]:Array.isArray(e)?e.length?e:["pre_call"]:[e];(0,s.useEffect)(()=>{e&&(r?(d(r.guardrail_name||""),u(M(r.litellm_params?.mode)),h(r.litellm_params?.default_on||!1),b(r.litellm_params?.custom_code||tF.empty.code),f("")):(d(""),u(["pre_call"]),h(!1),f("empty"),b(tF.empty.code)),E(null),k(!1))},[e,r]);let R=async e=>{try{await navigator.clipboard.writeText(e),F(e),setTimeout(()=>F(null),2e3)}catch(e){console.error("Failed to copy:",e)}},G=async()=>{if(!o.trim())return void _.Ay.fromBackend("Please enter a guardrail name");if(!v.trim())return void _.Ay.fromBackend("Please enter custom code");if(!l)return void _.Ay.fromBackend("No access token available");C(!0);try{if(n&&r){let e={litellm_params:{custom_code:v}};o!==r.guardrail_name&&(e.guardrail_name=o);let t=M(r.litellm_params?.mode);(m.length!==t.length||m.some((e,a)=>e!==t[a]))&&(e.litellm_params.mode=m),x!==r.litellm_params?.default_on&&(e.litellm_params.default_on=x),await (0,p.updateGuardrailCall)(l,r.guardrail_id,e),_.Ay.success("Custom code guardrail updated successfully")}else await (0,p.createGuardrailCall)(l,{guardrail_name:o,litellm_params:{guardrail:"custom_code",mode:m,default_on:x,custom_code:v},guardrail_info:{}}),_.Ay.success("Custom code guardrail created successfully");a(),t()}catch(e){console.error("Failed to save guardrail:",e),_.Ay.fromBackend(`Failed to ${n?"update":"create"} guardrail: `+(e instanceof Error?e.message:String(e)))}finally{C(!1)}},K=async()=>{if(!l)return void E({error:"No access token available"});w(!0),E(null);try{let e;try{e=JSON.parse(L)}catch(e){E({error:"Invalid test input JSON"}),w(!1);return}e.texts||(e.texts=[]);let t=["pre_call","pre_mcp_call"],a=["post_call","post_mcp_call"],r=m.some(e=>t.includes(e))?"request":m.some(e=>a.includes(e))?"response":"request",i=await (0,p.testCustomCodeGuardrail)(l,{custom_code:v,test_input:e,input_type:r,request_data:{model:"test-model",metadata:{}}});i.success&&i.result?E(i.result):i.error?E({error:i.error,error_type:i.error_type}):E({error:"Unknown error occurred"})}catch(e){console.error("Failed to test custom code:",e),E({error:e instanceof Error?e.message:"Failed to test custom code"})}finally{w(!1)}},J=v.split("\n").length;return(0,i.jsxs)(j.A,{open:e,onCancel:t,footer:null,width:1400,className:"custom-code-modal",closable:!0,destroyOnClose:!0,children:[(0,i.jsxs)("div",{className:"flex flex-col h-[80vh]",children:[(0,i.jsxs)("div",{className:"pb-4 border-b border-gray-200",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:n?"Edit Custom Guardrail":"Create Custom Guardrail"}),(0,i.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Define custom logic using Python-like syntax"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-4 py-4 border-b border-gray-100",children:[(0,i.jsxs)("div",{className:"flex-1 max-w-[200px]",children:[(0,i.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Guardrail Name"}),(0,i.jsx)(e9.k,{value:o,onValueChange:d,placeholder:"e.g., block-pii-custom"})]}),(0,i.jsxs)("div",{className:"w-[280px]",children:[(0,i.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Mode (can select multiple)"}),(0,i.jsx)(g.A,{mode:"multiple",value:m,onChange:u,options:tM,className:"w-full",size:"middle",placeholder:"Select modes"})]}),(0,i.jsxs)("div",{className:"w-[180px]",children:[(0,i.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Template"}),(0,i.jsx)(g.A,{value:y,onChange:e=>{f(e),b(tF[e].code)},className:"w-full",size:"middle",dropdownRender:e=>(0,i.jsxs)(i.Fragment,{children:[e,(0,i.jsx)(ez.A,{style:{margin:"8px 0"}}),(0,i.jsxs)("div",{style:{padding:"8px 12px",cursor:"pointer",color:"#1890ff",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px"},onClick:e=>{e.preventDefault(),window.open("https://models.litellm.ai/guardrails","_blank")},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[(0,i.jsx)(tk.A,{}),(0,i.jsx)("span",{children:"Browse Community templates"}),(0,i.jsx)(tP.A,{style:{fontSize:"10px"}})]})]}),children:(0,i.jsx)(g.A.OptGroup,{label:"STANDARD",children:Object.entries(tF).map(([e,t])=>(0,i.jsx)(g.A.Option,{value:e,children:t.name},e))})})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 pt-5",children:[(0,i.jsx)("span",{className:"text-sm text-gray-600",children:"Default On"}),(0,i.jsx)(U.A,{checked:x,onChange:h})]})]}),(0,i.jsxs)("div",{className:"flex flex-1 overflow-hidden mt-4 gap-6",children:[(0,i.jsxs)("div",{className:"flex-[2] flex flex-col min-w-0 overflow-y-auto",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2 flex-shrink-0",children:[(0,i.jsx)("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Python Logic"}),(0,i.jsx)("span",{className:"text-xs text-gray-400",children:"Restricted environment (no imports)"})]}),(0,i.jsxs)("div",{className:"relative rounded-lg overflow-hidden border border-gray-700 bg-[#1e1e1e] flex-shrink-0",style:{minHeight:"300px",maxHeight:"400px"},children:[(0,i.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-12 bg-[#1e1e1e] border-r border-gray-700 text-right pr-3 pt-3 select-none overflow-hidden",style:{fontFamily:"'Fira Code', 'Monaco', 'Consolas', monospace",fontSize:"14px",lineHeight:"1.6"},children:Array.from({length:Math.max(J,20)},(e,t)=>(0,i.jsx)("div",{className:"text-gray-500 h-[22.4px]",children:t+1},t+1))}),(0,i.jsx)("textarea",{ref:$,value:v,onChange:e=>b(e.target.value),onKeyDown:e=>{if("Tab"===e.key){e.preventDefault();let t=e.currentTarget,a=t.selectionStart,l=t.selectionEnd;b(v.substring(0,a)+"    "+v.substring(l)),setTimeout(()=>{t.selectionStart=t.selectionEnd=a+4},0)}},spellCheck:!1,className:"w-full h-full pl-14 pr-4 pt-3 pb-3 resize-none focus:outline-none bg-transparent text-gray-200",style:{fontFamily:"'Fira Code', 'Monaco', 'Consolas', monospace",fontSize:"14px",lineHeight:"1.6",tabSize:4}})]}),(0,i.jsx)(D.A,{activeKey:S?["test"]:[],onChange:e=>k(e.includes("test")),className:"mt-3 bg-white border border-gray-200 rounded-lg flex-shrink-0",expandIcon:({isActive:e})=>(0,i.jsx)(tI.A,{rotate:90*!!e}),children:(0,i.jsx)(tE,{header:(0,i.jsxs)("span",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,i.jsx)(tO.A,{className:"text-blue-500"}),"Test Your Guardrail"]}),children:(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,i.jsx)("label",{className:"block text-xs font-medium text-gray-600",children:"Test Input (JSON)"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-xs text-gray-500",children:"Load example:"}),(0,i.jsx)("button",{type:"button",onClick:()=>B(JSON.stringify(P,null,2)),className:"px-2 py-1 text-xs rounded border border-orange-200 bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors",children:"Pre-call"}),(0,i.jsx)("button",{type:"button",onClick:()=>B(JSON.stringify(O,null,2)),className:"px-2 py-1 text-xs rounded border border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 transition-colors",children:"Pre MCP"}),(0,i.jsx)("button",{type:"button",onClick:()=>B(JSON.stringify(I,null,2)),className:"px-2 py-1 text-xs rounded border border-green-200 bg-green-50 text-green-700 hover:bg-green-100 transition-colors",children:"Post-call"})]})]}),(0,i.jsx)("div",{className:"mb-2 p-2 bg-gray-50 rounded text-xs text-gray-600 border border-gray-200",children:(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"texts"}),": Message content (always)"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"images"}),": Base64 images (vision)"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"tools"}),": Tool definitions ",(0,i.jsx)("span",{className:"text-orange-600",children:"(pre_call)"}),", MCP as OpenAI tool ",(0,i.jsx)("span",{className:"text-purple-600",children:"(pre_mcp_call)"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"tool_calls"}),": LLM tool calls ",(0,i.jsx)("span",{className:"text-green-600",children:"(post_call)"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"structured_messages"}),": Full messages ",(0,i.jsx)("span",{className:"text-orange-600",children:"(pre_call)"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"model"}),": Model name (always)"]})]})}),(0,i.jsx)(tz,{value:L,onChange:e=>B(e.target.value),rows:8,className:"font-mono text-xs",placeholder:'{"texts": ["test message"], ...}'})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(e9.$,{size:"xs",onClick:K,disabled:N,icon:tO.A,children:N?"Running...":"Run Test"}),T&&(0,i.jsx)("div",{className:`flex items-center gap-2 text-sm ${T.error?"text-red-600":"allow"===T.action?"text-green-600":"block"===T.action?"text-orange-600":"text-blue-600"}`,children:T.error?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tL.A,{}),(0,i.jsxs)("span",{children:[T.error_type&&(0,i.jsxs)("span",{className:"font-medium",children:["[",T.error_type,"] "]}),T.error]})]}):"allow"===T.action?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tB.A,{})," Allowed"]}):"block"===T.action?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tL.A,{})," Blocked: ",T.reason]}):"modify"===T.action?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tB.A,{})," Modified",T.texts&&T.texts.length>0&&(0,i.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["→ ",T.texts[0].substring(0,50),T.texts[0].length>50?"...":""]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tB.A,{})," ",T.action||"Unknown"]})})]})]})},"test")}),(0,i.jsxs)("div",{className:"mt-3 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg flex items-center justify-between flex-shrink-0",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"bg-blue-100 rounded-full p-2",children:(0,i.jsx)(tk.A,{className:"text-blue-600 text-lg"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-900",children:"Built a useful guardrail?"}),(0,i.jsx)("div",{className:"text-xs text-gray-600",children:"Share it with the community and help others build faster"})]})]}),(0,i.jsx)(e9.$,{size:"xs",onClick:()=>window.open("https://github.com/BerriAI/litellm-guardrails","_blank"),icon:tP.A,className:"bg-blue-600 hover:bg-blue-700 text-white border-0",children:"Contribute Template"})]})]}),(0,i.jsxs)("div",{className:"w-[300px] flex-shrink-0 overflow-auto border-l border-gray-200 pl-6",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,i.jsx)(c.A,{className:"text-blue-500"}),(0,i.jsx)("span",{className:"font-semibold text-gray-700",children:"Available Primitives"})]}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"Click to copy functions to clipboard"}),(0,i.jsx)(D.A,{defaultActiveKey:["Return Values"],className:"primitives-collapse bg-transparent border-0",expandIconPosition:"end",children:Object.entries(t$).map(([e,t])=>(0,i.jsx)(tE,{header:(0,i.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e}),className:"bg-white mb-2 rounded-lg border border-gray-200",children:(0,i.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,i.jsx)("button",{onClick:()=>R(e.name),className:`w-full text-left px-2 py-2 rounded transition-colors ${z===e.name?"bg-green-100":"bg-gray-50 hover:bg-blue-50"}`,children:z===e.name?(0,i.jsxs)("span",{className:"flex items-center gap-1 text-xs font-mono text-green-700",children:[(0,i.jsx)(tB.A,{})," Copied!"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"text-xs font-mono text-gray-800",children:e.name}),(0,i.jsx)("div",{className:"text-[10px] text-gray-500 mt-0.5",children:e.desc})]})},e.name))})},e))})]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between pt-4 mt-4 border-t border-gray-200",children:[(0,i.jsx)("span",{className:"text-xs text-gray-400",children:"Changes are auto-saved to local draft"}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(e9.$,{variant:"secondary",onClick:t,children:"Cancel"}),(0,i.jsx)(e9.$,{onClick:G,loading:A,disabled:A||!o.trim(),icon:tT.A,children:n?"Update Guardrail":"Save Guardrail"})]})]})]}),(0,i.jsx)("style",{children:`
        .custom-code-modal .ant-modal-content {
          padding: 24px;
        }
        .custom-code-modal .ant-modal-close {
          top: 20px;
          right: 20px;
        }
        .primitives-collapse .ant-collapse-item {
          border: none !important;
        }
        .primitives-collapse .ant-collapse-header {
          padding: 8px 12px !important;
        }
        .primitives-collapse .ant-collapse-content-box {
          padding: 8px 12px !important;
        }
      `})]})},tG=({guardrailId:e,onClose:t,accessToken:a,isAdmin:l})=>{let[r,n]=(0,s.useState)(null),[o,d]=(0,s.useState)(null),[m,u]=(0,s.useState)(!0),[y,j]=(0,s.useState)(!1),[v]=x.A.useForm(),[b,A]=(0,s.useState)([]),[C,N]=(0,s.useState)({}),[w,S]=(0,s.useState)(null),[k,P]=(0,s.useState)({}),[I,O]=(0,s.useState)(!1),L={rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""},[B,T]=(0,s.useState)(L),[E,z]=(0,s.useState)(!1),[F,$]=(0,s.useState)(!1),M=s.useRef({patterns:[],blockedWords:[],categories:[]}),R=(0,s.useCallback)((e,t,a,l,r)=>{M.current={patterns:e,blockedWords:t,categories:a||[],competitorIntentEnabled:l,competitorIntentConfig:r}},[]),G=async()=>{try{if(u(!0),!a)return;let t=await (0,p.getGuardrailInfo)(a,e);if(n(t),t.litellm_params?.pii_entities_config){let e=t.litellm_params.pii_entities_config;if(A([]),N({}),Object.keys(e).length>0){let t=[],a={};Object.entries(e).forEach(([e,l])=>{t.push(e),a[e]="string"==typeof l?l:"MASK"}),A(t),N(a)}}else A([]),N({})}catch(e){_.Ay.fromBackend("Failed to load guardrail information"),console.error("Error fetching guardrail info:",e)}finally{u(!1)}},D=async()=>{try{if(!a)return;let e=await (0,p.getGuardrailProviderSpecificParams)(a);d(e)}catch(e){console.error("Error fetching guardrail provider specific params:",e)}},K=async()=>{try{if(!a)return;let e=await (0,p.getGuardrailUISettings)(a);S(e)}catch(e){console.error("Error fetching guardrail UI settings:",e)}};(0,s.useEffect)(()=>{D()},[a]),(0,s.useEffect)(()=>{G(),K()},[e,a]),(0,s.useEffect)(()=>{r&&v&&v.setFieldsValue({guardrail_name:r.guardrail_name,...r.litellm_params,guardrail_info:r.guardrail_info?JSON.stringify(r.guardrail_info,null,2):"",...r.litellm_params?.optional_params&&{optional_params:r.litellm_params.optional_params}})},[r,o,v]);let J=(0,s.useCallback)(()=>{r?.litellm_params?.guardrail==="tool_permission"?T({rules:r.litellm_params?.rules||[],default_action:(r.litellm_params?.default_action||"deny").toLowerCase(),on_disallowed_action:(r.litellm_params?.on_disallowed_action||"block").toLowerCase(),violation_message_template:r.litellm_params?.violation_message_template||""}):T(L),z(!1)},[r]);(0,s.useEffect)(()=>{J()},[J]);let q=async t=>{try{if(!a)return;let c={litellm_params:{}};t.guardrail_name!==r.guardrail_name&&(c.guardrail_name=t.guardrail_name),t.default_on!==r.litellm_params?.default_on&&(c.litellm_params.default_on=t.default_on);let m=r.guardrail_info,u=t.guardrail_info?JSON.parse(t.guardrail_info):void 0;JSON.stringify(m)!==JSON.stringify(u)&&(c.guardrail_info=u);let g=r.litellm_params?.pii_entities_config||{},x={};if(b.forEach(e=>{x[e]=C[e]||"MASK"}),JSON.stringify(g)!==JSON.stringify(x)&&(c.litellm_params.pii_entities_config=x),r.litellm_params?.guardrail==="litellm_content_filter"&&I){var l,i,s,n,d;let e,t=(l=M.current.patterns||[],i=M.current.blockedWords||[],s=M.current.categories||[],n=M.current.competitorIntentEnabled,d=M.current.competitorIntentConfig,e={patterns:l.map(e=>({pattern_type:"prebuilt"===e.type?"prebuilt":"regex",pattern_name:"prebuilt"===e.type?e.name:void 0,pattern:"custom"===e.type?e.pattern:void 0,name:e.name,action:e.action})),blocked_words:i.map(e=>({keyword:e.keyword,action:e.action,description:e.description}))},void 0!==s&&(e.categories=s.map(e=>({category:e.category,enabled:!0,action:e.action,severity_threshold:e.severity_threshold||"medium"}))),n&&d&&d.brand_self.length>0&&(e.competitor_intent_config={competitor_intent_type:d.competitor_intent_type,brand_self:d.brand_self,locations:d.locations?.length?d.locations:void 0,competitors:"generic"===d.competitor_intent_type&&d.competitors?.length?d.competitors:void 0,policy:d.policy,threshold_high:d.threshold_high,threshold_medium:d.threshold_medium,threshold_low:d.threshold_low}),e);c.litellm_params.patterns=t.patterns,c.litellm_params.blocked_words=t.blocked_words,c.litellm_params.categories=t.categories,c.litellm_params.competitor_intent_config=t.competitor_intent_config??null}if(r.litellm_params?.guardrail==="tool_permission"){let e=r.litellm_params?.rules||[],t=B.rules||[],a=JSON.stringify(e)!==JSON.stringify(t),l=(r.litellm_params?.default_action||"deny").toLowerCase(),i=(B.default_action||"deny").toLowerCase(),s=l!==i,n=(r.litellm_params?.on_disallowed_action||"block").toLowerCase(),o=(B.on_disallowed_action||"block").toLowerCase(),d=n!==o,m=r.litellm_params?.violation_message_template||"",p=B.violation_message_template||"",u=m!==p;(E||a||s||d||u)&&(c.litellm_params.rules=t,c.litellm_params.default_action=i,c.litellm_params.on_disallowed_action=o,c.litellm_params.violation_message_template=p||null)}let h=Object.keys(eo).find(e=>eo[e]===r.litellm_params?.guardrail);console.log("values: ",JSON.stringify(t)),console.log("currentProvider: ",h);let y=r.litellm_params?.guardrail==="tool_permission";if(o&&h&&!y){let e=o[eo[h]?.toLowerCase()]||{},a=new Set;console.log("providerSpecificParams: ",JSON.stringify(e)),Object.keys(e).forEach(e=>{"optional_params"!==e&&a.add(e)}),e.optional_params&&e.optional_params.fields&&Object.keys(e.optional_params.fields).forEach(e=>{a.add(e)}),console.log("allowedParams: ",a),a.forEach(e=>{if("patterns"===e||"blocked_words"===e||"categories"===e)return;let a=t[e];(null==a||""===a)&&(a=t.optional_params?.[e]);let l=r.litellm_params?.[e];JSON.stringify(a)!==JSON.stringify(l)&&(null!=a&&""!==a?c.litellm_params[e]=a:null!=l&&""!==l&&(c.litellm_params[e]=null))})}if(0===Object.keys(c.litellm_params).length&&delete c.litellm_params,0===Object.keys(c).length){_.Ay.info("No changes detected"),j(!1);return}await (0,p.updateGuardrailCall)(a,e,c),_.Ay.success("Guardrail updated successfully"),O(!1),G(),j(!1)}catch(e){console.error("Error updating guardrail:",e),_.Ay.fromBackend("Failed to update guardrail")}};if(m)return(0,i.jsx)("div",{className:"p-4",children:"Loading..."});if(!r)return(0,i.jsx)("div",{className:"p-4",children:"Guardrail not found"});let W=e=>e?new Date(e).toLocaleString():"-",{logo:H,displayName:U}=eg(r.litellm_params?.guardrail||""),V=async(e,t)=>{await (0,tn.lW)(e)&&(P(e=>({...e,[t]:!0})),setTimeout(()=>{P(e=>({...e,[t]:!1}))},2e3))},Y="config"===r.guardrail_definition_location;return(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(f.Ay,{type:"text",icon:(0,i.jsx)(to.A,{className:"w-4 h-4"}),onClick:t,className:"mb-4",children:"Back to Guardrails"}),(0,i.jsx)(tf.A,{children:r.guardrail_name||"Unnamed Guardrail"}),(0,i.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,i.jsx)(ty.A,{className:"text-gray-500 font-mono",children:r.guardrail_id}),(0,i.jsx)(f.Ay,{type:"text",size:"small",icon:k["guardrail-id"]?(0,i.jsx)(tj.A,{size:12}):(0,i.jsx)(t_.A,{size:12}),onClick:()=>V(r.guardrail_id,"guardrail-id"),className:`left-2 z-10 transition-all duration-200 ${k["guardrail-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),(0,i.jsxs)(tu.A,{children:[(0,i.jsxs)(tg.A,{className:"mb-4",children:[(0,i.jsx)(tp.A,{children:"Overview"},"overview"),l?(0,i.jsx)(tp.A,{children:"Settings"},"settings"):(0,i.jsx)(i.Fragment,{})]}),(0,i.jsxs)(th.A,{children:[(0,i.jsxs)(tx.A,{children:[(0,i.jsxs)(tm.A,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,i.jsxs)(tc.A,{children:[(0,i.jsx)(ty.A,{children:"Provider"}),(0,i.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[H&&(0,i.jsx)("img",{src:H,alt:`${U} logo`,className:"w-6 h-6",onError:e=>{e.target.style.display="none"}}),(0,i.jsx)(tf.A,{children:U})]})]}),(0,i.jsxs)(tc.A,{children:[(0,i.jsx)(ty.A,{children:"Mode"}),(0,i.jsxs)("div",{className:"mt-2",children:[(0,i.jsx)(tf.A,{children:r.litellm_params?.mode||"-"}),(0,i.jsx)(td.A,{color:r.litellm_params?.default_on?"green":"gray",children:r.litellm_params?.default_on?"Default On":"Default Off"})]})]}),(0,i.jsxs)(tc.A,{children:[(0,i.jsx)(ty.A,{children:"Created At"}),(0,i.jsxs)("div",{className:"mt-2",children:[(0,i.jsx)(tf.A,{children:W(r.created_at)}),(0,i.jsxs)(ty.A,{children:["Last Updated: ",W(r.updated_at)]})]})]})]}),r.litellm_params?.pii_entities_config&&Object.keys(r.litellm_params.pii_entities_config).length>0&&(0,i.jsx)(tc.A,{className:"mt-6",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)(ty.A,{className:"font-medium",children:"PII Protection"}),(0,i.jsxs)(td.A,{color:"blue",children:[Object.keys(r.litellm_params.pii_entities_config).length," PII entities configured"]})]})}),r.litellm_params?.pii_entities_config&&Object.keys(r.litellm_params.pii_entities_config).length>0&&(0,i.jsxs)(tc.A,{className:"mt-6",children:[(0,i.jsx)(ty.A,{className:"mb-4 text-lg font-semibold",children:"PII Entity Configuration"}),(0,i.jsxs)("div",{className:"border rounded-lg overflow-hidden shadow-sm",children:[(0,i.jsxs)("div",{className:"bg-gray-50 px-5 py-3 border-b flex",children:[(0,i.jsx)(ty.A,{className:"flex-1 font-semibold text-gray-700",children:"Entity Type"}),(0,i.jsx)(ty.A,{className:"flex-1 font-semibold text-gray-700",children:"Configuration"})]}),(0,i.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:Object.entries(r.litellm_params?.pii_entities_config).map(([e,t])=>(0,i.jsxs)("div",{className:"px-5 py-3 flex border-b hover:bg-gray-50 transition-colors",children:[(0,i.jsx)(ty.A,{className:"flex-1 font-medium text-gray-900",children:e}),(0,i.jsx)(ty.A,{className:"flex-1",children:(0,i.jsxs)("span",{className:`inline-flex items-center gap-1.5 ${"MASK"===t?"text-blue-600":"text-red-600"}`,children:["MASK"===t?(0,i.jsx)(eA.A,{}):(0,i.jsx)(eC.A,{}),String(t)]})})]},e))})]})]}),r.litellm_params?.guardrail==="tool_permission"&&(0,i.jsx)(tc.A,{className:"mt-6",children:(0,i.jsx)(eR,{value:B,disabled:!0})}),r.litellm_params?.guardrail==="custom_code"&&r.litellm_params?.custom_code&&(0,i.jsxs)(tc.A,{className:"mt-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(c.A,{className:"text-blue-500"}),(0,i.jsx)(ty.A,{className:"font-medium text-lg",children:"Custom Code"})]}),l&&!Y&&(0,i.jsx)(f.Ay,{size:"small",icon:(0,i.jsx)(c.A,{}),onClick:()=>$(!0),children:"Edit Code"})]}),(0,i.jsx)("div",{className:"relative rounded-lg overflow-hidden border border-gray-700 bg-[#1e1e1e]",children:(0,i.jsx)("pre",{className:"p-4 text-sm text-gray-200 overflow-x-auto",style:{fontFamily:"'Fira Code', 'Monaco', 'Consolas', monospace"},children:(0,i.jsx)("code",{children:r.litellm_params.custom_code})})})]}),(0,i.jsx)(tS,{guardrailData:r,guardrailSettings:w,isEditing:!1,accessToken:a})]}),l&&(0,i.jsx)(tx.A,{children:(0,i.jsxs)(tc.A,{children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)(tf.A,{children:"Guardrail Settings"}),Y&&(0,i.jsx)(ev.A,{title:"Guardrail is defined in the config file and cannot be edited.",children:(0,i.jsx)(e$.A,{})}),!y&&!Y&&(r.litellm_params?.guardrail==="custom_code"?(0,i.jsx)(f.Ay,{icon:(0,i.jsx)(c.A,{}),onClick:()=>$(!0),children:"Edit Code"}):(0,i.jsx)(f.Ay,{onClick:()=>j(!0),children:"Edit Settings"}))]}),y?(0,i.jsxs)(x.A,{form:v,onFinish:q,initialValues:{guardrail_name:r.guardrail_name,...r.litellm_params,guardrail_info:r.guardrail_info?JSON.stringify(r.guardrail_info,null,2):"",...r.litellm_params?.optional_params&&{optional_params:r.litellm_params.optional_params}},layout:"vertical",children:[(0,i.jsx)(x.A.Item,{label:"Guardrail Name",name:"guardrail_name",rules:[{required:!0,message:"Please input a guardrail name"}],children:(0,i.jsx)(h.A,{placeholder:"Enter guardrail name"})}),(0,i.jsx)(x.A.Item,{label:"Default On",name:"default_on",children:(0,i.jsxs)(g.A,{children:[(0,i.jsx)(g.A.Option,{value:!0,children:"Yes"}),(0,i.jsx)(g.A.Option,{value:!1,children:"No"})]})}),r.litellm_params?.guardrail==="presidio"&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ez.A,{orientation:"left",children:"PII Protection"}),(0,i.jsx)("div",{className:"mb-6",children:w&&(0,i.jsx)(eT,{entities:w.supported_entities,actions:w.supported_actions,selectedEntities:b,selectedActions:C,onEntitySelect:e=>{A(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},onActionSelect:(e,t)=>{N(a=>({...a,[e]:t}))},entityCategories:w.pii_entity_categories})})]}),(0,i.jsx)(tS,{guardrailData:r,guardrailSettings:w,isEditing:!0,accessToken:a,onDataChange:R,onUnsavedChanges:O}),(r.litellm_params?.guardrail==="tool_permission"||o)&&(0,i.jsx)(ez.A,{orientation:"left",children:"Provider Settings"}),r.litellm_params?.guardrail==="tool_permission"?(0,i.jsx)(eR,{value:B,onChange:T}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e_,{selectedProvider:Object.keys(eo).find(e=>eo[e]===r.litellm_params?.guardrail)||null,accessToken:a,providerParams:o,value:r.litellm_params}),o&&(()=>{let e=Object.keys(eo).find(e=>eo[e]===r.litellm_params?.guardrail);if(!e)return null;let t=o[eo[e]?.toLowerCase()];return t&&t.optional_params?(0,i.jsx)(ef,{optionalParams:t.optional_params,parentFieldKey:"optional_params",values:r.litellm_params}):null})()]}),(0,i.jsx)(ez.A,{orientation:"left",children:"Advanced Settings"}),(0,i.jsx)(x.A.Item,{label:"Guardrail Information",name:"guardrail_info",children:(0,i.jsx)(h.A.TextArea,{rows:5})}),(0,i.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,i.jsx)(f.Ay,{onClick:()=>{j(!1),O(!1),J()},children:"Cancel"}),(0,i.jsx)(f.Ay,{type:"primary",htmlType:"submit",children:"Save Changes"})]})]}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(ty.A,{className:"font-medium",children:"Guardrail ID"}),(0,i.jsx)("div",{className:"font-mono",children:r.guardrail_id})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ty.A,{className:"font-medium",children:"Guardrail Name"}),(0,i.jsx)("div",{children:r.guardrail_name||"Unnamed Guardrail"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ty.A,{className:"font-medium",children:"Provider"}),(0,i.jsx)("div",{children:U})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ty.A,{className:"font-medium",children:"Mode"}),(0,i.jsx)("div",{children:r.litellm_params?.mode||"-"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ty.A,{className:"font-medium",children:"Default On"}),(0,i.jsx)(td.A,{color:r.litellm_params?.default_on?"green":"gray",children:r.litellm_params?.default_on?"Yes":"No"})]}),r.litellm_params?.pii_entities_config&&Object.keys(r.litellm_params.pii_entities_config).length>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)(ty.A,{className:"font-medium",children:"PII Protection"}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsxs)(td.A,{color:"blue",children:[Object.keys(r.litellm_params.pii_entities_config).length," PII entities configured"]})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ty.A,{className:"font-medium",children:"Created At"}),(0,i.jsx)("div",{children:W(r.created_at)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ty.A,{className:"font-medium",children:"Last Updated"}),(0,i.jsx)("div",{children:W(r.updated_at)})]}),r.litellm_params?.guardrail==="tool_permission"&&(0,i.jsx)(eR,{value:B,disabled:!0})]})]})})]})]}),(0,i.jsx)(tR,{visible:F,onClose:()=>$(!1),onSuccess:()=>{$(!1),G()},accessToken:a,editData:r?{guardrail_id:r.guardrail_id,guardrail_name:r.guardrail_name,litellm_params:r.litellm_params}:null})]})};var tD=a(34487),tK=a(21034),tJ=a(22347),tq=a(44647),tW=a(67667),tH=a(34537),tU=a(4551),tV=a(45960),tY=a(84425);let{Text:tZ}=u.A,tQ=function({results:e,errors:t}){let{t:a,locale:l}=(0,ts.o)(),r=(e,t)=>{let r=a(e);return r===e&&"zh-CN"===l?t:r},[n,o]=(0,s.useState)(new Set),d=e=>{let t=new Set(n);t.has(e)?t.delete(e):t.add(e),o(t)},c=async e=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();let a=document.execCommand("copy");if(document.body.removeChild(t),!a)throw Error("execCommand failed");return!0}}catch(e){return console.error("Copy failed:",e),!1}};return e||t?(0,i.jsxs)("div",{className:"space-y-3 pt-4 border-t border-gray-200",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:r("guardrailsPage.testResults.title","结果")}),e&&e.map(e=>{let t=n.has(e.guardrailName);return(0,i.jsx)(tU.Z,{className:"bg-green-50 border-green-200",children:(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer flex-1",onClick:()=>d(e.guardrailName),children:[t?(0,i.jsx)(tV.A,{className:"text-gray-500 text-xs"}):(0,i.jsx)(m.A,{className:"text-gray-500 text-xs"}),(0,i.jsx)(tB.A,{className:"text-green-600 text-lg"}),(0,i.jsx)("span",{className:"text-sm font-medium text-green-800",children:e.guardrailName})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-600",children:[(0,i.jsx)(tY.A,{}),(0,i.jsxs)("span",{className:"font-medium",children:[e.latency,"ms"]})]}),!t&&(0,i.jsx)(tU.$,{size:"xs",variant:"secondary",icon:tH.A,onClick:async()=>{await c(e.response_text)?_.Ay.success(r("guardrailsPage.testResults.notifications.resultCopied","结果已复制到剪贴板")):_.Ay.fromBackend(r("guardrailsPage.testResults.notifications.resultCopyFailed","复制结果失败"))},children:r("guardrailsPage.testResults.copyButton","复制")})]})]}),!t&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"bg-white border border-green-200 rounded p-3",children:[(0,i.jsx)("label",{className:"text-xs font-medium text-gray-600 mb-2 block",children:r("guardrailsPage.testResults.outputText","输出文本")}),(0,i.jsx)("div",{className:"font-mono text-sm text-gray-900 whitespace-pre-wrap break-words",children:e.response_text})]}),(0,i.jsxs)("div",{className:"text-xs text-gray-600",children:[(0,i.jsx)("span",{className:"font-medium",children:r("guardrailsPage.testResults.charactersLabel","字符数：")})," ",e.response_text.length]})]})]})},e.guardrailName)}),t&&t.map(e=>{let t=n.has(e.guardrailName);return(0,i.jsx)(tU.Z,{className:"bg-red-50 border-red-200",children:(0,i.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,i.jsx)("div",{className:"cursor-pointer mt-0.5",onClick:()=>d(e.guardrailName),children:t?(0,i.jsx)(tV.A,{className:"text-gray-500 text-xs"}):(0,i.jsx)(m.A,{className:"text-gray-500 text-xs"})}),(0,i.jsx)("div",{className:"text-red-600 mt-0.5",children:(0,i.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,i.jsxs)("p",{className:"text-sm font-medium text-red-800 cursor-pointer",onClick:()=>d(e.guardrailName),children:[e.guardrailName," ",r("guardrailsPage.testResults.errorSuffix","- 错误")]}),(0,i.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-600",children:[(0,i.jsx)(tY.A,{}),(0,i.jsxs)("span",{className:"font-medium",children:[e.latency,"ms"]})]})]}),!t&&(0,i.jsx)("p",{className:"text-sm text-red-700 mt-1",children:e.error.message})]})]})},e.guardrailName)})]}):null},{TextArea:tX}=h.A,{Text:t0}=u.A,t1=function({guardrailNames:e,onSubmit:t,isLoading:a,results:l,errors:r,onClose:n}){let{t:o,locale:d}=(0,ts.o)(),c=(e,t)=>{let a=o(e);return a===e&&"zh-CN"===d?t:a},[m,p]=(0,s.useState)(""),u=()=>{m.trim()?t(m):_.Ay.fromBackend(c("guardrailsPage.testPanel.notifications.enterText","请输入要测试的文本"))},g=async e=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();let a=document.execCommand("copy");if(document.body.removeChild(t),!a)throw Error("execCommand failed");return!0}}catch(e){return console.error("Copy failed:",e),!1}},x=async()=>{await g(m)?_.Ay.success(c("guardrailsPage.testPanel.notifications.inputCopied","输入已复制到剪贴板")):_.Ay.fromBackend(c("guardrailsPage.testPanel.notifications.inputCopyFailed","复制输入失败"))};return(0,i.jsxs)("div",{className:"space-y-4 h-full flex flex-col",children:[(0,i.jsx)("div",{className:"flex items-center justify-between pb-3 border-b border-gray-200",children:(0,i.jsx)("div",{className:"flex items-center space-x-3",children:(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:c("guardrailsPage.testPanel.title","测试护栏：")}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,i.jsx)("div",{className:"inline-flex items-center space-x-1 bg-blue-50 px-3 py-1 rounded-md border border-blue-200",children:(0,i.jsx)("span",{className:"font-mono text-blue-700 font-medium text-sm",children:e})},e))})]}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:c("guardrailsPage.testPanel.subtitle","测试 {count} 个护栏并对比结果").replace("{count}",String(e.length))})]})})}),(0,i.jsxs)("div",{className:"flex-1 overflow-auto space-y-4",children:[(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Input Text"}),(0,i.jsx)(ev.A,{title:c("guardrailsPage.testPanel.input.tooltip","按 Enter 提交，Shift+Enter 换行。"),children:(0,i.jsx)(e$.A,{className:"text-gray-400 cursor-help"})})]}),m&&(0,i.jsx)(tW.$,{size:"xs",variant:"secondary",icon:tH.A,onClick:x,children:c("guardrailsPage.testPanel.input.copyButton","复制输入")})]}),(0,i.jsx)(tX,{value:m,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||e.ctrlKey||e.metaKey||(e.preventDefault(),u())},placeholder:c("guardrailsPage.testPanel.input.placeholder","输入要用护栏测试的文本..."),rows:8,className:"font-mono text-sm"}),(0,i.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,i.jsxs)(t0,{className:"text-xs text-gray-500",children:[c("guardrailsPage.testPanel.input.shortcutPrefix","按")," ",(0,i.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs",children:"Enter"})," ",c("guardrailsPage.testPanel.input.shortcutMiddle","提交 •")," ",(0,i.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs",children:"Shift+Enter"})," ",c("guardrailsPage.testPanel.input.shortcutSuffix","换行")]}),(0,i.jsx)(t0,{className:"text-xs text-gray-500",children:c("guardrailsPage.testPanel.input.characters","字符数：{count}").replace("{count}",String(m.length))})]})]}),(0,i.jsx)("div",{className:"pt-2",children:(0,i.jsx)(tW.$,{onClick:u,loading:a,disabled:!m.trim(),className:"w-full",children:a?c("guardrailsPage.testPanel.buttons.testing","正在测试 {count} 个护栏...").replace("{count}",String(e.length)):c("guardrailsPage.testPanel.buttons.test","测试 {count} 个护栏").replace("{count}",String(e.length))})})]}),(0,i.jsx)(tQ,{results:l,errors:r})]})]})},t2=({guardrailsList:e,isLoading:t,accessToken:a,onClose:l})=>{let{t:r,locale:n}=(0,ts.o)(),o=(e,t)=>{let a=r(e);return a===e&&"zh-CN"===n?t:a},[d,c]=(0,s.useState)(new Set),[m,u]=(0,s.useState)(""),[g,x]=(0,s.useState)([]),[h,y]=(0,s.useState)([]),[f,j]=(0,s.useState)(!1),v=e.filter(e=>e.guardrail_name?.toLowerCase().includes(m.toLowerCase())),b=e=>{let t=new Set(d);t.has(e)?t.delete(e):t.add(e),c(t)},A=async e=>{if(0===d.size||!a)return;j(!0),x([]),y([]);let t=[],l=[];await Promise.all(Array.from(d).map(async r=>{let i=Date.now();try{let l=await (0,p.applyGuardrail)(a,r,e,null,null),s=Date.now()-i;t.push({guardrailName:r,response_text:l.response_text,latency:s})}catch(t){let e=Date.now()-i;console.error(`Error testing guardrail ${r}:`,t),l.push({guardrailName:r,error:t,latency:e})}})),x(t),y(l),j(!1),t.length>0&&_.Ay.success(o("guardrailsPage.playground.notifications.appliedSuccess","成功应用 {count} 个护栏").replace("{count}",String(t.length))),l.length>0&&_.Ay.fromBackend(o("guardrailsPage.playground.notifications.failed","{count} 个护栏执行失败").replace("{count}",String(l.length)))};return(0,i.jsx)("div",{className:"w-full h-[calc(100vh-200px)]",children:(0,i.jsx)(tc.A,{className:"h-full",children:(0,i.jsxs)("div",{className:"flex h-full",children:[(0,i.jsxs)("div",{className:"w-1/4 border-r border-gray-200 flex flex-col overflow-hidden",children:[(0,i.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)(tf.A,{className:"text-lg font-semibold mb-3",children:o("guardrailsPage.playground.sidebar.title","护栏")}),(0,i.jsx)(tD.A,{icon:tJ.A,placeholder:o("guardrailsPage.playground.sidebar.searchPlaceholder","搜索护栏..."),value:m,onValueChange:u})]})}),(0,i.jsx)("div",{className:"flex-1 overflow-auto",children:t?(0,i.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,i.jsx)(ej.A,{})}):0===v.length?(0,i.jsx)("div",{className:"p-4",children:(0,i.jsx)(eF.A,{description:m?o("guardrailsPage.playground.sidebar.noMatch","没有匹配搜索条件的护栏"):o("guardrailsPage.playground.sidebar.noAvailable","暂无可用护栏")})}):(0,i.jsx)(tK.A,{dataSource:v,renderItem:e=>(0,i.jsx)(tK.A.Item,{onClick:()=>{e.guardrail_name&&b(e.guardrail_name)},className:`cursor-pointer hover:bg-gray-50 transition-colors px-4 ${d.has(e.guardrail_name||"")?"bg-blue-50 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"}`,children:(0,i.jsx)(tK.A.Item.Meta,{avatar:(0,i.jsx)(eb.A,{checked:d.has(e.guardrail_name||""),onClick:t=>{t.stopPropagation(),e.guardrail_name&&b(e.guardrail_name)}}),title:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(tq.A,{className:"text-gray-400"}),(0,i.jsx)("span",{className:"font-medium text-gray-900",children:e.guardrail_name})]}),description:(0,i.jsxs)("div",{className:"text-xs space-y-1 mt-1",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("span",{className:"font-medium",children:[o("guardrailsPage.playground.sidebar.typeLabel","类型：")," "]}),(0,i.jsx)("span",{className:"text-gray-600",children:e.litellm_params.guardrail})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("span",{className:"font-medium",children:[o("guardrailsPage.playground.sidebar.modeLabel","模式：")," "]}),(0,i.jsx)("span",{className:"text-gray-600",children:e.litellm_params.mode})]})]})})})})}),(0,i.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:(0,i.jsx)(ty.A,{className:"text-xs text-gray-600",children:o("guardrailsPage.playground.sidebar.selectedCount","已选择 {selected} / {total}").replace("{selected}",String(d.size)).replace("{total}",String(v.length))})})]}),(0,i.jsxs)("div",{className:"w-3/4 flex flex-col bg-white",children:[(0,i.jsx)("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:(0,i.jsx)(tf.A,{className:"text-xl font-semibold mb-0",children:o("guardrailsPage.playground.main.title","护栏测试操场")})}),(0,i.jsx)("div",{className:"flex-1 overflow-auto p-4",children:0===d.size?(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[(0,i.jsx)(tq.A,{style:{fontSize:"48px",marginBottom:"16px"}}),(0,i.jsx)(ty.A,{className:"text-lg font-medium text-gray-600 mb-2",children:o("guardrailsPage.playground.empty.title","选择要测试的护栏")}),(0,i.jsx)(ty.A,{className:"text-center text-gray-500 max-w-md",children:o("guardrailsPage.playground.empty.description","从左侧选择一个或多个护栏，开始测试并对比结果。")})]}):(0,i.jsx)("div",{className:"h-full",children:(0,i.jsx)(t1,{guardrailNames:Array.from(d),onSubmit:A,results:g.length>0?g:null,errors:h.length>0?h:null,isLoading:f,onClose:()=>c(new Set)})})})]})]})})})};var t4=a(66793),t6=a(66446);let t8="../ui/assets/logos/",t5=[{id:"cf_denied_financial",name:"Denied Financial Advice",description:"Detects requests for personalized financial advice, investment recommendations, or financial planning.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Topic Blocker"],eval:{f1:100,precision:100,recall:100,testCases:207,latency:"<0.1ms"}},{id:"cf_denied_insults",name:"Insults & Personal Attacks",description:"Detects insults, name-calling, and personal attacks directed at the chatbot, staff, or other people.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Topic Blocker"],eval:{f1:100,precision:100,recall:100,testCases:299,latency:"<0.1ms"}},{id:"cf_denied_legal",name:"Denied Legal Advice",description:"Detects requests for unauthorized legal advice, case analysis, or legal recommendations.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Topic Blocker"]},{id:"cf_denied_medical",name:"Denied Medical Advice",description:"Detects requests for medical diagnosis, treatment recommendations, or health advice.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Topic Blocker"]},{id:"cf_harmful_violence",name:"Harmful Violence",description:"Detects content related to violence, criminal planning, attacks, and violent threats.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Safety"]},{id:"cf_harmful_self_harm",name:"Harmful Self-Harm",description:"Detects content related to self-harm, suicide, and dangerous self-destructive behavior.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Safety"]},{id:"cf_harmful_child_safety",name:"Harmful Child Safety",description:"Detects content that could endanger child safety or exploit minors.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Safety"]},{id:"cf_harmful_illegal_weapons",name:"Harmful Illegal Weapons",description:"Detects content related to illegal weapons manufacturing, distribution, or acquisition.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Safety"]},{id:"cf_bias_gender",name:"Bias: Gender",description:"Detects gender-based discrimination, stereotypes, and biased language.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Bias"]},{id:"cf_bias_racial",name:"Bias: Racial",description:"Detects racial discrimination, stereotypes, and racially biased content.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Bias"]},{id:"cf_bias_religious",name:"Bias: Religious",description:"Detects religious discrimination, intolerance, and religiously biased content.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Bias"]},{id:"cf_bias_sexual_orientation",name:"Bias: Sexual Orientation",description:"Detects discrimination based on sexual orientation and related biased content.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Bias"]},{id:"cf_prompt_injection_jailbreak",name:"Prompt Injection: Jailbreak",description:"Detects jailbreak attempts designed to bypass AI safety guidelines and restrictions.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Prompt Injection"]},{id:"cf_prompt_injection_data_exfil",name:"Prompt Injection: Data Exfiltration",description:"Detects attempts to extract sensitive data through prompt manipulation.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Prompt Injection"]},{id:"cf_prompt_injection_sql",name:"Prompt Injection: SQL",description:"Detects SQL injection attempts embedded in prompts.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Prompt Injection"]},{id:"cf_prompt_injection_malicious_code",name:"Prompt Injection: Malicious Code",description:"Detects attempts to inject malicious code through prompts.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Prompt Injection"]},{id:"cf_prompt_injection_system_prompt",name:"Prompt Injection: System Prompt",description:"Detects attempts to extract or override system prompts.",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Prompt Injection"]},{id:"cf_toxic_abuse",name:"Toxic & Abusive Language",description:"Detects toxic, abusive, and hateful language across multiple languages (EN, AU, DE, ES, FR).",category:"litellm",subcategory:"Content Category",logo:`${t8}litellm_logo.jpg`,tags:["Content Category","Toxicity"]},{id:"cf_patterns",name:"Pattern Matching",description:"Detect and block sensitive data patterns like SSNs, credit card numbers, API keys, and custom regex patterns.",category:"litellm",subcategory:"Patterns",logo:`${t8}litellm_logo.jpg`,tags:["PII","Regex","Data Protection"]},{id:"cf_keywords",name:"Keyword Blocking",description:"Block or mask content containing specific keywords or phrases. Upload custom word lists or add individual terms.",category:"litellm",subcategory:"Keywords",logo:`${t8}litellm_logo.jpg`,tags:["Keywords","Blocklist"]},{id:"presidio",name:"Presidio PII",description:"Microsoft Presidio for PII detection and anonymization. Supports 30+ entity types with configurable actions.",category:"partner",logo:`${t8}microsoft_azure.svg`,tags:["PII","Microsoft"],providerKey:"PresidioPII"},{id:"bedrock",name:"Bedrock Guardrail",description:"AWS Bedrock Guardrails for content filtering, topic avoidance, and sensitive information detection.",category:"partner",logo:`${t8}bedrock.svg`,tags:["AWS","Content Safety"],providerKey:"Bedrock"},{id:"lakera",name:"Lakera",description:"AI security platform protecting against prompt injections, data leakage, and harmful content.",category:"partner",logo:`${t8}lakeraai.jpeg`,tags:["Security","Prompt Injection"],providerKey:"Lakera"},{id:"openai_moderation",name:"OpenAI Moderation",description:"OpenAI's content moderation API for detecting harmful content across multiple categories.",category:"partner",logo:`${t8}openai_small.svg`,tags:["Content Moderation","OpenAI"]},{id:"google_model_armor",name:"Google Cloud Model Armor",description:"Google Cloud's model protection service for safe and responsible AI deployments.",category:"partner",logo:`${t8}google.svg`,tags:["Google Cloud","Safety"]},{id:"guardrails_ai",name:"Guardrails AI",description:"Open-source framework for adding structural, type, and quality guarantees to LLM outputs.",category:"partner",logo:`${t8}guardrails_ai.jpeg`,tags:["Open Source","Validation"]},{id:"zscaler",name:"Zscaler AI Guard",description:"Enterprise AI security from Zscaler for monitoring and protecting AI/ML workloads.",category:"partner",logo:`${t8}zscaler.svg`,tags:["Enterprise","Security"]},{id:"panw",name:"PANW Prisma AIRS",description:"Palo Alto Networks Prisma AI Runtime Security for securing AI applications in production.",category:"partner",logo:`${t8}palo_alto_networks.jpeg`,tags:["Enterprise","Security"]},{id:"noma",name:"Noma Security",description:"AI security platform for detecting and preventing AI-specific threats and vulnerabilities.",category:"partner",logo:`${t8}noma_security.png`,tags:["Security","Threat Detection"]},{id:"aporia",name:"Aporia AI",description:"Real-time AI guardrails for hallucination detection, topic control, and policy enforcement.",category:"partner",logo:`${t8}aporia.png`,tags:["Hallucination","Policy"]},{id:"aim",name:"AIM Guardrail",description:"AIM Security guardrails for comprehensive AI threat detection and mitigation.",category:"partner",logo:`${t8}aim_security.jpeg`,tags:["Security","Threat Detection"]},{id:"prompt_security",name:"Prompt Security",description:"Protect against prompt injection attacks, data leakage, and other LLM security threats.",category:"partner",logo:`${t8}prompt_security.png`,tags:["Prompt Injection","Security"]},{id:"lasso",name:"Lasso Guardrail",description:"Content moderation and safety guardrails for responsible AI deployments.",category:"partner",logo:`${t8}lasso.png`,tags:["Content Moderation"]},{id:"pangea",name:"Pangea Guardrail",description:"Pangea's AI guardrails for secure, compliant, and trustworthy AI applications.",category:"partner",logo:`${t8}pangea.png`,tags:["Compliance","Security"]},{id:"enkryptai",name:"EnkryptAI",description:"AI security and governance platform for enterprise AI safety and compliance.",category:"partner",logo:`${t8}enkrypt_ai.avif`,tags:["Enterprise","Governance"]},{id:"javelin",name:"Javelin Guardrails",description:"AI gateway with built-in guardrails for secure and compliant AI operations.",category:"partner",logo:`${t8}javelin.png`,tags:["Gateway","Security"]},{id:"pillar",name:"Pillar Guardrail",description:"AI safety platform for monitoring, testing, and securing AI systems.",category:"partner",logo:`${t8}pillar.jpeg`,tags:["Monitoring","Safety"]}];var t3=a(35120);let t9=({src:e,name:t})=>{let[a,l]=(0,s.useState)(!1);return a||!e?(0,i.jsx)("div",{style:{width:28,height:28,borderRadius:6,backgroundColor:"#e5e7eb",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,fontWeight:600,color:"#6b7280",flexShrink:0},children:t?.charAt(0)||"?"}):(0,i.jsx)("img",{src:e,alt:"",style:{width:28,height:28,borderRadius:6,objectFit:"contain",flexShrink:0},onError:()=>l(!0)})},t7=({card:e,onClick:t})=>{let[a,l]=(0,s.useState)(!1);return(0,i.jsxs)("div",{onClick:t,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),style:{borderRadius:12,border:a?"1px solid #93c5fd":"1px solid #e5e7eb",backgroundColor:"#ffffff",padding:"20px 20px 16px 20px",cursor:"pointer",transition:"border-color 0.15s, box-shadow 0.15s",display:"flex",flexDirection:"column",minHeight:170,boxShadow:a?"0 1px 6px rgba(59,130,246,0.08)":"none"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:10},children:[(0,i.jsx)(t9,{src:e.logo,name:e.name}),(0,i.jsx)("span",{style:{fontSize:14,fontWeight:600,color:"#111827",lineHeight:1.3},children:e.name})]}),(0,i.jsx)("p",{className:"line-clamp-3",style:{fontSize:12,color:"#6b7280",lineHeight:1.6,margin:0,flex:1},children:e.description}),e.eval&&(0,i.jsxs)("div",{style:{marginTop:10,display:"flex",alignItems:"center",gap:4},children:[(0,i.jsx)(t3.A,{style:{color:"#16a34a",fontSize:12}}),(0,i.jsxs)("span",{style:{fontSize:11,color:"#16a34a",fontWeight:500},children:["F1: ",e.eval.f1,"% \xb7 ",e.eval.testCases," test cases"]})]})]})};var ae=a(89889);let at={cf_denied_financial:{provider:"LitellmContentFilter",categoryName:"denied_financial_advice",guardrailNameSuggestion:"Denied Financial Advice",mode:"pre_call",defaultOn:!1},cf_denied_legal:{provider:"LitellmContentFilter",categoryName:"denied_legal_advice",guardrailNameSuggestion:"Denied Legal Advice",mode:"pre_call",defaultOn:!1},cf_denied_medical:{provider:"LitellmContentFilter",categoryName:"denied_medical_advice",guardrailNameSuggestion:"Denied Medical Advice",mode:"pre_call",defaultOn:!1},cf_denied_insults:{provider:"LitellmContentFilter",categoryName:"denied_insults",guardrailNameSuggestion:"Insults & Personal Attacks",mode:"pre_call",defaultOn:!1},cf_harmful_violence:{provider:"LitellmContentFilter",categoryName:"harmful_violence",guardrailNameSuggestion:"Harmful Violence",mode:"pre_call",defaultOn:!1},cf_harmful_self_harm:{provider:"LitellmContentFilter",categoryName:"harmful_self_harm",guardrailNameSuggestion:"Harmful Self-Harm",mode:"pre_call",defaultOn:!1},cf_harmful_child_safety:{provider:"LitellmContentFilter",categoryName:"harmful_child_safety",guardrailNameSuggestion:"Harmful Child Safety",mode:"pre_call",defaultOn:!1},cf_harmful_illegal_weapons:{provider:"LitellmContentFilter",categoryName:"harmful_illegal_weapons",guardrailNameSuggestion:"Harmful Illegal Weapons",mode:"pre_call",defaultOn:!1},cf_bias_gender:{provider:"LitellmContentFilter",categoryName:"bias_gender",guardrailNameSuggestion:"Bias: Gender",mode:"pre_call",defaultOn:!1},cf_bias_racial:{provider:"LitellmContentFilter",categoryName:"bias_racial",guardrailNameSuggestion:"Bias: Racial",mode:"pre_call",defaultOn:!1},cf_bias_religious:{provider:"LitellmContentFilter",categoryName:"bias_religious",guardrailNameSuggestion:"Bias: Religious",mode:"pre_call",defaultOn:!1},cf_bias_sexual_orientation:{provider:"LitellmContentFilter",categoryName:"bias_sexual_orientation",guardrailNameSuggestion:"Bias: Sexual Orientation",mode:"pre_call",defaultOn:!1},cf_prompt_injection_jailbreak:{provider:"LitellmContentFilter",categoryName:"prompt_injection_jailbreak",guardrailNameSuggestion:"Prompt Injection: Jailbreak",mode:"pre_call",defaultOn:!1},cf_prompt_injection_data_exfil:{provider:"LitellmContentFilter",categoryName:"prompt_injection_data_exfiltration",guardrailNameSuggestion:"Prompt Injection: Data Exfiltration",mode:"pre_call",defaultOn:!1},cf_prompt_injection_sql:{provider:"LitellmContentFilter",categoryName:"prompt_injection_sql",guardrailNameSuggestion:"Prompt Injection: SQL",mode:"pre_call",defaultOn:!1},cf_prompt_injection_malicious_code:{provider:"LitellmContentFilter",categoryName:"prompt_injection_malicious_code",guardrailNameSuggestion:"Prompt Injection: Malicious Code",mode:"pre_call",defaultOn:!1},cf_prompt_injection_system_prompt:{provider:"LitellmContentFilter",categoryName:"prompt_injection_system_prompt",guardrailNameSuggestion:"Prompt Injection: System Prompt",mode:"pre_call",defaultOn:!1},cf_toxic_abuse:{provider:"LitellmContentFilter",categoryName:"harm_toxic_abuse",guardrailNameSuggestion:"Toxic & Abusive Language",mode:"pre_call",defaultOn:!1},cf_patterns:{provider:"LitellmContentFilter",guardrailNameSuggestion:"Pattern Matching",mode:"pre_call",defaultOn:!1},cf_keywords:{provider:"LitellmContentFilter",guardrailNameSuggestion:"Keyword Blocking",mode:"pre_call",defaultOn:!1},presidio:{provider:"PresidioPII",guardrailNameSuggestion:"Presidio PII",mode:"pre_call",defaultOn:!1},bedrock:{provider:"Bedrock",guardrailNameSuggestion:"Bedrock Guardrail",mode:"pre_call",defaultOn:!1},lakera:{provider:"Lakera",guardrailNameSuggestion:"Lakera",mode:"pre_call",defaultOn:!1},openai_moderation:{provider:"OpenaiModeration",guardrailNameSuggestion:"OpenAI Moderation",mode:"pre_call",defaultOn:!1},google_model_armor:{provider:"ModelArmor",guardrailNameSuggestion:"Google Cloud Model Armor",mode:"pre_call",defaultOn:!1},guardrails_ai:{provider:"GuardrailsAi",guardrailNameSuggestion:"Guardrails AI",mode:"pre_call",defaultOn:!1},zscaler:{provider:"ZscalerAiGuard",guardrailNameSuggestion:"Zscaler AI Guard",mode:"pre_call",defaultOn:!1},panw:{provider:"PanwPrismaAirs",guardrailNameSuggestion:"PANW Prisma AIRS",mode:"pre_call",defaultOn:!1},noma:{provider:"Noma",guardrailNameSuggestion:"Noma Security",mode:"pre_call",defaultOn:!1},aporia:{provider:"AporiaAi",guardrailNameSuggestion:"Aporia AI",mode:"pre_call",defaultOn:!1},aim:{provider:"Aim",guardrailNameSuggestion:"AIM Guardrail",mode:"pre_call",defaultOn:!1},prompt_security:{provider:"PromptSecurity",guardrailNameSuggestion:"Prompt Security",mode:"pre_call",defaultOn:!1},lasso:{provider:"Lasso",guardrailNameSuggestion:"Lasso Guardrail",mode:"pre_call",defaultOn:!1},pangea:{provider:"Pangea",guardrailNameSuggestion:"Pangea Guardrail",mode:"pre_call",defaultOn:!1},enkryptai:{provider:"Enkryptai",guardrailNameSuggestion:"EnkryptAI",mode:"pre_call",defaultOn:!1},javelin:{provider:"Javelin",guardrailNameSuggestion:"Javelin Guardrails",mode:"pre_call",defaultOn:!1},pillar:{provider:"Pillar",guardrailNameSuggestion:"Pillar Guardrail",mode:"pre_call",defaultOn:!1}},aa=({card:e,onBack:t,accessToken:a,onGuardrailCreated:l})=>{let[r,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)("overview"),c=[{property:"Provider",value:"litellm"===e.category?"Silinex Content Filter":"Partner Guardrail"},...e.subcategory?[{property:"Subcategory",value:e.subcategory}]:[],..."litellm"===e.category?[{property:"Cost",value:"\xa50 / 请求"}]:[],..."litellm"===e.category?[{property:"External Dependencies",value:"None"}]:[],..."litellm"===e.category?[{property:"Latency",value:e.eval?.latency||"<1ms"}]:[]],m=e.eval?[{metric:"Precision",value:`${e.eval.precision}%`},{metric:"Recall",value:`${e.eval.recall}%`},{metric:"F1 Score",value:`${e.eval.f1}%`},{metric:"Test Cases",value:String(e.eval.testCases)},{metric:"False Positives",value:"0"},{metric:"False Negatives",value:"0"},{metric:"Latency (p50)",value:e.eval.latency}]:[],p=[{key:"overview",label:"Overview"},...e.eval?[{key:"eval",label:"Eval Results"}]:[]];return(0,i.jsxs)("div",{style:{maxWidth:960,margin:"0 auto"},children:[(0,i.jsxs)("div",{onClick:t,style:{display:"inline-flex",alignItems:"center",gap:6,color:"#5f6368",cursor:"pointer",fontSize:14,marginBottom:24},children:[(0,i.jsx)(ae.A,{style:{fontSize:11}}),(0,i.jsx)("span",{children:e.name})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:8},children:[(0,i.jsx)("img",{src:e.logo,alt:"",style:{width:40,height:40,borderRadius:8,objectFit:"contain"},onError:e=>{e.target.style.display="none"}}),(0,i.jsx)("h1",{style:{fontSize:28,fontWeight:400,color:"#202124",margin:0,lineHeight:1.2},children:e.name})]}),(0,i.jsx)("p",{style:{fontSize:14,color:"#5f6368",margin:"0 0 20px 0",lineHeight:1.6},children:e.description}),(0,i.jsx)("div",{style:{display:"flex",gap:10,marginBottom:32},children:(0,i.jsx)(f.Ay,{onClick:()=>n(!0),style:{borderRadius:20,padding:"4px 20px",height:36,borderColor:"#dadce0",color:"#1a73e8",fontWeight:500,fontSize:14},children:"Create Guardrail"})}),(0,i.jsx)("div",{style:{borderBottom:"1px solid #dadce0",marginBottom:28},children:(0,i.jsx)("div",{style:{display:"flex",gap:0},children:p.map(e=>(0,i.jsx)("div",{onClick:()=>d(e.key),style:{padding:"12px 20px",fontSize:14,color:o===e.key?"#1a73e8":"#5f6368",borderBottom:o===e.key?"3px solid #1a73e8":"3px solid transparent",cursor:"pointer",fontWeight:o===e.key?500:400,marginBottom:-1},children:e.label},e.key))})}),"overview"===o&&(0,i.jsxs)("div",{style:{display:"flex",gap:64},children:[(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsx)("h2",{style:{fontSize:18,fontWeight:400,color:"#202124",margin:"0 0 12px 0"},children:"Overview"}),(0,i.jsx)("p",{style:{fontSize:14,color:"#3c4043",lineHeight:1.7,margin:"0 0 32px 0"},children:e.description}),(0,i.jsx)("h2",{style:{fontSize:18,fontWeight:400,color:"#202124",margin:"0 0 4px 0"},children:"Guardrail Details"}),(0,i.jsx)("p",{style:{fontSize:13,color:"#5f6368",margin:"0 0 16px 0"},children:"Details are as follows"}),(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #dadce0"},children:[(0,i.jsx)("th",{style:{textAlign:"left",padding:"12px 0",color:"#5f6368",fontWeight:500,width:200},children:"Property"}),(0,i.jsx)("th",{style:{textAlign:"left",padding:"12px 0",color:"#5f6368",fontWeight:500},children:e.name})]})}),(0,i.jsx)("tbody",{children:c.map((e,t)=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #f1f3f4"},children:[(0,i.jsx)("td",{style:{padding:"12px 0",color:"#3c4043"},children:e.property}),(0,i.jsx)("td",{style:{padding:"12px 0",color:"#202124"},children:e.value})]},t))})]})]}),(0,i.jsxs)("div",{style:{width:240,flexShrink:0},children:[(0,i.jsxs)("div",{style:{marginBottom:28},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"#5f6368",marginBottom:4},children:"Guardrail ID"}),(0,i.jsxs)("div",{style:{fontSize:13,color:"#202124",wordBreak:"break-all"},children:["litellm/",e.id]})]}),(0,i.jsxs)("div",{style:{marginBottom:28},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"#5f6368",marginBottom:4},children:"Type"}),(0,i.jsx)("div",{style:{fontSize:13,color:"#202124"},children:"litellm"===e.category?"Content Filter":"Partner"})]}),e.tags.length>0&&(0,i.jsxs)("div",{style:{marginBottom:28},children:[(0,i.jsx)("div",{style:{fontSize:12,color:"#5f6368",marginBottom:8},children:"Tags"}),(0,i.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:e.tags.map(e=>(0,i.jsx)("span",{style:{fontSize:12,padding:"4px 12px",borderRadius:16,border:"1px solid #dadce0",color:"#3c4043",backgroundColor:"#fff"},children:e},e))})]})]})]}),"eval"===o&&(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{style:{fontSize:18,fontWeight:400,color:"#202124",margin:"0 0 16px 0"},children:"Eval Results"}),(0,i.jsxs)("table",{style:{width:"100%",maxWidth:560,borderCollapse:"collapse",fontSize:14},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{backgroundColor:"#f8f9fa",borderBottom:"1px solid #dadce0"},children:[(0,i.jsx)("th",{style:{textAlign:"left",padding:"12px 16px",color:"#5f6368",fontWeight:500},children:"Metric"}),(0,i.jsx)("th",{style:{textAlign:"left",padding:"12px 16px",color:"#5f6368",fontWeight:500},children:"Value"})]})}),(0,i.jsx)("tbody",{children:m.map((e,t)=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #f1f3f4"},children:[(0,i.jsx)("td",{style:{padding:"12px 16px",color:"#3c4043"},children:e.metric}),(0,i.jsx)("td",{style:{padding:"12px 16px",color:"#202124",fontWeight:500},children:e.value})]},t))})]})]}),(0,i.jsx)(eW,{visible:r,onClose:()=>n(!1),accessToken:a,onSuccess:()=>{n(!1),l()},preset:at[e.id]})]})},al=({accessToken:e,onGuardrailCreated:t})=>{let[a,l]=(0,s.useState)(""),[r,n]=(0,s.useState)(null),[o,d]=(0,s.useState)(!1),c=t5.filter(e=>{if(!a)return!0;let t=a.toLowerCase();return e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t))}),m=c.filter(e=>"litellm"===e.category),p=c.filter(e=>"partner"===e.category);return r?(0,i.jsx)(aa,{card:r,onBack:()=>n(null),accessToken:e,onGuardrailCreated:t}):(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{marginBottom:24},children:(0,i.jsx)(h.A,{size:"large",placeholder:"Search guardrails",prefix:(0,i.jsx)(tJ.A,{style:{color:"#9ca3af"}}),value:a,onChange:e=>l(e.target.value),style:{borderRadius:8}})}),(0,i.jsxs)("div",{style:{marginBottom:40},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[(0,i.jsx)("h2",{style:{fontSize:20,fontWeight:600,color:"#111827",margin:0},children:"Silinex Content Filter"}),(0,i.jsx)("span",{style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:14,color:"#1a73e8",cursor:"pointer"},onClick:()=>d(!o),children:o?(0,i.jsx)(i.Fragment,{children:"Show less"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t6.A,{style:{fontSize:12}}),`Show all (${m.length})`]})})]}),(0,i.jsx)("p",{style:{fontSize:13,color:"#6b7280",margin:"4px 0 20px 0"},children:"Built-in guardrails powered by Silinex. Zero latency, no external dependencies, no additional cost."}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:16},children:(o?m:m.slice(0,10)).map(e=>(0,i.jsx)(t7,{card:e,onClick:()=>n(e)},e.id))})]}),(0,i.jsxs)("div",{style:{marginBottom:40},children:[(0,i.jsx)("h2",{style:{fontSize:20,fontWeight:600,color:"#111827",margin:"0 0 4px 0"},children:"Partner Guardrails"}),(0,i.jsx)("p",{style:{fontSize:13,color:"#6b7280",margin:"4px 0 20px 0"},children:"Third-party guardrail integrations from leading AI security providers."}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:16},children:p.map(e=>(0,i.jsx)(t7,{card:e,onClick:()=>n(e)},e.id))})]})]})},ar=({accessToken:e,userRole:t})=>{let{t:a,locale:l}=(0,ts.o)(),r=(e,t)=>{let r=a(e);return r===e&&"zh-CN"===l?t:r},[u,g]=(0,s.useState)([]),[x,h]=(0,s.useState)(!1),[y,f]=(0,s.useState)(!1),[j,v]=(0,s.useState)(!1),[b,A]=(0,s.useState)(!1),[C,N]=(0,s.useState)(null),[w,S]=(0,s.useState)(!1),[k,P]=(0,s.useState)(null),[I,O]=(0,s.useState)(0),L=!!t&&(0,ti.OY)(t),B=async()=>{if(e){v(!0);try{let t=await (0,p.getGuardrailsList)(e);console.log(`guardrails: ${JSON.stringify(t)}`),g(t.guardrails)}catch(e){console.error("Error fetching guardrails:",e)}finally{v(!1)}}};(0,s.useEffect)(()=>{B()},[e]);let T=()=>{B()},E=async()=>{if(C&&e){A(!0);try{await (0,p.deleteGuardrailCall)(e,C.guardrail_id),_.Ay.success(r("guardrailsPage.notifications.deleteSuccess",'护栏 "{name}" 删除成功').replace("{name}",C.guardrail_name||"")),await B()}catch(e){console.error("Error deleting guardrail:",e),_.Ay.fromBackend(r("guardrailsPage.notifications.deleteFailed","删除护栏失败"))}finally{A(!1),S(!1),N(null)}}},z=C&&C.litellm_params?eg(C.litellm_params.guardrail).displayName:void 0;return(0,i.jsx)("div",{className:"w-full mx-auto flex-auto overflow-y-auto m-8 p-2",children:(0,i.jsxs)(n.fu,{index:I,onIndexChange:O,children:[(0,i.jsxs)(n.wb,{className:"mb-4",children:[(0,i.jsx)(n.oz,{children:r("guardrailsPage.tabs.garden","护栏广场")}),(0,i.jsx)(n.oz,{children:r("guardrailsPage.tabs.guardrails","护栏")}),(0,i.jsx)(n.oz,{disabled:!e||0===u.length,children:r("guardrailsPage.tabs.testPlayground","测试操场")})]}),(0,i.jsxs)(n.T2,{children:[(0,i.jsx)(n.Kp,{children:(0,i.jsx)(al,{accessToken:e,onGuardrailCreated:T})}),(0,i.jsxs)(n.Kp,{children:[(0,i.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,i.jsx)(o.A,{menu:{items:[{key:"provider",icon:(0,i.jsx)(d.A,{}),label:r("guardrailsPage.actions.addProviderGuardrail","添加提供商护栏"),onClick:()=>{k&&P(null),h(!0)}},{key:"custom_code",icon:(0,i.jsx)(c.A,{}),label:r("guardrailsPage.actions.createCustomCodeGuardrail","创建自定义代码护栏"),onClick:()=>{k&&P(null),f(!0)}}]},trigger:["click"],disabled:!e,children:(0,i.jsxs)(n.$n,{disabled:!e,children:[r("guardrailsPage.actions.addNewGuardrail","+ 添加新护栏")," ",(0,i.jsx)(m.A,{className:"ml-2"})]})})}),k?(0,i.jsx)(tG,{guardrailId:k,onClose:()=>P(null),accessToken:e,isAdmin:L}):(0,i.jsx)(tr,{guardrailsList:u,isLoading:j,onDeleteClick:(e,t)=>{N(u.find(t=>t.guardrail_id===e)||null),S(!0)},accessToken:e,onGuardrailUpdated:B,isAdmin:L,onGuardrailClick:e=>P(e)}),(0,i.jsx)(eW,{visible:x,onClose:()=>{h(!1)},accessToken:e,onSuccess:T}),(0,i.jsx)(tR,{visible:y,onClose:()=>{f(!1)},accessToken:e,onSuccess:T}),(0,i.jsx)(t4.A,{isOpen:w,title:r("guardrailsPage.deleteModal.title","删除护栏"),message:r("guardrailsPage.deleteModal.message","确认删除护栏：{name}？此操作不可撤销。").replace("{name}",C?.guardrail_name||""),resourceInformationTitle:r("guardrailsPage.deleteModal.resourceInformationTitle","护栏信息"),resourceInformation:[{label:r("guardrailsPage.deleteModal.fields.name","名称"),value:C?.guardrail_name},{label:r("guardrailsPage.deleteModal.fields.id","ID"),value:C?.guardrail_id,code:!0},{label:r("guardrailsPage.deleteModal.fields.provider","提供商"),value:z},{label:r("guardrailsPage.deleteModal.fields.mode","模式"),value:C?.litellm_params.mode},{label:r("guardrailsPage.deleteModal.fields.defaultOn","默认启用"),value:C?.litellm_params.default_on?r("guardrailsPage.deleteModal.fields.yes","是"):r("guardrailsPage.deleteModal.fields.no","否")}],onCancel:()=>{S(!1),N(null)},onOk:E,confirmLoading:b})]}),(0,i.jsx)(n.Kp,{children:(0,i.jsx)(t2,{guardrailsList:u,isLoading:j,accessToken:e,onClose:()=>O(0)})})]})]})})}}}]);