"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8456],{6376:(e,l,t)=>{t.r(l),t.d(l,{default:()=>z});var s=t(95155),a=t(12115),r=t(73321),n=t(26430),i=t(35625),o=t(19253),d=t(28436),c=t(26708),u=t(48934),m=t(64394);let g=(0,t(90078).D)("onboarding");var h=t(95049),x=t(34568);function y(){return(0,s.jsx)("div",{className:"mx-auto w-full max-w-md mt-10 flex justify-center",children:(0,s.jsx)(h.A,{indicator:(0,s.jsx)(x.A,{spin:!0}),size:"large"})})}var f=t(99876),p=t(87278);function w(){return(0,s.jsxs)("div",{className:"mx-auto w-full max-w-md mt-10",children:[(0,s.jsx)(f.A,{type:"error",message:"Failed to load invitation",description:"The invitation link may be invalid or expired.",showIcon:!0}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(p.Ay,{href:"/ui/login",children:"Back to Login"})})]})}var j=t(25387),S=t(69779),b=t(41326),_=t(91808);function v({variant:e,userEmail:l,isPending:t,claimError:r,onSubmit:n}){let[i]=j.A.useForm();return a.useEffect(()=>{l&&i.setFieldValue("user_email",l)},[l,i]),(0,s.jsx)("div",{className:"mx-auto w-full max-w-md mt-10",children:(0,s.jsxs)(S.A,{children:[(0,s.jsx)(b.A.Title,{level:5,className:"text-center mb-5",children:"\uD83D\uDE85 Silinex"}),(0,s.jsx)(b.A.Title,{level:3,children:"reset_password"===e?"Reset Password":"Sign Up"}),(0,s.jsx)(b.A.Text,{children:"reset_password"===e?"Reset your password to access Admin UI.":"Claim your user account to login to Admin UI."}),"signup"===e&&(0,s.jsx)(f.A,{className:"mt-4",type:"info",message:"SSO",description:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{children:"SSO is under the Enterprise Tier."}),(0,s.jsx)(p.Ay,{type:"primary",size:"small",href:"https://forms.gle/W3U4PZpJGFHWtHyA9",target:"_blank",children:"Get Free Trial"})]}),showIcon:!0}),(0,s.jsxs)(j.A,{className:"mt-10 mb-5",layout:"vertical",form:i,onFinish:e=>n({password:e.password}),children:[(0,s.jsx)(j.A.Item,{label:"Email Address",name:"user_email",children:(0,s.jsx)(_.A,{type:"email",disabled:!0})}),(0,s.jsx)(j.A.Item,{label:"Password",name:"password",rules:[{required:!0,message:"password required to sign up"}],help:"reset_password"===e?"Enter your new password":"Create a password for your account",children:(0,s.jsx)(_.A.Password,{})}),r&&(0,s.jsx)(f.A,{type:"error",message:r,showIcon:!0,className:"mb-4"}),(0,s.jsx)("div",{className:"mt-10",children:(0,s.jsx)(p.Ay,{htmlType:"submit",loading:t,children:"reset_password"===e?"Reset Password":"Sign Up"})})]})]})})}function A({variant:e}){let l=(0,r.useSearchParams)().get("invitation_id"),[t,n]=a.useState(null),{data:i,isLoading:h,isError:x}=(e=>{let{isLoading:l}=(0,m._)();return(0,c.I)({queryKey:g.detail(e??""),queryFn:async()=>{if(!e)throw Error("inviteId is required");return(0,d.getOnboardingCredentials)(e)},enabled:!!e&&!l})})(l),{mutate:f,isPending:p}=(0,u.n)({mutationFn:async({accessToken:e,inviteId:l,userId:t,password:s})=>await (0,d.claimOnboardingToken)(e,l,t,s)}),j=i?.token?(0,o.s)(i.token):null,S=j?.user_email??"",b=j?.user_id??null,_=j?.key??null,A=i?.token??null;return h?(0,s.jsx)(y,{}):x?(0,s.jsx)(w,{}):(0,s.jsx)(v,{variant:e,userEmail:S,isPending:p,claimError:t,onSubmit:e=>{_&&A&&b&&l&&(n(null),f({accessToken:_,inviteId:l,userId:b,password:e.password},{onSuccess:()=>{document.cookie=`token=${A}; path=/; SameSite=Lax`;let e=(0,d.getProxyBaseUrl)();window.location.href=e?`${e}/ui/?login=success`:"/ui/?login=success"},onError:e=>{n(e.message||"Failed to submit. Please try again.")}}))}})}let k=new n.E;function N(){let e=(0,r.useSearchParams)().get("action");return(0,s.jsx)(A,{variant:"reset_password"===e?"reset_password":"signup"})}function z(){return(0,s.jsx)(i.Ht,{client:k,children:(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}),children:(0,s.jsx)(N,{})})})}},38456:(e,l,t)=>{t.d(l,{A:()=>T});var s=t(95155),a=t(12352),r=t(81981),n=t(41326),i=t(19253),o=t(73321),d=t(12115),c=t(6376),u=t(26562),m=t(28436),g=t(98931),h=t(14290),x=t(11698),y=t(88534),f=t(17293),p=t(30947),w=t(14992),j=t(73946),S=t(37621),b=t(3134),_=t(48591),v=t(94300),A=t(22277),k=t(23022),N=t(8536),z=t(64601),I=t(26708),D=t(63076),E=t(29822),C=t.n(E),O=t(58737),$=t(42696),K=t(92574),P=t(98086);function L({teams:e,organizations:l,onSortChange:t,currentSort:a}){let[r,n]=(0,d.useState)(null),[i,o]=d.useState(()=>a?[{id:a.sortBy,desc:"desc"===a.sortOrder}]:[{id:"created_at",desc:!0}]),[c,u]=d.useState({pageIndex:0,pageSize:50}),g=i.length>0?i[0].id:null,E=i.length>0?i[0].desc?"desc":"asc":null,{data:L,isPending:T,isFetching:R,refetch:V}=(0,x._Q)(c.pageIndex+1,c.pageSize,{sortBy:g||void 0,sortOrder:E||void 0}),U=L?.total_count||0,[M,F]=(0,d.useState)({}),{filters:H,filteredKeys:B,allKeyAliases:J,allTeams:W,allOrganizations:q,handleFilterChange:Y,handleFilterReset:G}=function({keys:e,teams:l,organizations:t}){let s={"Team ID":"","Organization ID":"","Key Alias":"","User ID":"","Sort By":"created_at","Sort Order":"desc"},{accessToken:a}=(0,$.A)(),[r,n]=(0,d.useState)(s),[i,o]=(0,d.useState)(l||[]),[c,u]=(0,d.useState)(t||[]),[g,h]=(0,d.useState)(e),x=(0,d.useRef)(0),y=(0,d.useCallback)(C()(async e=>{if(!a)return;let l=Date.now();x.current=l;try{let t=await (0,m.keyListCall)(a,e["Organization ID"]||null,e["Team ID"]||null,e["Key Alias"]||null,e["User ID"]||null,e["Key Hash"]||null,1,O.e,e["Sort By"]||null,e["Sort Order"]||null);l===x.current&&t&&(h(t.keys),console.log("called from debouncedSearch filters:",JSON.stringify(e)),console.log("called from debouncedSearch data:",JSON.stringify(t)))}catch(e){console.error("Error searching users:",e)}},300),[a]);(0,d.useEffect)(()=>{if(!e)return void h([]);let l=[...e];r["Team ID"]&&(l=l.filter(e=>e.team_id===r["Team ID"])),r["Organization ID"]&&(l=l.filter(e=>e.organization_id===r["Organization ID"])),h(l)},[e,r]),(0,d.useEffect)(()=>{let e=async()=>{let e=await (0,D.kR)(a);e.length>0&&o(e);let l=await (0,D.Mw)(a);l.length>0&&u(l)};a&&e()},[a]);let f=(0,I.I)({queryKey:["allKeys"],queryFn:async()=>{if(!a)throw Error("Access token required");return await (0,D.TK)(a)},enabled:!!a}).data||[];return(0,d.useEffect)(()=>{l&&l.length>0&&o(e=>e.length<l.length?l:e)},[l]),(0,d.useEffect)(()=>{t&&t.length>0&&u(e=>e.length<t.length?t:e)},[t]),{filters:r,filteredKeys:g,allKeyAliases:f,allTeams:i,allOrganizations:c,handleFilterChange:(e,l=!1)=>{n({"Team ID":e["Team ID"]||"","Organization ID":e["Organization ID"]||"","Key Alias":e["Key Alias"]||"","User ID":e["User ID"]||"","Sort By":e["Sort By"]||"created_at","Sort Order":e["Sort Order"]||"desc"}),l||y({...r,...e})},handleFilterReset:()=>{n(s),y(s)}}}({keys:L?.keys||[],teams:e,organizations:l});(0,d.useEffect)(()=>{if(V){let e=()=>{V()};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}},[V]);let{t:X}=(0,h.o)(),Q=e=>"all-team-models"===e?X("keyDetail.settings.messages.allTeamModels"):"all-proxy-models"===e?X("teams.allProxyModels"):(0,z.$L)(e),Z=(0,d.useMemo)(()=>[{id:"expander",header:()=>null,size:40,enableSorting:!1,cell:({row:e})=>e.getCanExpand()?(0,s.jsx)("button",{onClick:e.getToggleExpandedHandler(),style:{cursor:"pointer"},children:e.getIsExpanded()?"▼":"▶"}):null},{id:"token",accessorKey:"token",header:"密钥 ID",size:100,enableSorting:!0,cell:e=>{let l=e.getValue(),t=e.cell.column.getSize();return(0,s.jsx)(A.A,{title:l,children:(0,s.jsx)(_.$n,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate block",style:{maxWidth:t,overflow:"hidden"},onClick:()=>n(e.row.original),children:l??"-"})})}},{id:"key_alias",accessorKey:"key_alias",header:"密钥别名",size:150,enableSorting:!0,cell:e=>{let l=e.getValue(),t=e.cell.column.getSize();return(0,s.jsx)(A.A,{title:l,children:(0,s.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:t,overflow:"hidden"},children:l??"-"})})}},{id:"key_name",accessorKey:"key_name",header:"密钥",size:120,enableSorting:!1,cell:e=>(0,s.jsx)("span",{className:"font-mono text-xs",children:e.getValue()})},{id:"team_alias",accessorKey:"team_id",header:"分组别名",size:120,enableSorting:!1,cell:({row:l,getValue:t})=>{let s=t(),a=e?.find(e=>e.team_id===s);return a?.team_alias||"Unknown"}},{id:"team_id",accessorKey:"team_id",header:"分组 ID",size:80,enableSorting:!1,cell:e=>{let l=e.getValue(),t=e.cell.column.getSize();return(0,s.jsx)(A.A,{title:l,children:(0,s.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:t,overflow:"hidden"},children:l??"-"})})}},{id:"organization_id",accessorKey:"organization_id",header:"组织 ID",size:140,enableSorting:!1,cell:e=>e.getValue()?e.renderValue():"-"},{id:"user_email",accessorKey:"user",header:"用户邮箱",size:160,enableSorting:!1,cell:e=>{let l=e.getValue(),t=l?.user_email,a=e.cell.column.getSize();return(0,s.jsx)(A.A,{title:t,children:(0,s.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:a,overflow:"hidden"},children:t??"-"})})}},{id:"user_id",accessorKey:"user_id",header:"用户 ID",size:70,enableSorting:!1,cell:e=>{let l=e.getValue(),t="default_user_id"===l?X("memberTable.defaultProxyAdmin"):l,a=e.cell.column.getSize();return(0,s.jsx)(A.A,{title:t,children:(0,s.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:a,overflow:"hidden"},children:t??"-"})})}},{id:"created_at",accessorKey:"created_at",header:"创建时间",size:120,enableSorting:!0,cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleDateString():"-"}},{id:"created_by",accessorKey:"created_by",header:"创建者",size:70,enableSorting:!1,cell:e=>{let l=e.getValue(),t="default_user_id"===l?X("memberTable.defaultProxyAdmin"):l,a=e.cell.column.getSize();return(0,s.jsx)(A.A,{title:t,children:(0,s.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:a,overflow:"hidden"},children:t??"-"})})}},{id:"updated_at",accessorKey:"updated_at",header:"更新时间",size:120,enableSorting:!0,cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleDateString():"Never"}},{id:"last_active",accessorKey:"last_active",header:()=>(0,s.jsxs)("span",{className:"flex items-center gap-1",children:["最后活跃",(0,s.jsx)(k.A,{content:"这是一个新字段，不会回填历史数据。只有新的密钥使用记录会更新此值。",trigger:"hover",children:(0,s.jsx)(v.A,{className:"text-gray-400 text-xs cursor-help"})})]}),size:130,enableSorting:!1,cell:e=>{let l=e.getValue();if(!l)return"未知";let t=new Date(l);return(0,s.jsx)(A.A,{title:t.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"long"}),children:(0,s.jsx)("span",{children:t.toLocaleDateString()})})}},{id:"expires",accessorKey:"expires",header:"过期时间",size:120,enableSorting:!1,cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleDateString():"永不过期"}},{id:"spend",accessorKey:"spend",header:"消费",size:100,enableSorting:!0,cell:e=>(0,y.HY)(e.getValue(),4)},{id:"max_budget",accessorKey:"max_budget",header:"预算",size:110,enableSorting:!0,cell:e=>{let l=e.getValue();return null===l?"无限制":`\xa5${(0,y.HY)(l)}`}},{id:"budget_reset_at",accessorKey:"budget_reset_at",header:"预算重置时间",size:130,enableSorting:!1,cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleString():"永不重置"}},{id:"models",accessorKey:"models",header:"模型",size:200,enableSorting:!1,cell:e=>{let l=e.getValue();return(0,s.jsx)("div",{className:"flex flex-col py-2",children:Array.isArray(l)?(0,s.jsx)("div",{className:"flex flex-col",children:0===l.length?(0,s.jsx)(_.Ex,{size:"xs",className:"mb-1",color:"red",children:(0,s.jsx)(_.EY,{children:"所有代理模型"})}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex items-start",children:[l.length>3&&(0,s.jsx)("div",{children:(0,s.jsx)(_.In,{icon:M[e.row.id]?f.A:p.A,className:"cursor-pointer",size:"xs",onClick:()=>{F(l=>({...l,[e.row.id]:!l[e.row.id]}))}})}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[l.slice(0,3).map((e,l)=>"all-proxy-models"===e||"all-team-models"===e?(0,s.jsx)(_.Ex,{size:"xs",color:"red",children:(0,s.jsx)(_.EY,{children:Q(e)})},l):(0,s.jsx)(_.Ex,{size:"xs",color:"blue",children:(0,s.jsx)(_.EY,{children:e.length>30?`${Q(e).slice(0,30)}...`:Q(e)})},l)),l.length>3&&!M[e.row.id]&&(0,s.jsx)(_.Ex,{size:"xs",color:"gray",className:"cursor-pointer",children:(0,s.jsxs)(_.EY,{children:["+",l.length-3," ",(l.length,"个模型")]})}),M[e.row.id]&&(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:l.slice(3).map((e,l)=>"all-proxy-models"===e||"all-team-models"===e?(0,s.jsx)(_.Ex,{size:"xs",color:"red",children:(0,s.jsx)(_.EY,{children:Q(e)})},l+3):(0,s.jsx)(_.Ex,{size:"xs",color:"blue",children:(0,s.jsx)(_.EY,{children:e.length>30?`${Q(e).slice(0,30)}...`:Q(e)})},l+3))})]})]})})}):null})}},{id:"rate_limits",header:"速率限制",size:140,enableSorting:!1,cell:({row:e})=>{let l=e.original;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{children:["TPM: ",null!==l.tpm_limit?l.tpm_limit:"无限制"]}),(0,s.jsxs)("div",{children:["RPM: ",null!==l.rpm_limit?l.rpm_limit:"无限制"]})]})}}],[X]),ee=[{name:"Team ID",label:"分组 ID",isSearchable:!0,searchFn:async e=>W&&0!==W.length?W.filter(l=>l.team_id.toLowerCase().includes(e.toLowerCase())||l.team_alias&&l.team_alias.toLowerCase().includes(e.toLowerCase())).map(e=>({label:`${e.team_alias||e.team_id} (${e.team_id})`,value:e.team_id})):[]},{name:"Organization ID",label:"组织 ID",isSearchable:!0,searchFn:async e=>q&&0!==q.length?q.filter(l=>l.organization_id?.toLowerCase().includes(e.toLowerCase())??!1).filter(e=>null!==e.organization_id&&void 0!==e.organization_id).map(e=>({label:`${e.organization_id||"Unknown"} (${e.organization_id})`,value:e.organization_id})):[]},{name:"Key Alias",label:"密钥别名",isSearchable:!0,searchFn:async e=>J.filter(l=>l.toLowerCase().includes(e.toLowerCase())).map(e=>({label:e,value:e}))},{name:"User ID",label:"用户 ID",isSearchable:!1},{name:"Key Hash",label:"密钥哈希",isSearchable:!1}];console.log(`keys: ${JSON.stringify(L)}`);let el=(0,S.N4)({data:B,columns:Z.filter(e=>"expander"!==e.id),columnResizeMode:"onChange",columnResizeDirection:"ltr",state:{sorting:i,pagination:c},onSortingChange:e=>{let l="function"==typeof e?e(i):e;if(console.log(`newSorting: ${JSON.stringify(l)}`),o(l),l&&l.length>0){let e=l[0],s=e.id,a=e.desc?"desc":"asc";console.log(`sortBy: ${s}, sortOrder: ${a}`),Y({...H,"Sort By":s,"Sort Order":a},!0),t?.(s,a)}},onPaginationChange:u,getCoreRowModel:(0,b.HT)(),getSortedRowModel:(0,b.h5)(),getPaginationRowModel:(0,b.kW)(),enableSorting:!0,manualSorting:!1,manualPagination:!0,pageCount:Math.ceil(U/c.pageSize)});d.useEffect(()=>{a&&o([{id:a.sortBy,desc:"desc"===a.sortOrder}])},[a]);let{pageIndex:et,pageSize:es}=el.getState().pagination,ea=Math.min((et+1)*es,U),er=`${et*es+1} - ${ea}`;return(0,s.jsx)("div",{className:"w-full h-full overflow-hidden",children:r?(0,s.jsx)(P.A,{keyId:r.token,onClose:()=>n(null),keyData:r,teams:W,onDelete:V}):(0,s.jsxs)("div",{className:"border-b py-4 flex-1 overflow-hidden",children:[(0,s.jsx)("div",{className:"w-full mb-6",children:(0,s.jsx)(K.A,{options:ee,onApplyFilters:Y,initialValues:H,onResetFilters:G})}),(0,s.jsxs)("div",{className:"flex items-center justify-between w-full mb-4",children:[T||R?(0,s.jsx)(N.A.Node,{active:!0,style:{width:200,height:20}}):(0,s.jsxs)("span",{className:"inline-flex text-sm text-gray-700",children:["显示 ",er,"，共 ",U," 条结果"]}),(0,s.jsxs)("div",{className:"inline-flex items-center gap-2",children:[T||R?(0,s.jsx)(N.A.Node,{active:!0,style:{width:74,height:20}}):(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["第 ",et+1," 页，共 ",el.getPageCount()," 页"]}),T||R?(0,s.jsx)(N.A.Button,{active:!0,size:"small",style:{width:84,height:30}}):(0,s.jsx)("button",{onClick:()=>el.previousPage(),disabled:T||R||!el.getCanPreviousPage(),className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"上一页"}),T||R?(0,s.jsx)(N.A.Button,{active:!0,size:"small",style:{width:58,height:30}}):(0,s.jsx)("button",{onClick:()=>el.nextPage(),disabled:T||R||!el.getCanNextPage(),className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"下一页"})]})]}),(0,s.jsx)("div",{className:"h-[75vh] overflow-auto",children:(0,s.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(_.XI,{className:"[&_td]:py-0.5 [&_th]:py-1",style:{width:el.getCenterTotalSize()},children:[(0,s.jsx)(_.nd,{children:el.getHeaderGroups().map(e=>(0,s.jsx)(_.Hj,{children:e.headers.map(e=>(0,s.jsx)(_.M_,{"data-header-id":e.id,className:`py-1 h-8 relative hover:bg-gray-50 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,style:{width:e.getSize(),position:"relative",cursor:e.column.getCanSort()?"pointer":"default"},onMouseEnter:()=>{let l=document.querySelector(`[data-header-id="${e.id}"] .resizer`);l&&(l.style.opacity="0.5")},onMouseLeave:()=>{let l=document.querySelector(`[data-header-id="${e.id}"] .resizer`);l&&!e.column.getIsResizing()&&(l.style.opacity="0")},onClick:e.column.getCanSort()?e.column.getToggleSortingHandler():void 0,children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,S.Kv)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&e.column.getCanSort()&&(0,s.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,s.jsx)(w.A,{className:"h-4 w-4 text-blue-500"}),desc:(0,s.jsx)(f.A,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,s.jsx)(j.A,{className:"h-4 w-4 text-gray-400"})}),(0,s.jsx)("div",{onDoubleClick:()=>e.column.resetSize(),onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler(),className:`resizer ${el.options.columnResizeDirection} ${e.column.getIsResizing()?"isResizing":""}`,style:{position:"absolute",right:0,top:0,height:"100%",width:"5px",background:e.column.getIsResizing()?"#3b82f6":"transparent",cursor:"col-resize",userSelect:"none",touchAction:"none",opacity:+!!e.column.getIsResizing()}})]})},e.id))},e.id))}),(0,s.jsx)(_.BF,{children:T||R?(0,s.jsx)(_.Hj,{children:(0,s.jsx)(_.nA,{colSpan:Z.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"\uD83D\uDE85 Loading keys..."})})})}):B.length>0?el.getRowModel().rows.map(e=>(0,s.jsx)(_.Hj,{className:"h-8",children:e.getVisibleCells().map(e=>(0,s.jsx)(_.nA,{style:{width:e.column.getSize(),maxWidth:"8-x",whiteSpace:"pre-wrap",overflow:"hidden"},className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"models"===e.column.id&&Array.isArray(e.getValue())&&e.getValue().length>3?"px-0":""}`,children:(0,S.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,s.jsx)(_.Hj,{children:(0,s.jsx)(_.nA,{colSpan:Z.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"No keys found"})})})})})]})})})})]})})}let T=({userID:e,userRole:l,teams:t,keys:h,setUserRole:x,userEmail:y,setUserEmail:f,setTeams:p,setKeys:w,premiumUser:j,organizations:S,addKey:b,createClicked:_})=>{let v,[A,k]=(0,d.useState)(null),[N,z]=(0,d.useState)(null),I=(0,o.useSearchParams)(),D=(console.log("COOKIES",document.cookie),(v=document.cookie.split("; ").find(e=>e.startsWith("token=")))?v.split("=")[1]:null),E=I.get("invitation_id"),[C,O]=(0,d.useState)(null),[$,K]=(0,d.useState)(null),[P,T]=(0,d.useState)([]),[R,V]=(0,d.useState)(null),[U,M]=(0,d.useState)(null);if(window.addEventListener("beforeunload",function(){sessionStorage.clear()}),(0,d.useEffect)(()=>{if(D){let e=(0,i.s)(D);if(e){if(console.log("Decoded token:",e),console.log("Decoded key:",e.key),O(e.key),e.user_role){let l=function(e){if(!e)return"Undefined Role";switch(console.log(`Received user role: ${e}`),e.toLowerCase()){case"app_owner":case"demo_app_owner":return"App Owner";case"app_admin":case"proxy_admin":return"Admin";case"proxy_admin_viewer":return"Admin Viewer";case"app_user":return"App User";case"internal_user":return"Internal User";case"internal_user_viewer":return"Internal Viewer";default:return"Unknown Role"}}(e.user_role);console.log("Decoded user_role:",l),x(l)}else console.log("User role not defined");e.user_email?f(e.user_email):console.log(`User Email is not set ${e}`)}}if(e&&C&&l&&!h&&!A){let t=sessionStorage.getItem("userModels"+e);t?T(JSON.parse(t)):(console.log(`currentOrg: ${JSON.stringify(N)}`),(async()=>{try{let t=await (0,m.getProxyUISettings)(C);V(t);let s=await (0,m.userInfoCall)(C,e,l,!1,null,null);k(s.user_info),console.log(`userSpendData: ${JSON.stringify(A)}`),s?.teams[0].keys?w(s.keys.concat(s.teams.filter(t=>"Admin"===l||t.user_id===e).flatMap(e=>e.keys))):w(s.keys),sessionStorage.setItem("userData"+e,JSON.stringify(s.keys)),sessionStorage.setItem("userSpendData"+e,JSON.stringify(s.user_info));let a=(await (0,m.modelAvailableCall)(C,e,l)).data.map(e=>e.id);console.log("available_model_names:",a),T(a),console.log("userModels:",P),sessionStorage.setItem("userModels"+e,JSON.stringify(a))}catch(e){console.error("There was an error fetching the data",e),e.message.includes("Invalid proxy server token passed")&&F()}})(),(0,u.j)(C,e,l,N,p))}},[e,D,C,h,l]),(0,d.useEffect)(()=>{C&&(async()=>{try{let e=await (0,m.keyInfoCall)(C,[C]);console.log("keyInfo: ",e)}catch(e){e.message.includes("Invalid proxy server token passed")&&F()}})()},[C]),(0,d.useEffect)(()=>{console.log(`currentOrg: ${JSON.stringify(N)}, accessToken: ${C}, userID: ${e}, userRole: ${l}`),C&&(console.log("fetching teams"),(0,u.j)(C,e,l,N,p))},[N]),(0,d.useEffect)(()=>{if(null!==h&&null!=U&&null!==U.team_id){let e=0;for(let l of(console.log(`keys: ${JSON.stringify(h)}`),h))U.hasOwnProperty("team_id")&&null!==l.team_id&&l.team_id===U.team_id&&(e+=l.spend);console.log(`sum: ${e}`),K(e)}else if(null!==h){let e=0;for(let l of h)e+=l.spend;K(e)}},[U]),null!=E)return(0,s.jsx)(c.default,{});function F(){(0,a.E)();let e=(0,m.getProxyBaseUrl)();console.log("proxyBaseUrl:",e);let l=e?`${e}/sso/key/generate`:"/sso/key/generate";return console.log("Full URL:",l),window.location.href=l,null}if(null==D)return console.log("All cookies before redirect:",document.cookie),F(),null;try{let e=(0,i.s)(D);console.log("Decoded token:",e);let l=e.exp,t=Math.floor(Date.now()/1e3);if(l&&t>=l)return console.log("Token expired, redirecting to login"),F(),null}catch(e){return console.error("Error decoding token:",e),(0,a.E)(),F(),null}if(null==C)return null;if(null==e)return(0,s.jsx)("h1",{children:"User ID is not set"});if(null==l&&x("App Owner"),l&&"Admin Viewer"==l){let{Title:e,Paragraph:l}=n.A;return(0,s.jsxs)("div",{children:[(0,s.jsx)(e,{level:1,children:"Access Denied"}),(0,s.jsx)(l,{children:"Ask your proxy admin for access to create keys"})]})}return console.log("inside user dashboard, selected team",U),console.log("All cookies after redirect:",document.cookie),(0,s.jsx)("div",{className:"w-full mx-4 h-[75vh]",children:(0,s.jsx)(r.x,{numItems:1,className:"gap-2 p-8 w-full mt-2",children:(0,s.jsxs)(r.f,{numColSpan:1,className:"flex flex-col gap-2",children:[(0,s.jsx)(g.Ay,{team:U,teams:t,data:h,addKey:b},U?U.team_id:null),(0,s.jsx)(L,{teams:t,organizations:S})]})})})}},48591:(e,l,t)=>{t.d(l,{$n:()=>a.A,BF:()=>i.A,EY:()=>m.A,Ex:()=>s.A,Hj:()=>u.A,In:()=>r.A,M_:()=>c.A,XI:()=>n.A,nA:()=>o.A,nd:()=>d.A});var s=t(34254),a=t(38983),r=t(19602),n=t(30489),i=t(96961),o=t(95517),d=t(8179),c=t(31556),u=t(95171),m=t(75892)},81981:(e,l,t)=>{t.d(l,{f:()=>s.A,x:()=>a.A});var s=t(27309),a=t(13121)}}]);