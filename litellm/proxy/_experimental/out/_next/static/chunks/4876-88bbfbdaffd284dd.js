"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4876],{26562:(e,a,s)=>{s.d(a,{j:()=>l});var t=s(28436);let l=async(e,a,s,l,r)=>{let i;i="Admin"!=s&&"Admin Viewer"!=s?await (0,t.teamListCall)(e,l?.organization_id||null,a):await (0,t.teamListCall)(e,l?.organization_id||null),console.log(`givenTeams: ${i}`),r(i)}},54876:(e,a,s)=>{s.d(a,{A:()=>e_});var t=s(95155),l=s(12115),r=s(14290),i=s(28436),n=s(26562),o=s(25387),d=s(47626),c=s(77258),m=s(41326),h=s(23060),x=s(16989),u=s(95049),p=s(32521),g=s(64601),j=s(12120),_=s(14824),f=s(17051);let b=({accessToken:e,userID:a,userRole:s})=>{let{t:n}=(0,r.o)(),[o,d]=(0,l.useState)(!0),[b,A]=(0,l.useState)(null),[v,y]=(0,l.useState)(!1),[M,w]=(0,l.useState)({}),[N,S]=(0,l.useState)(!1),[k,C]=(0,l.useState)([]),{Paragraph:z}=m.A,{Option:L}=h.A;(0,l.useEffect)(()=>{(async()=>{if(!e)return d(!1);try{let t=await (0,i.getDefaultTeamSettings)(e);if(A(t),w(t.values||{}),e)try{let t=await (0,i.modelAvailableCall)(e,a,s);if(t&&t.data){let e=t.data.map(e=>e.id);C(e)}}catch(e){console.error("Error fetching available models:",e)}}catch(e){console.error("Error fetching team SSO settings:",e),j.Ay.fromBackend((0,f.Mt)(n,"teams.defaultSettings.loadFailed"))}finally{d(!1)}})()},[e]);let P=async()=>{if(e){S(!0);try{let a=await (0,i.updateDefaultTeamSettings)(e,M);A({...b,values:a.settings}),y(!1),j.Ay.success((0,f.Mt)(n,"teams.defaultSettings.saveSuccess"))}catch(e){console.error("Error updating team settings:",e),j.Ay.fromBackend((0,f.Mt)(n,"teams.defaultSettings.updateFailed"))}finally{S(!1)}}},F=(e,a)=>{w(s=>({...s,[e]:a}))};if(o)return(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)(u.A,{size:"large"})});if(!b)return(0,t.jsx)(c.Zp,{children:(0,t.jsx)(c.EY,{children:(0,f.Mt)(n,"teams.defaultSettings.notAvailable")})});let I=b?.field_schema?.description,E=I&&I.includes("Default parameters to apply")?(0,f.Mt)(n,"teams.defaultSettings.description"):I||(0,f.Mt)(n,"teams.defaultSettings.description");return(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(c.hE,{className:"text-xl",children:(0,f.Mt)(n,"teams.defaultSettings.title")}),!o&&b&&(v?(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(c.$n,{variant:"secondary",onClick:()=>{y(!1),w(b.values||{})},disabled:N,children:(0,f.Mt)(n,"teams.defaultSettings.cancel")}),(0,t.jsx)(c.$n,{onClick:P,loading:N,children:(0,f.Mt)(n,"teams.defaultSettings.saveChanges")})]}):(0,t.jsx)(c.$n,{onClick:()=>y(!0),children:(0,f.Mt)(n,"teams.defaultSettings.editSettings")}))]}),(0,t.jsx)(c.EY,{children:E}),(0,t.jsx)(c.cG,{}),(0,t.jsx)("div",{className:"mt-4 space-y-4",children:(()=>{let{values:e,field_schema:a}=b;return a&&a.properties?Object.entries(a.properties).map(([a,s])=>{let l=e[a],r=a.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),i=(0,f.eH)(a,r);return(0,t.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200 last:border-0",children:[(0,t.jsx)(c.EY,{className:"font-medium text-lg",children:i}),(0,t.jsx)(z,{className:"text-sm text-gray-500 mt-1",children:(0,f.Qo)(a,s.description)}),v?(0,t.jsx)("div",{className:"mt-2",children:((e,a,s)=>{let l=a.type;if("budget_duration"===e)return(0,t.jsx)(p.A,{value:M[e]||null,onChange:a=>F(e,a),className:"mt-2"});if("boolean"===l)return(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(x.A,{checked:!!M[e],onChange:a=>F(e,a)})});if("array"===l&&a.items?.enum)return(0,t.jsx)(h.A,{mode:"multiple",style:{width:"100%"},value:M[e]||[],onChange:a=>F(e,a),className:"mt-2",children:a.items.enum.map(e=>(0,t.jsx)(L,{value:e,children:e},e))});if("models"===e)return(0,t.jsx)(_.o,{value:M[e]||[],onChange:a=>F(e,a),context:"global",style:{width:"100%"},options:{includeSpecialOptions:!0}});if("string"===l&&a.enum)return(0,t.jsx)(h.A,{style:{width:"100%"},value:M[e]||"",onChange:a=>F(e,a),className:"mt-2",children:a.enum.map(e=>(0,t.jsx)(L,{value:e,children:e},e))});else return(0,t.jsx)(c.ks,{value:void 0!==M[e]?String(M[e]):"",onChange:a=>F(e,a.target.value),placeholder:a.description||"",className:"mt-2"})})(a,s,0)}):(0,t.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded",children:((e,a)=>{if(null==a)return(0,t.jsx)("span",{className:"text-gray-400",children:(0,f.Mt)(n,"teams.defaultSettings.notSet")});if("budget_duration"===e)return(0,t.jsx)("span",{children:(0,p.C)(a)});if("boolean"==typeof a)return(0,t.jsx)("span",{children:a?(0,f.Mt)(n,"teams.defaultSettings.enabled"):(0,f.Mt)(n,"teams.defaultSettings.disabled")});if("models"===e&&Array.isArray(a))return 0===a.length?(0,t.jsx)("span",{className:"text-gray-400",children:(0,f.Mt)(n,"teams.defaultSettings.none")}):(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:a.map((e,a)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:(0,g.$L)(e)},a))});if("object"==typeof a)return Array.isArray(a)?0===a.length?(0,t.jsx)("span",{className:"text-gray-400",children:(0,f.Mt)(n,"teams.defaultSettings.none")}):(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:a.map((e,a)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:"object"==typeof e?JSON.stringify(e):String(e)},a))}):(0,t.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(a,null,2)});return(0,t.jsx)("span",{children:String(a)})})(a,l)})]},a)}):(0,t.jsx)(c.EY,{children:(0,f.Mt)(n,"teams.defaultSettings.noSchema")})})()})]})};var A=s(90550),v=s(38983),y=s(42837),M=s(27309),w=s(13121),N=s(73806),S=s(75892),k=s(88534),C=s(19602),z=s(2212),L=s(87927),P=s(56680),F=s(79363),I=s(73317);let E=({lastRefreshed:e,onRefresh:a,userRole:s,children:l})=>{let{t:i}=(0,r.o)();return(0,t.jsxs)(L.A,{className:"gap-2 h-[75vh] w-full",children:[(0,t.jsxs)(P.A,{className:"flex justify-between mt-2 w-full items-center",children:[(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(z.A,{children:(0,f.Mt)(i,"teams.tabs.myTeams")}),(0,A.OY)(s||"")&&(0,t.jsx)(z.A,{children:(0,f.Mt)(i,"teams.tabs.defaultSettings")})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[e&&(0,t.jsxs)(S.A,{children:[(0,f.Mt)(i,"teams.lastRefreshed"),e]}),(0,t.jsx)(C.A,{icon:I.A,variant:"shadow",size:"xs",className:"self-center",onClick:a})]})]}),(0,t.jsx)(F.A,{children:l})]})};var T=s(73626);let O=({filters:e,organizations:a,showFilters:s,onToggleFilters:l,onChange:i,onReset:n})=>{let{t:o}=(0,r.o)();return(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative w-64",children:[(0,t.jsx)("input",{type:"text",placeholder:(0,f.Mt)(o,"teams.filters.searchPlaceholder"),className:"w-full px-3 py-2 pl-8 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:e.team_alias,onChange:e=>i("team_alias",e.target.value)}),(0,t.jsx)("svg",{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),(0,t.jsxs)("button",{className:`px-3 py-2 text-sm border rounded-md hover:bg-gray-50 flex items-center gap-2 ${s?"bg-gray-100":""}`,onClick:()=>l(!s),children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),(0,f.Mt)(o,"teams.filters.filter"),(e.team_id||e.team_alias||e.organization_id)&&(0,t.jsx)("span",{"data-testid":"active-filter-indicator",className:"w-2 h-2 rounded-full bg-blue-500"})]}),(0,t.jsxs)("button",{className:"px-3 py-2 text-sm border rounded-md hover:bg-gray-50 flex items-center gap-2",onClick:n,children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,f.Mt)(o,"teams.filters.reset")]})]}),s&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[(0,t.jsxs)("div",{className:"relative w-64",children:[(0,t.jsx)("input",{type:"text",placeholder:(0,f.Mt)(o,"teams.filters.teamIdPlaceholder"),className:"w-full px-3 py-2 pl-8 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:e.team_id,onChange:e=>i("team_id",e.target.value)}),(0,t.jsx)("svg",{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),(0,t.jsx)("div",{className:"w-64",children:(0,t.jsx)(T.l,{value:e.organization_id||"",onValueChange:e=>i("organization_id",e),placeholder:(0,f.Mt)(o,"teams.filters.selectOrganization"),children:a?.map(e=>(0,t.jsx)(T.e,{value:e.organization_id||"",children:e.organization_alias||e.organization_id},e.organization_id))})})]})]})};var D=s(42696),V=s(30489),$=s(96961),H=s(95517),B=s(8179),R=s(31556),W=s(95171),J=s(22277),Y=s(55726),G=s(45588),U=s(34254),K=s(17293),q=s(30947);let Z=({team:e})=>{let{t:a}=(0,r.o)(),[s,i]=(0,l.useState)(!1);return(0,t.jsx)(H.A,{style:{maxWidth:"8-x",whiteSpace:"pre-wrap",overflow:"hidden"},className:e.models.length>3?"px-0":"",children:(0,t.jsx)("div",{className:"flex flex-col",children:Array.isArray(e.models)?(0,t.jsx)("div",{className:"flex flex-col",children:0===e.models.length?(0,t.jsx)(U.A,{size:"xs",className:"mb-1",color:"red",children:(0,t.jsx)(S.A,{children:(0,f.Mt)(a,"teams.allProxyModels")})}):(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"flex items-start",children:[e.models.length>3&&(0,t.jsx)("div",{children:(0,t.jsx)(C.A,{icon:s?K.A:q.A,className:"cursor-pointer",size:"xs",onClick:()=>{i(e=>!e)}})}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.models.slice(0,3).map((e,s)=>"all-proxy-models"===e?(0,t.jsx)(U.A,{size:"xs",color:"red",children:(0,t.jsx)(S.A,{children:(0,f.Mt)(a,"teams.allProxyModels")})},s):(0,t.jsx)(U.A,{size:"xs",color:"blue",children:(0,t.jsx)(S.A,{children:e.length>30?`${(0,g.$L)(e).slice(0,30)}...`:(0,g.$L)(e)})},s)),e.models.length>3&&!s&&(0,t.jsx)(U.A,{size:"xs",color:"gray",className:"cursor-pointer",children:(0,t.jsxs)(S.A,{children:["+",e.models.length-3," ",(0,f.Mt)(a,"teams.table.moreModels")]})}),s&&(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:e.models.slice(3).map((e,s)=>"all-proxy-models"===e?(0,t.jsx)(U.A,{size:"xs",color:"red",children:(0,t.jsx)(S.A,{children:(0,f.Mt)(a,"teams.allProxyModels")})},s+3):(0,t.jsx)(U.A,{size:"xs",color:"blue",children:(0,t.jsx)(S.A,{children:e.length>30?`${(0,g.$L)(e).slice(0,30)}...`:(0,g.$L)(e)})},s+3))})]})]})})}):null})})};var Q=s(439),X=s(42869);let ee=({team:e,userId:a})=>{let s=(e=>{let{t:a}=(0,r.o)(),s="inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-medium border";return"admin"===e?(0,t.jsxs)("span",{className:s,style:{backgroundColor:"#EEF2FF",color:"#3730A3",borderColor:"#C7D2FE"},children:[(0,t.jsx)(Q.A,{className:"h-3 w-3 mr-1"}),(0,f.Mt)(a,"teams.roleBadges.admin")]}):(0,t.jsxs)("span",{className:s,style:{backgroundColor:"#F3F4F6",color:"#4B5563",borderColor:"#E5E7EB"},children:[(0,t.jsx)(X.A,{className:"h-3 w-3 mr-1"}),(0,f.Mt)(a,"teams.roleBadges.member")]})})(((e,a)=>{if(!a)return null;let s=e.members_with_roles?.find(e=>e.user_id===a);return s?.role??null})(e,a));return(0,t.jsx)(H.A,{children:s})},ea=({teams:e,currentOrg:a,setSelectedTeamId:s,perTeamInfo:l,userRole:i,userId:n,setEditTeam:o,onDeleteTeam:d})=>{let{t:c}=(0,r.o)();return(0,t.jsxs)(V.A,{children:[(0,t.jsx)(B.A,{children:(0,t.jsxs)(W.A,{children:[(0,t.jsx)(R.A,{children:(0,f.Mt)(c,"teams.table.teamName")}),(0,t.jsx)(R.A,{children:(0,f.Mt)(c,"teams.table.teamId")}),(0,t.jsx)(R.A,{children:(0,f.Mt)(c,"teams.table.createdAt")}),(0,t.jsx)(R.A,{children:(0,f.Mt)(c,"teams.table.spend")}),(0,t.jsx)(R.A,{children:(0,f.Mt)(c,"teams.table.budget")}),(0,t.jsx)(R.A,{children:(0,f.Mt)(c,"teams.table.models")}),(0,t.jsx)(R.A,{children:(0,f.Mt)(c,"teams.table.organization")}),(0,t.jsx)(R.A,{children:"角色"}),(0,t.jsx)(R.A,{children:(0,f.Mt)(c,"teams.table.info")})]})}),(0,t.jsx)($.A,{children:e&&e.length>0?e.filter(e=>!a||e.organization_id===a.organization_id).sort((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime()).map(e=>(0,t.jsxs)(W.A,{children:[(0,t.jsx)(H.A,{style:{maxWidth:"4px",whiteSpace:"pre-wrap",overflow:"hidden"},children:e.team_alias}),(0,t.jsx)(H.A,{children:(0,t.jsx)("div",{className:"overflow-hidden",children:(0,t.jsx)(J.A,{title:e.team_id,children:(0,t.jsxs)(v.A,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>{s(e.team_id)},children:[e.team_id.slice(0,7),"..."]})})})}),(0,t.jsx)(H.A,{style:{maxWidth:"4px",whiteSpace:"pre-wrap",overflow:"hidden"},children:e.created_at?new Date(e.created_at).toLocaleDateString():(0,f.Mt)(c,"teams.table.none")}),(0,t.jsx)(H.A,{style:{maxWidth:"4px",whiteSpace:"pre-wrap",overflow:"hidden"},children:(0,k.HY)(e.spend,4)}),(0,t.jsx)(H.A,{style:{maxWidth:"4px",whiteSpace:"pre-wrap",overflow:"hidden"},children:null!==e.max_budget&&void 0!==e.max_budget?e.max_budget:(0,f.Mt)(c,"teams.table.unlimited")}),(0,t.jsx)(Z,{team:e}),(0,t.jsx)(H.A,{children:e.organization_id}),(0,t.jsx)(ee,{team:e,userId:n}),(0,t.jsxs)(H.A,{children:[(0,t.jsxs)(S.A,{children:[l&&e.team_id&&l[e.team_id]&&l[e.team_id].keys&&l[e.team_id].keys.length," ",(0,f.Mt)(c,"teams.table.keys").trim()]}),(0,t.jsxs)(S.A,{children:[l&&e.team_id&&l[e.team_id]&&l[e.team_id].team_info&&l[e.team_id].team_info.members_with_roles&&l[e.team_id].team_info.members_with_roles.length," ",(0,f.Mt)(c,"teams.table.members").trim()]})]}),(0,t.jsx)(H.A,{children:"Admin"==i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.A,{icon:Y.A,size:"sm",onClick:()=>{s(e.team_id),o(!0)}}),(0,t.jsx)(C.A,{onClick:()=>d(e.team_id),icon:G.A,size:"sm"})]}):null})]},e.team_id)):null})]})};var es=s(33210),et=s(41585);let el=({teams:e,teamToDelete:a,onCancel:s,onConfirm:i})=>{let{t:n}=(0,r.o)(),[o,d]=(0,l.useState)(""),c=e?.find(e=>e.team_id===a),m=c?.team_alias||"",h=c?.keys?.length||0,x=o===m;return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl min-h-[380px] py-6 overflow-hidden transform transition-all flex flex-col justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:n("teams.deleteModal.title")}),(0,t.jsx)("button",{"aria-label":n("teams.deleteModal.close"),onClick:()=>{s(),d("")},className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:(0,t.jsx)(es.A,{size:20})})]}),(0,t.jsxs)("div",{className:"px-6 py-4",children:[h>0&&(0,t.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-100 rounded-md mb-5",children:[(0,t.jsx)("div",{className:"text-red-500 mt-0.5",children:(0,t.jsx)(et.A,{size:20})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-base font-medium text-red-600",children:n("teams.deleteModal.warningKeys").replace("{keyCount}",String(h))}),(0,t.jsx)("p",{className:"text-base text-red-600 mt-2",children:n("teams.deleteModal.warningDeleteAll")})]})]}),(0,t.jsx)("p",{className:"text-base text-gray-600 mb-5",children:n("teams.deleteModal.confirmInfo")}),(0,t.jsxs)("div",{className:"mb-5",children:[(0,t.jsxs)("label",{className:"block text-base font-medium text-gray-700 mb-2",children:[n("teams.deleteModal.enterName"),(0,t.jsx)("span",{className:"underline",children:m}),n("teams.deleteModal.confirmLabel")]}),(0,t.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:n("teams.deleteModal.placeholder"),className:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base",autoFocus:!0})]})]})]}),(0,t.jsxs)("div",{className:"px-6 py-4 bg-gray-50 flex justify-end gap-4",children:[(0,t.jsx)("button",{onClick:()=>{s(),d("")},className:"px-5 py-3 bg-white border border-gray-300 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:n("teams.deleteModal.cancel")}),(0,t.jsx)("button",{onClick:i,disabled:!x,className:`px-5 py-3 rounded-md text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ${x?"bg-red-600 hover:bg-red-700":"bg-red-300 cursor-not-allowed"}`,children:n("teams.deleteModal.forceDelete")})]})]})})};var er=s(3373),ei=s(91808),en=s(87278),eo=s(35464),ed=s(94300),ec=s(66904),em=s(66927),eh=s(11072),ex=s(53800),eu=s(52046),ep=s(46547),eg=s(25707);let ej=({isTeamModalVisible:e,handleOk:a,handleCancel:s,currentOrg:n,organizations:d,teams:c,setTeams:m,modelAliases:u,setModelAliases:p,loggingSettings:_,setLoggingSettings:f,setIsTeamModalVisible:b})=>{let{userId:A,userRole:v,accessToken:y,premiumUser:M}=(0,D.A)(),{t:w}=(0,r.o)(),[N]=o.A.useForm(),[S,k]=(0,l.useState)([]),[C,z]=(0,l.useState)(null),[L,P]=(0,l.useState)([]),[F,I]=(0,l.useState)([]),[E,T]=(0,l.useState)([]),[O,V]=(0,l.useState)([]),[$,H]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(async()=>{try{if(null===A||null===v||null===y)return;let e=await (0,g.ME)(A,v,y);e&&k(e)}catch(e){console.error("Error fetching user models:",e)}})()},[y,A,v,c]),(0,l.useEffect)(()=>{let e;console.log(`currentOrgForCreateTeam: ${C}`);let a=(e=[],C&&C.models.length>0?(console.log(`organization.models: ${C.models}`),e=C.models):e=S,(0,g.wK)(e,S));console.log(`models: ${a}`),P(a),N.setFieldValue("models",[])},[C,S,N]);let B=async()=>{try{if(null==y)return;let e=await (0,i.fetchMCPAccessGroups)(y);V(e)}catch(e){console.error("Failed to fetch MCP access groups:",e)}};(0,l.useEffect)(()=>{B()},[y,B]),(0,l.useEffect)(()=>{let e=async()=>{try{if(null==y)return;let e=(await (0,i.getPoliciesList)(y)).policies.map(e=>e.policy_name);T(e)}catch(e){console.error("Failed to fetch policies:",e)}};(async()=>{try{if(null==y)return;let e=(await (0,i.getGuardrailsList)(y)).guardrails.map(e=>e.guardrail_name);I(e)}catch(e){console.error("Failed to fetch guardrails:",e)}})(),e()},[y]);let R=async e=>{try{if(console.log(`formValues: ${JSON.stringify(e)}`),null!=y){let a=e?.team_alias,s=c?.map(e=>e.team_alias)??[],t=e?.organization_id||n?.organization_id;if(""===t||"string"!=typeof t?e.organization_id=null:e.organization_id=t.trim(),s.includes(a))throw Error(`Team alias ${a} already exists, please pick another alias`);if(j.Ay.info(w("teams.createModal.creating")),_.length>0){let a={};if(e.metadata)try{a=JSON.parse(e.metadata)}catch(e){console.warn("Invalid JSON in metadata field, starting with empty object")}a={...a,logging:_.filter(e=>e.callback_name)},e.metadata=JSON.stringify(a)}if(e.secret_manager_settings&&"string"==typeof e.secret_manager_settings)if(""===e.secret_manager_settings.trim())delete e.secret_manager_settings;else try{e.secret_manager_settings=JSON.parse(e.secret_manager_settings)}catch(e){throw Error("Failed to parse secret manager settings: "+e)}if(e.allowed_vector_store_ids&&e.allowed_vector_store_ids.length>0||e.allowed_mcp_servers_and_groups&&(e.allowed_mcp_servers_and_groups.servers?.length>0||e.allowed_mcp_servers_and_groups.accessGroups?.length>0||e.allowed_mcp_servers_and_groups.toolPermissions)){if(e.object_permission={},e.allowed_vector_store_ids&&e.allowed_vector_store_ids.length>0&&(e.object_permission.vector_stores=e.allowed_vector_store_ids,delete e.allowed_vector_store_ids),e.allowed_mcp_servers_and_groups){let{servers:a,accessGroups:s}=e.allowed_mcp_servers_and_groups;a&&a.length>0&&(e.object_permission.mcp_servers=a),s&&s.length>0&&(e.object_permission.mcp_access_groups=s),delete e.allowed_mcp_servers_and_groups}if(e.mcp_tool_permissions&&Object.keys(e.mcp_tool_permissions).length>0&&(e.object_permission||(e.object_permission={}),e.object_permission.mcp_tool_permissions=e.mcp_tool_permissions,delete e.mcp_tool_permissions),e.allowed_agents_and_groups){let{agents:a,accessGroups:s}=e.allowed_agents_and_groups;e.object_permission||(e.object_permission={}),a&&a.length>0&&(e.object_permission.agents=a),s&&s.length>0&&(e.object_permission.agent_access_groups=s),delete e.allowed_agents_and_groups}}e.allowed_mcp_access_groups&&e.allowed_mcp_access_groups.length>0&&(e.object_permission||(e.object_permission={}),e.object_permission.mcp_access_groups=e.allowed_mcp_access_groups,delete e.allowed_mcp_access_groups),Object.keys(u).length>0&&(e.model_aliases=u);let l=await (0,i.teamCreateCall)(y,e);null!==c?m([...c,l]):m([l]),console.log(`response for team create call: ${l}`),j.Ay.success(w("teams.createModal.success")),N.resetFields(),f([]),p({}),b(!1)}}catch(e){console.error("Error creating the team:",e),j.Ay.fromBackend(w("teams.createModal.failed")+e)}};return(0,t.jsx)(er.A,{title:w("teams.createModal.title"),open:e,width:1e3,footer:null,onOk:a,onCancel:s,children:(0,t.jsxs)(o.A,{form:N,onFinish:R,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:[(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.A.Item,{label:w("teams.createModal.teamAlias"),name:"team_alias",rules:[{required:!0,message:w("teams.createModal.teamAliasRequired")}],children:(0,t.jsx)(eo.ks,{placeholder:w("teams.createModal.teamAliasPlaceholder")})}),(0,t.jsx)(o.A.Item,{label:(0,t.jsxs)("span",{children:[w("teams.createModal.organization")," ",(0,t.jsx)(J.A,{title:(0,t.jsxs)("span",{children:[w("teams.createModal.organizationHelp")," ",(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/user_management_heirarchy",target:"_blank",rel:"noopener noreferrer",style:{color:"#1890ff",textDecoration:"underline"},onClick:e=>e.stopPropagation(),children:w("teams.createModal.userManagementHierarchy")})]}),children:(0,t.jsx)(ed.A,{style:{marginLeft:"4px"}})})]}),name:"organization_id",initialValue:n?n.organization_id:null,className:"mt-8",children:(0,t.jsx)(h.A,{showSearch:!0,allowClear:!0,placeholder:w("teams.createModal.organizationPlaceholder"),onChange:e=>{N.setFieldValue("organization_id",e),z(d?.find(a=>a.organization_id===e)||null)},filterOption:(e,a)=>!!a&&(a.children?.toString()||"").toLowerCase().includes(e.toLowerCase()),optionFilterProp:"children",children:d?.map(e=>(0,t.jsxs)(h.A.Option,{value:e.organization_id,children:[(0,t.jsx)("span",{className:"font-medium",children:e.organization_alias})," ",(0,t.jsxs)("span",{className:"text-gray-500",children:["(",e.organization_id,")"]})]},e.organization_id))})}),(0,t.jsx)(o.A.Item,{label:(0,t.jsxs)("span",{children:[w("teams.createModal.models")," ",(0,t.jsx)(J.A,{title:w("teams.createModal.modelsHelp"),children:(0,t.jsx)(ed.A,{style:{marginLeft:"4px"}})})]}),name:"models",children:(0,t.jsxs)(h.A,{mode:"multiple",placeholder:w("teams.createModal.modelsPlaceholder"),style:{width:"100%"},children:[(0,t.jsx)(h.A.Option,{value:"all-proxy-models",children:w("teams.createModal.allProxyModels")},"all-proxy-models"),L.map(e=>(0,t.jsx)(h.A.Option,{value:e,children:(0,g.$L)(e)},e))]})}),(0,t.jsx)(o.A.Item,{label:w("teams.createModal.maxBudget"),name:"max_budget",children:(0,t.jsx)(ec.A,{step:.01,precision:2,width:200,placeholder:w("teams.createModal.maxBudgetPlaceholder")})}),(0,t.jsx)(o.A.Item,{className:"mt-8",label:w("teams.createModal.budgetDuration"),name:"budget_duration",children:(0,t.jsxs)(h.A,{defaultValue:null,placeholder:w("teams.createModal.budgetDurationPlaceholder"),children:[(0,t.jsx)(h.A.Option,{value:"24h",children:w("teams.createModal.budgetDaily")}),(0,t.jsx)(h.A.Option,{value:"7d",children:w("teams.createModal.budgetWeekly")}),(0,t.jsx)(h.A.Option,{value:"30d",children:w("teams.createModal.budgetMonthly")})]})}),(0,t.jsx)(o.A.Item,{label:w("teams.createModal.tpmLimit"),name:"tpm_limit",children:(0,t.jsx)(ec.A,{step:1,width:400,placeholder:w("teams.createModal.tpmLimitPlaceholder")})}),(0,t.jsx)(o.A.Item,{label:w("teams.createModal.rpmLimit"),name:"rpm_limit",children:(0,t.jsx)(ec.A,{step:1,width:400,placeholder:w("teams.createModal.rpmLimitPlaceholder")})}),(0,t.jsxs)(eo.nD,{className:"mt-20 mb-8",onClick:()=>{$||(B(),H(!0))},children:[(0,t.jsx)(eo.u,{children:(0,t.jsx)("b",{children:w("teams.createModal.advancedSettings")})}),(0,t.jsxs)(eo.jR,{children:[(0,t.jsxs)(eo.nD,{className:"mb-4",children:[(0,t.jsx)(eo.u,{children:(0,t.jsx)("b",{children:w("teams.createModal.otherSettings")})}),(0,t.jsxs)(eo.jR,{children:[(0,t.jsx)(o.A.Item,{label:w("teams.createModal.teamId"),name:"team_id",help:w("teams.createModal.teamIdHelp"),children:(0,t.jsx)(eo.ks,{onChange:e=>{e.target.value=e.target.value.trim()}})}),(0,t.jsx)(o.A.Item,{label:w("teams.createModal.teamMemberBudget"),name:"team_member_budget",normalize:e=>e?Number(e):void 0,tooltip:w("teams.createModal.teamMemberBudgetHelp"),children:(0,t.jsx)(ec.A,{step:.01,precision:2,width:200,placeholder:w("teams.createModal.maxBudgetPlaceholder")})}),(0,t.jsx)(o.A.Item,{label:w("teams.createModal.teamMemberKeyDuration"),name:"team_member_key_duration",tooltip:w("teams.createModal.teamMemberKeyDurationHelp"),children:(0,t.jsx)(eo.ks,{placeholder:w("teams.createModal.teamMemberKeyDurationPlaceholder")})}),(0,t.jsx)(o.A.Item,{label:w("teams.createModal.teamMemberRpmLimit"),name:"team_member_rpm_limit",tooltip:w("teams.createModal.teamMemberRpmLimitHelp"),children:(0,t.jsx)(ec.A,{step:1,width:400,placeholder:w("teams.createModal.maxBudgetPlaceholder")})}),(0,t.jsx)(o.A.Item,{label:w("teams.createModal.teamMemberTpmLimit"),name:"team_member_tpm_limit",tooltip:w("teams.createModal.teamMemberTpmLimitHelp"),children:(0,t.jsx)(ec.A,{step:1,width:400,placeholder:w("teams.createModal.maxBudgetPlaceholder")})}),(0,t.jsx)(o.A.Item,{label:w("teams.createModal.metadata"),name:"metadata",help:w("teams.createModal.metadataHelp"),children:(0,t.jsx)(ei.A.TextArea,{rows:4})}),(0,t.jsx)(o.A.Item,{label:w("teams.createModal.secretManagerSettings"),name:"secret_manager_settings",help:M?w("teams.createModal.secretManagerSettingsHelp"):w("teams.createModal.secretManagerSettingsPremiumHelp"),rules:[{validator:async(e,a)=>{if(!a)return Promise.resolve();try{return JSON.parse(a),Promise.resolve()}catch(e){return Promise.reject(Error(w("teams.createModal.invalidJsonError")))}}}],children:(0,t.jsx)(ei.A.TextArea,{rows:4,placeholder:'{"namespace": "admin", "mount": "secret", "path_prefix": "litellm"}',disabled:!M})}),(0,t.jsx)(o.A.Item,{label:(0,t.jsxs)("span",{children:["护栏"," ",(0,t.jsx)(J.A,{title:"配置你的第一个护栏",children:(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/quick_start",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(ed.A,{style:{marginLeft:"4px"}})})})]}),name:"guardrails",className:"mt-8",help:w("teams.createModal.guardrailsPlaceholder"),children:(0,t.jsx)(h.A,{mode:"tags",style:{width:"100%"},placeholder:w("teams.createModal.guardrailsPlaceholder"),options:F.map(e=>({value:e,label:e}))})}),(0,t.jsx)(o.A.Item,{label:(0,t.jsxs)("span",{children:["禁用全局护栏"," ",(0,t.jsx)(J.A,{title:"开启后，此分组将跳过所有“每次请求都执行”的全局护栏",children:(0,t.jsx)(ed.A,{style:{marginLeft:"4px"}})})]}),name:"disable_global_guardrails",className:"mt-4",valuePropName:"checked",help:w("teams.createModal.disableGlobalGuardrailsLabelHelp"),children:(0,t.jsx)(x.A,{checkedChildren:w("teams.createModal.yes"),unCheckedChildren:w("teams.createModal.no")})}),(0,t.jsx)(o.A.Item,{label:(0,t.jsxs)("span",{children:["策略"," ",(0,t.jsx)(J.A,{title:w("teams.createModal.policiesHelp"),children:(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(ed.A,{style:{marginLeft:"4px"}})})})]}),name:"policies",className:"mt-8",help:w("teams.createModal.policiesPlaceholder"),children:(0,t.jsx)(h.A,{mode:"tags",style:{width:"100%"},placeholder:w("teams.createModal.policiesPlaceholder"),options:E.map(e=>({value:e,label:e}))})}),(0,t.jsx)(o.A.Item,{label:(0,t.jsxs)("span",{children:["可用向量库"," ",(0,t.jsx)(J.A,{title:w("teams.createModal.availableVectorStoresHelp"),children:(0,t.jsx)(ed.A,{style:{marginLeft:"4px"}})})]}),name:"allowed_vector_store_ids",className:"mt-8",help:w("teams.createModal.availableVectorStoresPlaceholder"),children:(0,t.jsx)(em.A,{onChange:e=>N.setFieldValue("allowed_vector_store_ids",e),value:N.getFieldValue("allowed_vector_store_ids"),accessToken:y||"",placeholder:w("teams.createModal.availableVectorStoresPlaceholder")})})]})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsxs)(eo.nD,{className:"mb-4",children:[(0,t.jsx)(eo.u,{children:(0,t.jsx)("b",{children:w("teams.createModal.mcpSettings")})}),(0,t.jsxs)(eo.jR,{children:[(0,t.jsx)(o.A.Item,{label:(0,t.jsxs)("span",{children:["可用 MCP 服务"," ",(0,t.jsx)(J.A,{title:w("teams.createModal.availableMcpServersHelp"),children:(0,t.jsx)(ed.A,{style:{marginLeft:"4px"}})})]}),name:"allowed_mcp_servers_and_groups",className:"mt-4",help:w("teams.createModal.availableMcpServersPlaceholder"),children:(0,t.jsx)(eh.A,{onChange:e=>N.setFieldValue("allowed_mcp_servers_and_groups",e),value:N.getFieldValue("allowed_mcp_servers_and_groups"),accessToken:y||"",placeholder:w("teams.createModal.availableMcpServersPlaceholder")})}),(0,t.jsx)(o.A.Item,{name:"mcp_tool_permissions",initialValue:{},hidden:!0,children:(0,t.jsx)(ei.A,{type:"hidden"})}),(0,t.jsx)(o.A.Item,{noStyle:!0,shouldUpdate:(e,a)=>e.allowed_mcp_servers_and_groups!==a.allowed_mcp_servers_and_groups||e.mcp_tool_permissions!==a.mcp_tool_permissions,children:()=>(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(eg.A,{accessToken:y||"",selectedServers:N.getFieldValue("allowed_mcp_servers_and_groups")?.servers||[],toolPermissions:N.getFieldValue("mcp_tool_permissions")||{},onChange:e=>N.setFieldsValue({mcp_tool_permissions:e})})})})]})]}),(0,t.jsxs)(eo.nD,{className:"mb-4",children:[(0,t.jsx)(eo.u,{children:(0,t.jsx)("b",{children:w("teams.createModal.agentsSettings")})}),(0,t.jsx)(eo.jR,{children:(0,t.jsx)(o.A.Item,{label:(0,t.jsxs)("span",{children:["可用智能体"," ",(0,t.jsx)(J.A,{title:w("teams.createModal.availableAgentsHelp"),children:(0,t.jsx)(ed.A,{style:{marginLeft:"4px"}})})]}),name:"allowed_agents_and_groups",className:"mt-4",help:w("teams.createModal.availableAgentsPlaceholder"),children:(0,t.jsx)(ex.A,{onChange:e=>N.setFieldValue("allowed_agents_and_groups",e),value:N.getFieldValue("allowed_agents_and_groups"),accessToken:y||"",placeholder:w("teams.createModal.availableAgentsPlaceholder")})})})]}),(0,t.jsxs)(eo.nD,{className:"mb-4",children:[(0,t.jsx)(eo.u,{children:(0,t.jsx)("b",{children:w("teams.createModal.loggingSettings")})}),(0,t.jsx)(eo.jR,{children:(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(eu.A,{value:_,onChange:f,premiumUser:M})})})]}),(0,t.jsxs)(eo.nD,{className:"mb-0",children:[(0,t.jsx)(eo.u,{children:(0,t.jsx)("b",{children:w("teams.createModal.modelAliases")})}),(0,t.jsx)(eo.jR,{children:(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)(eo.EY,{className:"text-sm text-gray-600 mb-4",children:w("teams.createModal.modelAliasesDesc")}),(0,t.jsx)(ep.A,{accessToken:y||"",initialModelAliases:u,onAliasUpdate:p,showExampleConfig:!1})]})})]})]})]})]})]}),(0,t.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,t.jsx)(en.Ay,{htmlType:"submit",children:w("teams.createModal.submit")})})]})})},e_=({teams:e,accessToken:a,setTeams:s,userID:c,userRole:m,organizations:h,premiumUser:x=!1})=>{let{t:u}=(0,r.o)(),[p,g]=(0,l.useState)(null),[j,_]=(0,l.useState)(!1),[C,z]=(0,l.useState)({team_id:"",team_alias:"",organization_id:"",sort_by:"created_at",sort_order:"desc"}),[L]=o.A.useForm(),[P]=o.A.useForm(),[F,I]=(0,l.useState)(null),[T,V]=(0,l.useState)(!1),[$,H]=(0,l.useState)(!1),[B,R]=(0,l.useState)(!1),[W,J]=(0,l.useState)(!1),[Y,G]=(0,l.useState)([]),[U,K]=(0,l.useState)(!1),[q,Z]=(0,l.useState)(null),[Q,X]=(0,l.useState)({}),[ee,es]=(0,l.useState)([]),[et,er]=(0,l.useState)({}),{lastRefreshed:ei,onRefreshClick:en}=(({currentOrg:e,setTeams:a})=>{let[s,t]=(0,l.useState)(""),{accessToken:r,userId:i,userRole:o}=(0,D.A)(),d=(0,l.useCallback)(()=>{t(new Date().toLocaleString())},[]);return(0,l.useEffect)(()=>{r&&(0,n.j)(r,i,o,e,a).then(),d()},[r,e,s,d,a,i,o]),{lastRefreshed:s,setLastRefreshed:t,onRefreshClick:d}})({currentOrg:p,setTeams:s});(0,l.useEffect)(()=>{e&&X(e.reduce((e,a)=>(e[a.team_id]={keys:a.keys||[],team_info:{members_with_roles:a.members_with_roles||[]}},e),{}))},[e]);let eo=async e=>{Z(e),K(!0)},ed=async()=>{if(null!=q&&null!=e&&null!=a){try{await (0,i.teamDeleteCall)(a,q),(0,n.j)(a,c,m,p,s)}catch(e){console.error("Error deleting the team:",e)}K(!1),Z(null)}};return(0,t.jsx)("div",{className:"w-full mx-4 h-[75vh]",children:(0,t.jsx)(w.A,{numItems:1,className:"gap-2 p-8 w-full mt-2",children:(0,t.jsxs)(M.A,{numColSpan:1,className:"flex flex-col gap-2",children:[("Admin"==m||"Org Admin"==m)&&(0,t.jsx)(v.A,{className:"w-fit",onClick:()=>H(!0),children:(0,f.Mt)(u,"teams.create")}),F?(0,t.jsx)(d.A,{teamId:F,onUpdate:e=>{s(t=>{if(null==t)return t;let l=t.map(a=>e.team_id===a.team_id?(0,k.$b)(a,e):a);return a&&(0,n.j)(a,c,m,p,s),l})},onClose:()=>{I(null),V(!1)},accessToken:a,is_team_admin:(e=>{if(null==e||null==e.members_with_roles)return!1;for(let a=0;a<e.members_with_roles.length;a++){let s=e.members_with_roles[a];if(s.user_id==c&&"admin"==s.role)return!0}return!1})(e?.find(e=>e.team_id===F)),is_proxy_admin:"Admin"==m,userModels:Y,editTeam:T,premiumUser:x}):(0,t.jsxs)(E,{lastRefreshed:ei,onRefresh:en,userRole:m,children:[(0,t.jsxs)(N.A,{children:[(0,t.jsx)(S.A,{children:(0,f.Mt)(u,"teams.clickToView")}),(0,t.jsx)(w.A,{numItems:1,className:"gap-2 pt-2 pb-2 h-[75vh] w-full mt-2",children:(0,t.jsx)(M.A,{numColSpan:1,children:(0,t.jsxs)(y.A,{className:"w-full mx-auto flex-auto overflow-hidden overflow-y-auto max-h-[50vh]",children:[(0,t.jsx)("div",{className:"border-b px-6 py-4",children:(0,t.jsx)("div",{className:"flex flex-col space-y-4",children:(0,t.jsx)(O,{filters:C,organizations:h,showFilters:j,onToggleFilters:_,onChange:(e,t)=>{let l={...C,[e]:t};z(l),a&&(0,i.v2TeamListCall)(a,l.organization_id||null,null,l.team_id||null,l.team_alias||null).then(e=>{e&&e.teams&&s(e.teams)}).catch(e=>{console.error("Error fetching teams:",e)})},onReset:()=>{z({team_id:"",team_alias:"",organization_id:"",sort_by:"created_at",sort_order:"desc"}),a&&(0,i.v2TeamListCall)(a,null,c||null,null,null).then(e=>{e&&e.teams&&s(e.teams)}).catch(e=>{console.error("Error fetching teams:",e)})}})})}),(0,t.jsx)(ea,{teams:e,currentOrg:p,perTeamInfo:Q,userRole:m,userId:c,setSelectedTeamId:I,setEditTeam:V,onDeleteTeam:eo}),U&&(0,t.jsx)(el,{teams:e,teamToDelete:q,onCancel:()=>{K(!1),Z(null)},onConfirm:ed})]})})})]}),(0,A.OY)(m||"")&&(0,t.jsx)(N.A,{children:(0,t.jsx)(b,{accessToken:a,userID:c||"",userRole:m||""})})]}),("Admin"==m||"Org Admin"==m)&&(0,t.jsx)(ej,{isTeamModalVisible:$,handleOk:()=>{H(!1),L.resetFields(),es([]),er({})},handleCancel:()=>{H(!1),L.resetFields(),es([]),er({})},currentOrg:p,organizations:h,teams:e,setTeams:s,modelAliases:et,setModelAliases:er,loggingSettings:ee,setLoggingSettings:es,setIsTeamModalVisible:H})]})})})}},73626:(e,a,s)=>{s.d(a,{e:()=>l.A,l:()=>t.A});var t=s(39197),l=s(22054)}}]);