(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,910119,e=>{"use strict";var s=e.i(843476),t=e.i(197647),l=e.i(653824),a=e.i(881073),r=e.i(404206),i=e.i(723731),n=e.i(271645),d=e.i(994388),o=e.i(212931),u=e.i(898586),c=e.i(312361),m=e.i(998573),x=e.i(291542),h=e.i(199133),g=e.i(28651),f=e.i(175712),p=e.i(770914),j=e.i(536916),b=e.i(764205),_=e.i(827252),y=e.i(35983),v=e.i(779241),S=e.i(78085),N=e.i(808613),w=e.i(592968),C=e.i(708347),T=e.i(860585),k=e.i(355619),I=e.i(435451),B=e.i(111110);function D({userData:e,onCancel:t,onSubmit:l,teams:a,accessToken:r,userID:i,userRole:o,userModels:u,possibleUIRoles:c,isBulkEdit:m=!1}){let{t:x}=(0,B.useLanguage)(),[g]=N.Form.useForm(),[f,p]=(0,n.useState)(!1);return n.default.useEffect(()=>{let s=e.user_info?.max_budget,t=null==s;p(t),g.setFieldsValue({user_id:e.user_id,user_email:e.user_info?.user_email,user_alias:e.user_info?.user_alias,user_role:e.user_info?.user_role,models:e.user_info?.models||[],max_budget:t?"":s,budget_duration:e.user_info?.budget_duration,metadata:e.user_info?.metadata?JSON.stringify(e.user_info.metadata,null,2):void 0})},[e,g]),(0,s.jsxs)(N.Form,{form:g,onFinish:e=>{if(e.metadata&&"string"==typeof e.metadata)try{e.metadata=JSON.parse(e.metadata)}catch(e){console.error("Error parsing metadata JSON:",e);return}(f||""===e.max_budget||void 0===e.max_budget)&&(e.max_budget=null),l(e)},layout:"vertical",children:[!m&&(0,s.jsx)(N.Form.Item,{label:x("users.userEdit.userId"),name:"user_id",children:(0,s.jsx)(v.TextInput,{disabled:!0})}),!m&&(0,s.jsx)(N.Form.Item,{label:x("users.userEdit.email"),name:"user_email",children:(0,s.jsx)(v.TextInput,{placeholder:x("users.userEdit.inputPlaceholder")})}),(0,s.jsx)(N.Form.Item,{label:x("users.userEdit.userAlias"),name:"user_alias",children:(0,s.jsx)(v.TextInput,{placeholder:x("users.userEdit.inputPlaceholder")})}),(0,s.jsx)(N.Form.Item,{label:(0,s.jsxs)("span",{children:[x("users.userEdit.globalProxyRole")," ",(0,s.jsx)(w.Tooltip,{title:x("users.userEdit.globalProxyRoleTooltip"),children:(0,s.jsx)(_.InfoCircleOutlined,{})})]}),name:"user_role",children:(0,s.jsx)(h.Select,{children:c&&Object.entries(c).map(([e,{ui_label:t,description:l}])=>(0,s.jsx)(y.SelectItem,{value:e,title:t,children:(0,s.jsxs)("div",{className:"flex",children:[t," ",(0,s.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:l})]})},e))})}),(0,s.jsx)(N.Form.Item,{label:(0,s.jsxs)("span",{children:[x("users.userEdit.personalModels")," ",(0,s.jsx)(w.Tooltip,{title:x("users.userEdit.personalModelsTooltip"),children:(0,s.jsx)(_.InfoCircleOutlined,{style:{marginLeft:"4px"}})})]}),name:"models",children:(0,s.jsxs)(h.Select,{mode:"multiple",placeholder:x("users.userEdit.personalModelsPlaceholder"),style:{width:"100%"},disabled:!C.all_admin_roles.includes(o||""),children:[(0,s.jsx)(h.Select.Option,{value:"all-proxy-models",children:x("users.userEdit.allProxyModels")},"all-proxy-models"),(0,s.jsx)(h.Select.Option,{value:"no-default-models",children:x("users.userEdit.noDefaultModels")},"no-default-models"),u.map(e=>(0,s.jsx)(h.Select.Option,{value:e,children:(0,k.getModelDisplayName)(e)},e))]})}),(0,s.jsx)(N.Form.Item,{label:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,s.jsx)("span",{children:x("users.userEdit.maxBudget")}),(0,s.jsx)(j.Checkbox,{checked:f,onChange:e=>{let s=e.target.checked;p(s),s&&g.setFieldsValue({max_budget:""})},children:x("users.userEdit.unlimitedBudget")})]}),name:"max_budget",rules:[{validator:(e,s)=>f||""!==s&&null!=s?Promise.resolve():Promise.reject(Error(x("users.userEdit.maxBudgetValidation")))}],children:(0,s.jsx)(I.default,{step:.01,precision:2,style:{width:"100%"},disabled:f})}),(0,s.jsx)(N.Form.Item,{label:x("users.userEdit.resetBudget"),name:"budget_duration",children:(0,s.jsx)(T.default,{})}),(0,s.jsx)(N.Form.Item,{label:x("users.userEdit.metadata"),name:"metadata",children:(0,s.jsx)(S.Textarea,{rows:4,placeholder:x("users.userEdit.metadataPlaceholder")})}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)(d.Button,{variant:"secondary",type:"button",onClick:t,children:x("users.userEdit.cancel")}),(0,s.jsx)(d.Button,{type:"submit",children:x("users.userEdit.saveChanges")})]})]})}var E=e.i(727749);let{Text:F,Title:A}=u.Typography,U=({open:e,onCancel:t,selectedUsers:l,possibleUIRoles:a,accessToken:r,onSuccess:i,teams:d,userRole:u,userModels:_,allowAllUsers:y=!1})=>{let[v,S]=(0,n.useState)(!1),[N,w]=(0,n.useState)([]),[C,T]=(0,n.useState)(null),[k,I]=(0,n.useState)(!1),[B,U]=(0,n.useState)(!1),L=()=>{w([]),T(null),I(!1),U(!1),t()},R=n.default.useMemo(()=>({user_id:"bulk_edit",user_info:{user_email:"",user_role:"",teams:[],models:[],max_budget:null,spend:0,metadata:{},created_at:null,updated_at:null},keys:[],teams:d||[]}),[d,e]),O=async e=>{if(console.log("formValues",e),!r)return void E.default.fromBackend("Access token not found");S(!0);try{let s=l.map(e=>e.user_id),a={};e.user_role&&""!==e.user_role&&(a.user_role=e.user_role),null!==e.max_budget&&void 0!==e.max_budget&&(a.max_budget=e.max_budget),e.models&&e.models.length>0&&(a.models=e.models),e.budget_duration&&""!==e.budget_duration&&(a.budget_duration=e.budget_duration),e.metadata&&Object.keys(e.metadata).length>0&&(a.metadata=e.metadata);let n=Object.keys(a).length>0,d=k&&N.length>0;if(!n&&!d)return void E.default.fromBackend("Please modify at least one field or select teams to add users to");let o=[];if(n)if(B){let e=await (0,b.userBulkUpdateUserCall)(r,a,void 0,!0);o.push(`Updated all users (${e.total_requested} total)`)}else await (0,b.userBulkUpdateUserCall)(r,a,s),o.push(`Updated ${s.length} user(s)`);if(d){let e=[];for(let s of N)try{let t=null;t=B?null:l.map(e=>({user_id:e.user_id,role:"user",user_email:e.user_email||null}));let a=await (0,b.teamBulkMemberAddCall)(r,s,t||null,C||void 0,B);console.log("result",a),e.push({teamId:s,success:!0,successfulAdditions:a.successful_additions,failedAdditions:a.failed_additions})}catch(t){console.error(`Failed to add users to team ${s}:`,t),e.push({teamId:s,success:!1,error:t})}let s=e.filter(e=>e.success),t=e.filter(e=>!e.success);if(s.length>0){let e=s.reduce((e,s)=>e+s.successfulAdditions,0);o.push(`Added users to ${s.length} team(s) (${e} total additions)`)}t.length>0&&m.message.warning(`Failed to add users to ${t.length} team(s)`)}o.length>0&&E.default.success(o.join(". ")),w([]),T(null),I(!1),U(!1),i(),t()}catch(e){console.error("Bulk operation failed:",e),E.default.fromBackend("Failed to perform bulk operations")}finally{S(!1)}};return(0,s.jsxs)(o.Modal,{open:e,onCancel:L,footer:null,title:B?"Bulk Edit All Users":`Bulk Edit ${l.length} User(s)`,width:800,children:[y&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)(j.Checkbox,{checked:B,onChange:e=>U(e.target.checked),children:(0,s.jsx)(F,{strong:!0,children:"Update ALL users in the system"})}),B&&(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)(F,{type:"warning",style:{fontSize:"12px"},children:"âš ï¸ This will apply changes to ALL users in the system, not just the selected ones."})})]}),!B&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)(A,{level:5,children:["Selected Users (",l.length,"):"]}),(0,s.jsx)(x.Table,{size:"small",bordered:!0,dataSource:l,pagination:!1,scroll:{y:200},rowKey:"user_id",columns:[{title:"User ID",dataIndex:"user_id",key:"user_id",width:"30%",render:e=>(0,s.jsx)(F,{strong:!0,style:{fontSize:"12px"},children:e.length>20?`${e.slice(0,20)}...`:e})},{title:"Email",dataIndex:"user_email",key:"user_email",width:"25%",render:e=>(0,s.jsx)(F,{type:"secondary",style:{fontSize:"12px"},children:e||"No email"})},{title:"Current Role",dataIndex:"user_role",key:"user_role",width:"25%",render:e=>(0,s.jsx)(F,{style:{fontSize:"12px"},children:a?.[e]?.ui_label||e})},{title:"Budget",dataIndex:"max_budget",key:"max_budget",width:"20%",render:e=>(0,s.jsx)(F,{style:{fontSize:"12px"},children:null!==e?`\xa5${e}`:"Unlimited"})}]})]}),(0,s.jsx)(c.Divider,{}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)(F,{children:[(0,s.jsx)("strong",{children:"Instructions:"})," Fill in the fields below with the values you want to apply to all selected users. You can bulk edit: role, budget, models, and metadata. You can also add users to teams."]})}),(0,s.jsx)(f.Card,{title:"Team Management",size:"small",className:"mb-4",style:{backgroundColor:"#fafafa"},children:(0,s.jsxs)(p.Space,{direction:"vertical",style:{width:"100%"},children:[(0,s.jsx)(j.Checkbox,{checked:k,onChange:e=>I(e.target.checked),children:"Add selected users to teams"}),k&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{strong:!0,children:"Select Teams:"}),(0,s.jsx)(h.Select,{mode:"multiple",placeholder:"Select teams to add users to",value:N,onChange:w,style:{width:"100%",marginTop:8},options:d?.map(e=>({label:e.team_alias||e.team_id,value:e.team_id}))||[]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{strong:!0,children:"Team Budget (Optional):"}),(0,s.jsx)(g.InputNumber,{placeholder:"Max budget per user in team",value:C,onChange:e=>T(e),style:{width:"100%",marginTop:8},min:0,step:.01,precision:2}),(0,s.jsx)(F,{type:"secondary",style:{fontSize:"12px"},children:"Leave empty for unlimited budget within team limits"})]}),(0,s.jsx)(F,{type:"secondary",style:{fontSize:"12px"},children:'Users will be added with "user" role by default. All users will be added to each selected team.'})]})]})}),(0,s.jsx)(D,{userData:R,onCancel:L,onSubmit:O,teams:d,accessToken:r,userID:"bulk_edit",userRole:u,userModels:_,possibleUIRoles:a,isBulkEdit:!0}),v&&(0,s.jsx)("div",{style:{textAlign:"center",marginTop:"10px"},children:(0,s.jsxs)(F,{children:["Updating ",B?"all users":l.length," user(s)..."]})})]})};var L=e.i(371455),R=e.i(464571);let O=({visible:e,possibleUIRoles:t,onCancel:l,user:a,onSubmit:r})=>{let[i,d]=(0,n.useState)(a),[u]=N.Form.useForm();(0,n.useEffect)(()=>{u.resetFields()},[a]);let c=async()=>{u.resetFields(),l()},m=async e=>{r(e),u.resetFields(),l()};return a?(0,s.jsx)(o.Modal,{open:e,onCancel:c,footer:null,title:"Edit User "+a.user_id,width:1e3,children:(0,s.jsx)(N.Form,{form:u,onFinish:m,initialValues:a,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.Form.Item,{className:"mt-8",label:"User Email",tooltip:"Email of the User",name:"user_email",children:(0,s.jsx)(v.TextInput,{})}),(0,s.jsx)(N.Form.Item,{label:"user_id",name:"user_id",hidden:!0,children:(0,s.jsx)(v.TextInput,{})}),(0,s.jsx)(N.Form.Item,{label:"User Role",name:"user_role",children:(0,s.jsx)(h.Select,{children:t&&Object.entries(t).map(([e,{ui_label:t,description:l}])=>(0,s.jsx)(y.SelectItem,{value:e,title:t,children:(0,s.jsxs)("div",{className:"flex",children:[t," ",(0,s.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:l})]})},e))})}),(0,s.jsx)(N.Form.Item,{label:"èŠ±è´¹",name:"spend",tooltip:"(float) - Spend of all LLM calls completed by this user",help:"Across all keys (including keys with team_id).",children:(0,s.jsx)(g.InputNumber,{min:0,step:.01})}),(0,s.jsx)(N.Form.Item,{label:"ç”¨æˆ·é¢„ç®—",name:"max_budget",tooltip:"(float) - Maximum budget of this user",help:"Maximum budget of this user.",children:(0,s.jsx)(I.default,{min:0,step:.01})}),(0,s.jsx)(N.Form.Item,{label:"Reset Budget",name:"budget_duration",children:(0,s.jsx)(T.default,{})}),(0,s.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,s.jsx)(R.Button,{htmlType:"submit",children:"Save"})}),(0,s.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,s.jsx)(R.Button,{htmlType:"submit",children:"Save"})})]})})}):null};var P=e.i(172372),z=e.i(500330),M=e.i(152473),$=e.i(266027),K=e.i(912598),V=e.i(127952),q=e.i(304967),W=e.i(629569),J=e.i(599724),Q=e.i(114600),G=e.i(482725),H=e.i(790848),Y=e.i(646563),X=e.i(955135);let Z={"view/create/delete their own keys, view their own spend":"å¯æŸ¥çœ‹/åˆ›å»º/åˆ é™¤è‡ªå·±çš„å¯†é’¥ï¼Œå¹¶æŸ¥çœ‹è‡ªå·±çš„èŠ±è´¹","view their own keys, view their own spend":"ä»…å¯æŸ¥çœ‹è‡ªå·±çš„å¯†é’¥å’ŒèŠ±è´¹"},ee={"Default role assigned to new users created":"users.defaultSettings.fieldDescriptions.userRole","Default maximum budget (in USD) for new users created":"users.defaultSettings.fieldDescriptions.maxBudget","Default budget duration for new users (e.g. 'daily', 'weekly', 'monthly')":"users.defaultSettings.fieldDescriptions.budgetDuration","Default allowed models for new users":"users.defaultSettings.fieldDescriptions.models","Default team assignments for new users":"users.defaultSettings.fieldDescriptions.teams"},es=({accessToken:e,possibleUIRoles:t,userID:l,userRole:a})=>{var r;let{t:i}=(0,B.useLanguage)(),[o,c]=(0,n.useState)(!0),[m,x]=(0,n.useState)(null),[f,p]=(0,n.useState)(!1),[j,_]=(0,n.useState)({}),[y,S]=(0,n.useState)(!1),[N,w]=(0,n.useState)([]),{Paragraph:C}=u.Typography,{Option:I}=h.Select;(0,n.useEffect)(()=>{(async()=>{if(!e)return c(!1);try{let s=await (0,b.getInternalUserSettings)(e);if(x(s),_(s.values||{}),e)try{let s=await (0,b.modelAvailableCall)(e,l,a);if(s&&s.data){let e=s.data.map(e=>e.id);w(e)}}catch(e){console.error("Error fetching available models:",e)}}catch(e){console.error("Error fetching SSO settings:",e),E.default.fromBackend("Failed to fetch SSO settings")}finally{c(!1)}})()},[e]);let D=async()=>{if(e){S(!0);try{let s=Object.entries(j).reduce((e,[s,t])=>(e[s]=""===t?null:t,e),{}),t=await (0,b.updateInternalUserSettings)(e,s);x({...m,values:t.settings}),p(!1)}catch(e){console.error("Error updating SSO settings:",e),E.default.fromBackend("Failed to update settings: "+e)}finally{S(!1)}}},F=(e,s)=>{_(t=>({...t,[e]:s}))},A=e=>e&&Array.isArray(e)?e.map(e=>"string"==typeof e?{team_id:e,user_role:"user"}:"object"==typeof e&&e.team_id?{team_id:e.team_id,max_budget_in_team:e.max_budget_in_team,user_role:e.user_role||"user"}:{team_id:"",user_role:"user"}):[];return o?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)(G.Spin,{size:"large"})}):m?(0,s.jsxs)(q.Card,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)(W.Title,{children:i("users.defaultSettings.title")}),!o&&m&&(f?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(d.Button,{variant:"secondary",onClick:()=>{p(!1),_(m.values||{})},disabled:y,children:i("users.defaultSettings.cancel")}),(0,s.jsx)(d.Button,{onClick:D,loading:y,children:i("users.defaultSettings.saveChanges")})]}):(0,s.jsx)(d.Button,{onClick:()=>p(!0),children:i("users.defaultSettings.editSettings")}))]}),m?.field_schema?.description&&(0,s.jsx)(C,{className:"mb-4",children:(r=m.field_schema.description)?r.includes("Default parameters to apply when a new user signs in via SSO")?i("users.defaultSettings.schemaDescription"):r:""}),(0,s.jsx)(Q.Divider,{}),(0,s.jsx)("div",{className:"mt-4 space-y-4",children:(()=>{let{values:e,field_schema:l}=m;return l&&l.properties?Object.entries(l.properties).map(([l,a])=>{let r=e[l],n={user_role:i("users.defaultSettings.fieldLabels.userRole"),max_budget:i("users.defaultSettings.fieldLabels.maxBudget"),budget_duration:i("users.defaultSettings.fieldLabels.budgetDuration"),models:i("users.defaultSettings.fieldLabels.models"),teams:i("users.defaultSettings.fieldLabels.teams")}[l]||l.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),o=((e,s)=>{let t={user_role:i("users.defaultSettings.fieldDescriptions.userRole"),max_budget:i("users.defaultSettings.fieldDescriptions.maxBudget"),budget_duration:i("users.defaultSettings.fieldDescriptions.budgetDuration"),models:i("users.defaultSettings.fieldDescriptions.models"),teams:i("users.defaultSettings.fieldDescriptions.teams")};if(t[e])return t[e];if(s){let e=ee[s];return e?i(e):s}return i("users.defaultSettings.noDescription")})(l,a.description);return(0,s.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200 last:border-0",children:[(0,s.jsx)(J.Text,{className:"font-medium text-lg",children:n}),(0,s.jsx)(C,{className:"text-sm text-gray-500 mt-1",children:o}),f?(0,s.jsx)("div",{className:"mt-2",children:((e,l,a)=>{let r=l.type;if("teams"===e){let t,l;return(0,s.jsx)("div",{className:"mt-2",children:(t=A(j[e]||[]),l=(e,s,l)=>{let a=[...t];a[e]={...a[e],[s]:l},F("teams",a)},(0,s.jsxs)("div",{className:"space-y-3",children:[t.map((e,a)=>(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)(J.Text,{className:"font-medium",children:[i("users.defaultSettings.team")," ",a+1]}),(0,s.jsx)(d.Button,{size:"sm",variant:"secondary",icon:X.DeleteOutlined,onClick:()=>{F("teams",t.filter((e,s)=>s!==a))},className:"text-red-500 hover:text-red-700",children:i("users.defaultSettings.remove")})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"text-sm font-medium mb-1",children:i("users.defaultSettings.teamId")}),(0,s.jsx)(v.TextInput,{value:e.team_id,onChange:e=>l(a,"team_id",e.target.value),placeholder:i("users.defaultSettings.teamIdPlaceholder")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"text-sm font-medium mb-1",children:i("users.defaultSettings.maxBudget")}),(0,s.jsx)(g.InputNumber,{style:{width:"100%"},value:e.max_budget_in_team,onChange:e=>l(a,"max_budget_in_team",e),placeholder:i("users.defaultSettings.notSpecified"),min:0,step:.01,precision:2})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"text-sm font-medium mb-1",children:i("users.defaultSettings.userRole")}),(0,s.jsxs)(h.Select,{style:{width:"100%"},value:e.user_role,onChange:e=>l(a,"user_role",e),children:[(0,s.jsx)(I,{value:"user",children:i("users.defaultSettings.userRoleUser")}),(0,s.jsx)(I,{value:"admin",children:i("users.defaultSettings.userRoleAdmin")})]})]})]})]},a)),(0,s.jsx)(d.Button,{variant:"secondary",icon:Y.PlusOutlined,onClick:()=>{F("teams",[...t,{team_id:"",user_role:"user"}])},className:"w-full",children:i("users.defaultSettings.addTeam")})]}))})}{if("user_role"===e&&t)return(0,s.jsx)(h.Select,{style:{width:"100%"},value:j[e]||"",onChange:s=>F(e,s),className:"mt-2",children:Object.entries(t).filter(([e])=>e.includes("internal_user")).map(([e,{ui_label:t,description:l}])=>(0,s.jsx)(I,{value:e,children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:l?Z[l]||l:""})]})},e))});if("budget_duration"===e)return(0,s.jsx)(T.default,{value:j[e]||null,onChange:s=>F(e,s),className:"mt-2"});if("boolean"===r)return(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(H.Switch,{checked:!!j[e],onChange:s=>F(e,s)})});if("array"===r&&l.items?.enum)return(0,s.jsx)(h.Select,{mode:"multiple",style:{width:"100%"},value:j[e]||[],onChange:s=>F(e,s),className:"mt-2",children:l.items.enum.map(e=>(0,s.jsx)(I,{value:e,children:e},e))});if("models"===e)return(0,s.jsxs)(h.Select,{mode:"multiple",style:{width:"100%"},value:j[e]||[],onChange:s=>F(e,s),className:"mt-2",children:[(0,s.jsx)(I,{value:"no-default-models",children:i("users.defaultSettings.noDefaultModels")},"no-default-models"),(0,s.jsx)(I,{value:"all-proxy-models",children:i("users.defaultSettings.allProxyModels")},"all-proxy-models"),N.map(e=>(0,s.jsx)(I,{value:e,children:(0,k.getModelDisplayName)(e)},e))]});if("string"===r&&l.enum)return(0,s.jsx)(h.Select,{style:{width:"100%"},value:j[e]||"",onChange:s=>F(e,s),className:"mt-2",children:l.enum.map(e=>(0,s.jsx)(I,{value:e,children:e},e))});if("number"===r||"integer"===r)return(0,s.jsx)(g.InputNumber,{style:{width:"100%"},value:null===j[e]||void 0===j[e]?void 0:j[e],onChange:s=>F(e,s),placeholder:i("users.defaultSettings.notSpecified"),className:"mt-2"});let a=l.description,n=a&&ee[a]?i(ee[a]):a||"";return(0,s.jsx)(v.TextInput,{value:null===j[e]||void 0===j[e]?"":String(j[e]),onChange:s=>F(e,s.target.value),placeholder:n,className:"mt-2"})}})(l,a,0)}):(0,s.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded",children:((e,l)=>{if(null==l)return(0,s.jsx)("span",{className:"text-gray-400",children:i("users.defaultSettings.notSet")});if("teams"===e&&Array.isArray(l)){if(0===l.length)return(0,s.jsx)("span",{className:"text-gray-400",children:i("users.defaultSettings.noTeamsAssigned")});let e=A(l);return(0,s.jsx)("div",{className:"space-y-2 mt-1",children:e.map((e,t)=>(0,s.jsx)("div",{className:"border rounded-lg p-3 bg-white",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-600",children:i("users.defaultSettings.teamIdLabel")}),(0,s.jsx)("p",{className:"text-gray-900",children:e.team_id||i("users.defaultSettings.notSpecified")})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"font-medium text-gray-600",children:[i("users.defaultSettings.maxBudget"),":"]}),(0,s.jsx)("p",{className:"text-gray-900",children:void 0!==e.max_budget_in_team?`\xa5${(0,z.formatNumberWithCommas)(e.max_budget_in_team,4)}`:i("users.defaultSettings.noLimit")})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"font-medium text-gray-600",children:[i("users.defaultSettings.role"),":"]}),(0,s.jsx)("p",{className:"text-gray-900 capitalize",children:e.user_role})]})]})},t))})}if("user_role"===e&&t&&t[l]){let{ui_label:e,description:a}=t[l];return(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:e}),a&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:Z[a]||a})]})}if("budget_duration"===e)return(0,s.jsx)("span",{children:(0,T.getBudgetDurationLabel)(l)});if("boolean"==typeof l)return(0,s.jsx)("span",{children:l?i("users.defaultSettings.enabled"):i("users.defaultSettings.disabled")});if("models"===e&&Array.isArray(l))return 0===l.length?(0,s.jsx)("span",{className:"text-gray-400",children:i("users.defaultSettings.none")}):(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:l.map((e,t)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:(0,k.getModelDisplayName)(e)},t))});if("object"==typeof l)return Array.isArray(l)?0===l.length?(0,s.jsx)("span",{className:"text-gray-400",children:i("users.defaultSettings.none")}):(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:l.map((e,t)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:"object"==typeof e?JSON.stringify(e):String(e)},t))}):(0,s.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(l,null,2)});return(0,s.jsx)("span",{children:String(l)})})(l,r)})]},l)}):(0,s.jsx)(J.Text,{children:i("users.defaultSettings.noSchema")})})()})]}):(0,s.jsx)(q.Card,{children:(0,s.jsx)(J.Text,{children:i("users.defaultSettings.notAvailable")})})};var et=e.i(389083),el=e.i(350967),ea=e.i(752978),er=e.i(591935),ei=e.i(68155),en=e.i(502275),ed=e.i(278587);let eo=(e,t,l,a,r,i)=>{let n=[{header:"ç”¨æˆ· ID",accessorKey:"user_id",enableSorting:!0,cell:({row:e})=>(0,s.jsx)(w.Tooltip,{title:e.original.user_id,children:(0,s.jsx)("span",{className:"text-xs",children:e.original.user_id?`${e.original.user_id.slice(0,7)}...`:"-"})})},{header:"ç”¨æˆ·å",accessorKey:"user_email",enableSorting:!0,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:e.original.user_email||"-"})},{header:"å…¨å±€ä»£ç†è§’è‰²",accessorKey:"user_role",enableSorting:!0,cell:({row:t})=>(0,s.jsx)("span",{className:"text-xs",children:e?.[t.original.user_role]?.ui_label||"-"})},{header:"èŠ±è´¹",accessorKey:"spend",enableSorting:!0,cell:({row:e})=>{let t=e.original.spend;return(0,s.jsx)("span",{className:"text-xs",children:null!=t?`\xa5${(0,z.formatNumberWithCommas)(t,4)}`:"-"})}},{header:"é¢„ç®—",accessorKey:"max_budget",enableSorting:!1,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:null!==e.original.max_budget?e.original.max_budget:"ä¸é™åˆ¶"})},{header:()=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:"SSO ID"}),(0,s.jsx)(w.Tooltip,{title:"SSO ID æ˜¯ç”¨æˆ·åœ¨ SSO æä¾›æ–¹ä¸­çš„æ ‡è¯†ã€‚è‹¥ç”¨æˆ·æœªä½¿ç”¨ SSOï¼Œåˆ™ä¸ºç©ºã€‚",children:(0,s.jsx)(en.InformationCircleIcon,{className:"w-4 h-4"})})]}),accessorKey:"sso_user_id",enableSorting:!1,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:null!==e.original.sso_user_id?e.original.sso_user_id:"-"})},{header:"APIå¯†é’¥",accessorKey:"key_count",enableSorting:!1,cell:({row:e})=>(0,s.jsx)(el.Grid,{numItems:2,children:e.original.key_count>0?(0,s.jsxs)(et.Badge,{size:"xs",color:"indigo",children:[e.original.key_count," ",(e.original.key_count,"ä¸ªå¯†é’¥")]}):(0,s.jsx)(et.Badge,{size:"xs",color:"gray",children:"æ— å¯†é’¥"})})},{header:"åˆ›å»ºæ—¶é—´",accessorKey:"created_at",enableSorting:!0,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:e.original.created_at?new Date(e.original.created_at).toLocaleDateString():"-"})},{header:"æ›´æ–°æ—¶é—´",accessorKey:"updated_at",enableSorting:!1,cell:({row:e})=>(0,s.jsx)("span",{className:"text-xs",children:e.original.updated_at?new Date(e.original.updated_at).toLocaleDateString():"-"})},{id:"actions",header:"æ“ä½œ",enableSorting:!1,cell:({row:e})=>(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(w.Tooltip,{title:"ç¼–è¾‘ç”¨æˆ·è¯¦æƒ…",children:(0,s.jsx)(ea.Icon,{icon:er.PencilAltIcon,size:"sm",onClick:()=>r(e.original.user_id,!0),className:"cursor-pointer hover:text-blue-600"})}),(0,s.jsx)(w.Tooltip,{title:"åˆ é™¤ç”¨æˆ·",children:(0,s.jsx)(ea.Icon,{icon:ei.TrashIcon,size:"sm",onClick:()=>l(e.original),className:"cursor-pointer hover:text-red-600"})}),(0,s.jsx)(w.Tooltip,{title:"é‡ç½®å¯†ç ",children:(0,s.jsx)(ea.Icon,{icon:ed.RefreshIcon,size:"sm",onClick:()=>a(e.original.user_id),className:"cursor-pointer hover:text-green-600"})})]})}];if(i){let{onSelectUser:e,onSelectAll:t,isUserSelected:l,isAllSelected:a,isIndeterminate:r}=i;return[{id:"select",enableSorting:!1,header:()=>(0,s.jsx)(j.Checkbox,{indeterminate:r,checked:a,onChange:e=>t(e.target.checked),onClick:e=>e.stopPropagation()}),cell:({row:t})=>(0,s.jsx)(j.Checkbox,{checked:l(t.original),onChange:s=>e(t.original,s.target.checked),onClick:e=>e.stopPropagation()})},...n]}return n},eu={proxy_admin:"ç®¡ç†å‘˜ï¼ˆå…¨éƒ¨æƒé™ï¼‰",proxy_admin_viewer:"ç®¡ç†å‘˜ï¼ˆä»…æŸ¥çœ‹ï¼‰",internal_user:"å†…éƒ¨ç”¨æˆ·ï¼ˆå¯åˆ›å»º/åˆ é™¤/æŸ¥çœ‹ï¼‰",internal_user_viewer:"å†…éƒ¨ç”¨æˆ·ï¼ˆä»…æŸ¥çœ‹ï¼‰"},ec={"Admin (All Permissions)":"ç®¡ç†å‘˜ï¼ˆå…¨éƒ¨æƒé™ï¼‰","Admin (View Only)":"ç®¡ç†å‘˜ï¼ˆä»…æŸ¥çœ‹ï¼‰","Internal User (Create/Delete/View)":"å†…éƒ¨ç”¨æˆ·ï¼ˆå¯åˆ›å»º/åˆ é™¤/æŸ¥çœ‹ï¼‰","Internal User (View Only)":"å†…éƒ¨ç”¨æˆ·ï¼ˆä»…æŸ¥çœ‹ï¼‰"};var em=e.i(152990),ex=e.i(682830),eh=e.i(269200),eg=e.i(427612),ef=e.i(64848),ep=e.i(942232),ej=e.i(496020),eb=e.i(977572),e_=e.i(206929),ey=e.i(94629),ev=e.i(360820),eS=e.i(871943),eN=e.i(981339),ew=e.i(530212),eC=e.i(118366),eT=e.i(678784);function ek({userId:e,onClose:o,accessToken:u,userRole:c,onDelete:m,possibleUIRoles:x,initialTab:h=0,startInEditMode:g=!1}){let[f,p]=(0,n.useState)(null),[j,_]=(0,n.useState)(!1),[y,v]=(0,n.useState)(!1),[S,N]=(0,n.useState)(!0),[w,k]=(0,n.useState)(g),[I,B]=(0,n.useState)([]),[F,A]=(0,n.useState)(!1),[U,L]=(0,n.useState)(null),[O,M]=(0,n.useState)(null),[$,K]=(0,n.useState)(h),[Q,G]=(0,n.useState)({}),[H,Y]=(0,n.useState)(!1);n.default.useEffect(()=>{M((0,b.getProxyBaseUrl)())},[]),n.default.useEffect(()=>{console.log(`userId: ${e}, userRole: ${c}, accessToken: ${u}`),(async()=>{try{if(!u)return;let s=await (0,b.userInfoCall)(u,e,c||"",!1,null,null,!0);p(s);let t=(await (0,b.modelAvailableCall)(u,e,c||"")).data.map(e=>e.id);B(t)}catch(e){console.error("Error fetching user data:",e),E.default.fromBackend("èŽ·å–ç”¨æˆ·æ•°æ®å¤±è´¥")}finally{N(!1)}})()},[u,e,c]);let X=async()=>{if(!u)return void E.default.fromBackend("æœªæ‰¾åˆ°è®¿é—®ä»¤ç‰Œ");try{E.default.success("æ­£åœ¨ç”Ÿæˆé‡ç½®å¯†ç é“¾æŽ¥...");let s=await (0,b.invitationCreateCall)(u,e);L(s),A(!0)}catch(e){E.default.fromBackend("ç”Ÿæˆé‡ç½®å¯†ç é“¾æŽ¥å¤±è´¥")}},Z=async()=>{try{if(!u)return;v(!0),await (0,b.userDeleteCall)(u,[e]),E.default.success("ç”¨æˆ·åˆ é™¤æˆåŠŸ"),m&&m(),o()}catch(e){console.error("Error deleting user:",e),E.default.fromBackend("åˆ é™¤ç”¨æˆ·å¤±è´¥")}finally{_(!1),v(!1)}},ee=async e=>{try{if(!u||!f)return;await (0,b.userUpdateUserCall)(u,e,null),p({...f,user_info:{...f.user_info,user_email:e.user_email,user_alias:e.user_alias,models:e.models,max_budget:e.max_budget,budget_duration:e.budget_duration,metadata:e.metadata}}),E.default.success("ç”¨æˆ·æ›´æ–°æˆåŠŸ"),k(!1)}catch(e){console.error("Error updating user:",e),E.default.fromBackend("æ›´æ–°ç”¨æˆ·å¤±è´¥")}};if(S)return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)(d.Button,{icon:ew.ArrowLeftIcon,variant:"light",onClick:o,className:"mb-4",children:"è¿”å›žç”¨æˆ·åˆ—è¡¨"}),(0,s.jsx)(J.Text,{children:"æ­£åœ¨åŠ è½½ç”¨æˆ·æ•°æ®..."})]});if(!f)return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)(d.Button,{icon:ew.ArrowLeftIcon,variant:"light",onClick:o,className:"mb-4",children:"è¿”å›žç”¨æˆ·åˆ—è¡¨"}),(0,s.jsx)(J.Text,{children:"æœªæ‰¾åˆ°ç”¨æˆ·"})]});let es=async(e,s)=>{await (0,z.copyToClipboard)(e)&&(G(e=>({...e,[s]:!0})),setTimeout(()=>{G(e=>({...e,[s]:!1}))},2e3))};return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.Button,{icon:ew.ArrowLeftIcon,variant:"light",onClick:o,className:"mb-4",children:"è¿”å›žç”¨æˆ·åˆ—è¡¨"}),(0,s.jsx)(W.Title,{children:f.user_info?.user_email||"ç”¨æˆ·"}),(0,s.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)(J.Text,{className:"text-gray-500 font-mono",children:f.user_id}),(0,s.jsx)(R.Button,{type:"text",size:"small",icon:Q["user-id"]?(0,s.jsx)(eT.CheckIcon,{size:12}):(0,s.jsx)(eC.CopyIcon,{size:12}),onClick:()=>es(f.user_id,"user-id"),className:`left-2 z-10 transition-all duration-200 ${Q["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),c&&C.rolesWithWriteAccess.includes(c)&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(d.Button,{icon:ed.RefreshIcon,variant:"secondary",onClick:X,className:"flex items-center",children:"é‡ç½®å¯†ç "}),(0,s.jsx)(d.Button,{icon:ei.TrashIcon,variant:"secondary",onClick:()=>_(!0),className:"flex items-center text-red-500 border-red-500 hover:text-red-600 hover:border-red-600",children:"åˆ é™¤ç”¨æˆ·"})]})]}),(0,s.jsx)(V.default,{isOpen:j,title:"åˆ é™¤ç”¨æˆ·ï¼Ÿ",message:"ç¡®è®¤åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚",resourceInformationTitle:"ç”¨æˆ·ä¿¡æ¯",resourceInformation:[{label:"é‚®ç®±",value:f.user_info?.user_email},{label:"ç”¨æˆ· ID",value:f.user_id,code:!0},{label:"å…¨å±€ä»£ç†è§’è‰²",value:f.user_info?.user_role&&x?.[f.user_info.user_role]?.ui_label||f.user_info?.user_role||"-"},{label:"æ€»èŠ±è´¹",value:f.user_info?.spend!==null&&f.user_info?.spend!==void 0?`\xa5${f.user_info.spend.toFixed(2)}`:void 0}],onCancel:()=>{_(!1)},onOk:Z,confirmLoading:y}),(0,s.jsxs)(l.TabGroup,{defaultIndex:$,onIndexChange:K,children:[(0,s.jsxs)(a.TabList,{className:"mb-4",children:[(0,s.jsx)(t.Tab,{children:"æ¦‚è§ˆ"}),(0,s.jsx)(t.Tab,{children:"è¯¦æƒ…"})]}),(0,s.jsxs)(i.TabPanels,{children:[(0,s.jsx)(r.TabPanel,{children:(0,s.jsxs)(el.Grid,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,s.jsxs)(q.Card,{children:[(0,s.jsx)(J.Text,{children:"èŠ±è´¹"}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsxs)(W.Title,{children:["Â¥",(0,z.formatNumberWithCommas)(f.user_info?.spend||0,4)]}),(0,s.jsxs)(J.Text,{children:["of"," ",f.user_info?.max_budget!==null?`\xa5${(0,z.formatNumberWithCommas)(f.user_info.max_budget,4)}`:"ä¸é™åˆ¶"]})]})]}),(0,s.jsxs)(q.Card,{children:[(0,s.jsx)(J.Text,{children:"åˆ†ç»„"}),(0,s.jsx)("div",{className:"mt-2",children:f.teams?.length&&f.teams?.length>0?(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[f.teams?.slice(0,H?f.teams.length:20).map((e,t)=>(0,s.jsx)(et.Badge,{color:"blue",title:e.team_alias,children:e.team_alias},t)),!H&&f.teams?.length>20&&(0,s.jsxs)(et.Badge,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Y(!0),children:["+",f.teams.length-20," æ›´å¤š"]}),H&&f.teams?.length>20&&(0,s.jsx)(et.Badge,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Y(!1),children:"æ”¶èµ·"})]}):(0,s.jsx)(J.Text,{children:"æ— åˆ†ç»„"})})]}),(0,s.jsxs)(q.Card,{children:[(0,s.jsx)(J.Text,{children:"APIå¯†é’¥"}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsxs)(J.Text,{children:[f.keys?.length||0," ",(f.keys?.length,"ä¸ªå¯†é’¥")]})})]}),(0,s.jsxs)(q.Card,{children:[(0,s.jsx)(J.Text,{children:"ä¸ªäººæ¨¡åž‹"}),(0,s.jsx)("div",{className:"mt-2",children:f.user_info?.models?.length&&f.user_info?.models?.length>0?f.user_info?.models?.map((e,t)=>(0,s.jsx)(J.Text,{children:e},t)):(0,s.jsx)(J.Text,{children:"å…¨éƒ¨æ¨¡åž‹"})})]})]})}),(0,s.jsx)(r.TabPanel,{children:(0,s.jsxs)(q.Card,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)(W.Title,{children:"ç”¨æˆ·è®¾ç½®"}),!w&&c&&C.rolesWithWriteAccess.includes(c)&&(0,s.jsx)(d.Button,{onClick:()=>k(!0),children:"ç¼–è¾‘è®¾ç½®"})]}),w&&f?(0,s.jsx)(D,{userData:f,onCancel:()=>k(!1),onSubmit:ee,teams:f.teams,accessToken:u,userID:e,userRole:c,userModels:I,possibleUIRoles:x}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"ç”¨æˆ· ID"}),(0,s.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,s.jsx)(J.Text,{className:"font-mono",children:f.user_id}),(0,s.jsx)(R.Button,{type:"text",size:"small",icon:Q["user-id"]?(0,s.jsx)(eT.CheckIcon,{size:12}):(0,s.jsx)(eC.CopyIcon,{size:12}),onClick:()=>es(f.user_id,"user-id"),className:`left-2 z-10 transition-all duration-200 ${Q["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"é‚®ç®±"}),(0,s.jsx)(J.Text,{children:f.user_info?.user_email||"æœªè®¾ç½®"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"ç”¨æˆ·åˆ«å"}),(0,s.jsx)(J.Text,{children:f.user_info?.user_alias||"æœªè®¾ç½®"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"å…¨å±€ä»£ç†è§’è‰²"}),(0,s.jsx)(J.Text,{children:f.user_info?.user_role||"æœªè®¾ç½®"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"åˆ›å»ºæ—¶é—´"}),(0,s.jsx)(J.Text,{children:f.user_info?.created_at?new Date(f.user_info.created_at).toLocaleString():"æœªçŸ¥"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"æœ€è¿‘æ›´æ–°æ—¶é—´"}),(0,s.jsx)(J.Text,{children:f.user_info?.updated_at?new Date(f.user_info.updated_at).toLocaleString():"æœªçŸ¥"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"åˆ†ç»„"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:f.teams?.length&&f.teams?.length>0?(0,s.jsxs)(s.Fragment,{children:[f.teams?.slice(0,H?f.teams.length:20).map((e,t)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",title:e.team_alias||e.team_id,children:e.team_alias||e.team_id},t)),!H&&f.teams?.length>20&&(0,s.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Y(!0),children:["+",f.teams.length-20," æ›´å¤š"]}),H&&f.teams?.length>20&&(0,s.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Y(!1),children:"æ”¶èµ·"})]}):(0,s.jsx)(J.Text,{children:"æ— åˆ†ç»„"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"ä¸ªäººæ¨¡åž‹"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:f.user_info?.models?.length&&f.user_info?.models?.length>0?f.user_info?.models?.map((e,t)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:e},t)):(0,s.jsx)(J.Text,{children:"å…¨éƒ¨æ¨¡åž‹"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"APIå¯†é’¥"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:f.keys?.length&&f.keys?.length>0?f.keys.map((e,t)=>(0,s.jsx)("span",{className:"px-2 py-1 bg-green-100 rounded text-xs",children:e.key_alias||e.token},t)):(0,s.jsx)(J.Text,{children:"æ— APIå¯†é’¥"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"æœ€å¤§é¢„ç®—"}),(0,s.jsx)(J.Text,{children:f.user_info?.max_budget!==null&&f.user_info?.max_budget!==void 0?`\xa5${(0,z.formatNumberWithCommas)(f.user_info.max_budget,4)}`:"ä¸é™åˆ¶"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"é¢„ç®—é‡ç½®å‘¨æœŸ"}),(0,s.jsx)(J.Text,{children:(0,T.getBudgetDurationLabel)(f.user_info?.budget_duration??null)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.Text,{className:"font-medium",children:"å…ƒæ•°æ®"}),(0,s.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(f.user_info?.metadata||{},null,2)})]})]})]})})]})]}),(0,s.jsx)(P.default,{isInvitationLinkModalVisible:F,setIsInvitationLinkModalVisible:A,baseUrl:O||"",invitationLinkData:U,modalType:"resetPassword"})]})}var eI=e.i(655913),eB=e.i(38419),eD=e.i(78334),eE=e.i(555436),eF=e.i(284614);let eA=(0,e.i(475254).default)("circle-user-round",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function eU({data:e=[],columns:t,isLoading:l=!1,onSortChange:a,currentSort:r,accessToken:i,userRole:d,possibleUIRoles:o,handleEdit:u,handleDelete:c,handleResetPassword:m,selectedUsers:x=[],onSelectionChange:h,enableSelection:g=!1,filters:f,updateFilters:p,initialFilters:j,teams:b,userListResponse:_,currentPage:v,handlePageChange:S}){let[N,w]=n.default.useState([{id:r?.sortBy||"created_at",desc:r?.sortOrder==="desc"}]),[C,T]=n.default.useState(null),[k,I]=n.default.useState(!1),[B,D]=n.default.useState(!1),E=(e,s=!1)=>{T(e),I(s)},F=(e,s)=>{h&&(s?h([...x,e]):h(x.filter(s=>s.user_id!==e.user_id)))},A=s=>{h&&(s?h(e):h([]))},U=e=>x.some(s=>s.user_id===e.user_id),L=e.length>0&&x.length===e.length,R=x.length>0&&x.length<e.length,O=n.default.useMemo(()=>o?eo(o,u,c,m,E,g?{selectedUsers:x,onSelectUser:F,onSelectAll:A,isUserSelected:U,isAllSelected:L,isIndeterminate:R}:void 0):t,[o,u,c,m,E,t,g,x,L,R]),P=(0,em.useReactTable)({data:e,columns:O,state:{sorting:N},onSortingChange:e=>{let s="function"==typeof e?e(N):e;if(w(s),s&&Array.isArray(s)&&s.length>0&&s[0]){let e=s[0];if(e.id){let s=e.id,t=e.desc?"desc":"asc";a?.(s,t)}}else a?.("created_at","desc")},getCoreRowModel:(0,ex.getCoreRowModel)(),manualSorting:!0,enableSorting:!0});return(n.default.useEffect(()=>{r&&w([{id:r.sortBy,desc:"desc"===r.sortOrder}])},[r]),C)?(0,s.jsx)(ek,{userId:C,onClose:()=>{T(null),I(!1)},accessToken:i,userRole:d,possibleUIRoles:o,initialTab:+!!k,startInEditMode:k}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"border-b px-6 py-4",children:(0,s.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,s.jsx)(eI.FilterInput,{placeholder:"æŒ‰é‚®ç®±æœç´¢...",value:f.email,onChange:e=>p({email:e}),icon:eE.Search}),(0,s.jsx)(eB.FiltersButton,{onClick:()=>D(!B),active:B,hasActiveFilters:!!(f.user_id||f.user_role||f.team),label:"ç­›é€‰"}),(0,s.jsx)(eD.ResetFiltersButton,{onClick:()=>{p(j)},label:"é‡ç½®ç­›é€‰"})]}),B&&(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[(0,s.jsx)(eI.FilterInput,{placeholder:"æŒ‰ç”¨æˆ· ID ç­›é€‰",value:f.user_id,onChange:e=>p({user_id:e}),icon:eF.User}),(0,s.jsx)(eI.FilterInput,{placeholder:"æŒ‰ SSO ID ç­›é€‰",value:f.sso_user_id,onChange:e=>p({sso_user_id:e}),icon:eA}),(0,s.jsx)("div",{className:"w-64",children:(0,s.jsx)(e_.Select,{value:f.user_role,onValueChange:e=>p({user_role:e}),placeholder:"é€‰æ‹©è§’è‰²",children:o&&Object.entries(o).map(([e,t])=>(0,s.jsx)(y.SelectItem,{value:e,children:t.ui_label},e))})}),(0,s.jsx)("div",{className:"w-64",children:(0,s.jsx)(e_.Select,{value:f.team,onValueChange:e=>p({team:e}),placeholder:"é€‰æ‹©åˆ†ç»„",children:b?.map(e=>(0,s.jsx)(y.SelectItem,{value:e.team_id,children:e.team_alias||e.team_id},e.team_id))})})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[l?(0,s.jsx)(eN.Skeleton.Input,{active:!0,style:{width:192,height:20}}):(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["æ˜¾ç¤º"," ",_&&_.users&&_.users.length>0?(_.page-1)*_.page_size+1:0," ","-"," ",_&&_.users?Math.min(_.page*_.page_size,_.total):0," ","/ å…± ",_?_.total:0," æ¡"]}),(0,s.jsx)("div",{className:"flex space-x-2",children:l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eN.Skeleton.Button,{active:!0,size:"small",style:{width:80,height:30}}),(0,s.jsx)(eN.Skeleton.Button,{active:!0,size:"small",style:{width:60,height:30}})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>S(v-1),disabled:1===v,className:`px-3 py-1 text-sm border rounded-md ${1===v?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"}`,children:"ä¸Šä¸€é¡µ"}),(0,s.jsx)("button",{onClick:()=>S(v+1),disabled:!_||v>=_.total_pages,className:`px-3 py-1 text-sm border rounded-md ${!_||v>=_.total_pages?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"}`,children:"ä¸‹ä¸€é¡µ"})]})})]})]})}),(0,s.jsx)("div",{className:"overflow-auto",children:(0,s.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(eh.Table,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,s.jsx)(eg.TableHead,{children:P.getHeaderGroups().map(e=>(0,s.jsx)(ej.TableRow,{children:e.headers.map(e=>(0,s.jsx)(ef.TableHeaderCell,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""} ${e.column.getCanSort()?"cursor-pointer hover:bg-gray-50":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,em.flexRender)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&e.column.getCanSort()&&(0,s.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,s.jsx)(ev.ChevronUpIcon,{className:"h-4 w-4 text-blue-500"}),desc:(0,s.jsx)(eS.ChevronDownIcon,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,s.jsx)(ey.SwitchVerticalIcon,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,s.jsx)(ep.TableBody,{children:l?(0,s.jsx)(ej.TableRow,{children:(0,s.jsx)(eb.TableCell,{colSpan:O.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"ðŸš… æ­£åœ¨åŠ è½½ç”¨æˆ·..."})})})}):e.length>0?P.getRowModel().rows.map(e=>(0,s.jsx)(ej.TableRow,{className:"h-8",children:e.getVisibleCells().map(e=>(0,s.jsx)(eb.TableCell,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:()=>{"user_id"===e.column.id&&E(e.getValue(),!1)},style:{cursor:"user_id"===e.column.id?"pointer":"default",color:"user_id"===e.column.id?"#3b82f6":"inherit"},children:(0,em.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,s.jsx)(ej.TableRow,{children:(0,s.jsx)(eb.TableCell,{colSpan:O.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"æœªæ‰¾åˆ°ç”¨æˆ·"})})})})})]})})})})]})}let{Text:eL,Title:eR}=u.Typography,eO={email:"",user_id:"",user_role:"",sso_user_id:"",team:"",model:"",min_spend:null,max_spend:null,sort_by:"created_at",sort_order:"desc"};e.s(["default",0,({accessToken:e,token:o,userRole:u,userID:c,teams:m})=>{let{t:x}=(0,B.useLanguage)(),h=(0,K.useQueryClient)(),[g,f]=(0,n.useState)(1),[p,j]=(0,n.useState)(!1),[_,y]=(0,n.useState)(null),[v,S]=(0,n.useState)(!1),[N,w]=(0,n.useState)(!1),[T,k]=(0,n.useState)(null),[I,D]=(0,n.useState)("users"),[F,A]=(0,n.useState)(eO),[R,q,W]=(0,M.useDebouncedState)(F,{wait:300}),[J,Q]=(0,n.useState)(!1),[G,H]=(0,n.useState)(null),[Y,X]=(0,n.useState)(null),[Z,ee]=(0,n.useState)([]),[et,el]=(0,n.useState)(!1),[ea,er]=(0,n.useState)(!1),[ei,en]=(0,n.useState)([]),ed=e=>{k(e),S(!0)};(0,n.useEffect)(()=>()=>{W.cancel()},[W]),(0,n.useEffect)(()=>{X((0,b.getProxyBaseUrl)())},[]),(0,n.useEffect)(()=>{(async()=>{try{if(!c||!u||!e)return;let s=(await (0,b.modelAvailableCall)(e,c,u)).data.map(e=>e.id);console.log("available_model_names:",s),en(s)}catch(e){console.error("Error fetching user models:",e)}})()},[e,c,u]);let em=e=>{A(s=>{let t={...s,...e};return q(t),t})},ex=async s=>{if(!e)return void E.default.fromBackend("æœªæ‰¾åˆ°è®¿é—®ä»¤ç‰Œ");try{E.default.success("æ­£åœ¨ç”Ÿæˆé‡ç½®å¯†ç é“¾æŽ¥...");let t=await (0,b.invitationCreateCall)(e,s);H(t),Q(!0)}catch(e){E.default.fromBackend("ç”Ÿæˆé‡ç½®å¯†ç é“¾æŽ¥å¤±è´¥")}},eh=async()=>{if(T&&e)try{w(!0),await (0,b.userDeleteCall)(e,[T.user_id]),h.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let s=e.users.filter(e=>e.user_id!==T.user_id);return{...e,users:s}}),E.default.success("ç”¨æˆ·åˆ é™¤æˆåŠŸ")}catch(e){console.error("Error deleting user:",e),E.default.fromBackend("åˆ é™¤ç”¨æˆ·å¤±è´¥")}finally{S(!1),k(null),w(!1)}},eg=async()=>{y(null),j(!1)},ef=async s=>{if(console.log("inside handleEditSubmit:",s),e&&o&&u&&c){try{let t=await (0,b.userUpdateUserCall)(e,s,null);h.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let s=e.users.map(e=>e.user_id===t.data.user_id?(0,z.updateExistingKeys)(e,t.data):e);return{...e,users:s}}),E.default.success(`ç”¨æˆ· ${s.user_id} æ›´æ–°æˆåŠŸ`)}catch(e){console.error("There was an error updating the user",e)}y(null),j(!1)}},ep=async e=>{f(e)},ej=(0,$.useQuery)({queryKey:["userList",{debouncedFilter:R,currentPage:g}],queryFn:async()=>{if(!e)throw Error("éœ€è¦è®¿é—®ä»¤ç‰Œ");return await (0,b.userListCall)(e,R.user_id?[R.user_id]:null,g,25,R.email||null,R.user_role||null,R.team||null,R.sso_user_id||null,R.sort_by,R.sort_order)},enabled:!!(e&&o&&u&&c),placeholderData:e=>e}),eb=ej.data,e_=(0,$.useQuery)({queryKey:["userRoles"],initialData:()=>({}),queryFn:async()=>{if(!e)throw Error("éœ€è¦è®¿é—®ä»¤ç‰Œ");return await (0,b.getPossibleUserRoles)(e)},enabled:!!(e&&o&&u&&c)}).data,ey=(0,n.useMemo)(()=>(e=>{if(!e)return null;let s={};for(let[t,l]of Object.entries(e)){let e=eu[t]||(l.ui_label?ec[l.ui_label]:void 0)||l.ui_label||t;s[t]={...l,ui_label:e}}return s})(e_),[e_]),ev=eo(ey||{},e=>{y(e),j(!0)},ed,ex,()=>{});return(0,s.jsxs)("div",{className:"w-full p-8 overflow-hidden",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsx)("div",{className:"flex space-x-3",children:ej.isLoading?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eN.Skeleton.Button,{active:!0,size:"default",shape:"default",style:{width:110,height:36}}),(0,s.jsx)(eN.Skeleton.Button,{active:!0,size:"default",shape:"default",style:{width:145,height:36}}),(0,s.jsx)(eN.Skeleton.Button,{active:!0,size:"default",shape:"default",style:{width:110,height:36}})]}):c&&e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.CreateUserButton,{userID:c,accessToken:e,teams:m,possibleUIRoles:ey}),(0,s.jsx)(d.Button,{onClick:()=>{er(!ea),ee([])},variant:ea?"primary":"secondary",className:"flex items-center",children:x(ea?"users.cancelSelection":"users.selectUsers")}),ea&&(0,s.jsxs)(d.Button,{onClick:()=>{0===Z.length?E.default.fromBackend("è¯·å…ˆé€‰æ‹©è¦ç¼–è¾‘çš„ç”¨æˆ·"):el(!0)},disabled:0===Z.length,className:"flex items-center",children:[x("users.bulkEdit")," (",x("users.selected")," ",Z.length,")"]})]}):null})}),(0,s.jsxs)(l.TabGroup,{defaultIndex:0,onIndexChange:e=>D(0===e?"users":"settings"),children:[(0,s.jsxs)(a.TabList,{className:"mb-4",children:[(0,s.jsx)(t.Tab,{children:x("users.tabs.users")}),(0,s.jsx)(t.Tab,{children:x("users.tabs.defaultSettings")})]}),(0,s.jsxs)(i.TabPanels,{children:[(0,s.jsx)(r.TabPanel,{children:(0,s.jsx)(eU,{data:ej.data?.users||[],columns:ev,isLoading:ej.isLoading,accessToken:e,userRole:u,onSortChange:(e,s)=>{em({sort_by:e,sort_order:s})},currentSort:{sortBy:F.sort_by,sortOrder:F.sort_order},possibleUIRoles:ey,handleEdit:e=>{y(e),j(!0)},handleDelete:ed,handleResetPassword:ex,enableSelection:ea,selectedUsers:Z,onSelectionChange:e=>{ee(e)},filters:F,updateFilters:em,initialFilters:eO,teams:m,userListResponse:eb,currentPage:g,handlePageChange:ep})}),(0,s.jsx)(r.TabPanel,{children:c&&u&&e?(0,s.jsx)(es,{accessToken:e,possibleUIRoles:ey,userID:c,userRole:u}):(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)(eN.Skeleton,{active:!0,paragraph:{rows:4}})})})]})]}),(0,s.jsx)(O,{visible:p,possibleUIRoles:ey,onCancel:eg,user:_,onSubmit:ef}),(0,s.jsx)(V.default,{isOpen:v,title:"åˆ é™¤ç”¨æˆ·ï¼Ÿ",message:"ç¡®è®¤åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚",resourceInformationTitle:"ç”¨æˆ·ä¿¡æ¯",resourceInformation:[{label:"é‚®ç®±",value:T?.user_email},{label:"ç”¨æˆ· ID",value:T?.user_id,code:!0},{label:"å…¨å±€ä»£ç†è§’è‰²",value:T&&ey?.[T.user_role]?.ui_label||T?.user_role||"-"},{label:"æ€»èŠ±è´¹",value:T?.spend!==null&&T?.spend!==void 0?`\xa5${T.spend.toFixed(2)}`:"Â¥0.00"}],onCancel:()=>{S(!1),k(null)},onOk:eh,confirmLoading:N}),(0,s.jsx)(P.default,{isInvitationLinkModalVisible:J,setIsInvitationLinkModalVisible:Q,baseUrl:Y||"",invitationLinkData:G,modalType:"resetPassword"}),(0,s.jsx)(U,{open:et,onCancel:()=>el(!1),selectedUsers:Z,possibleUIRoles:ey,accessToken:e,onSuccess:()=>{h.invalidateQueries({queryKey:["userList"]}),ee([]),er(!1)},teams:m,userRole:u,userModels:ei,allowAllUsers:!!u&&(0,C.isAdminRole)(u)})]})}],910119)}]);